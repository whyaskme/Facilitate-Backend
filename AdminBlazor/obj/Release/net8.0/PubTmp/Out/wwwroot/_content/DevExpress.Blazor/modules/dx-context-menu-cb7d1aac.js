import{_ as e}from"./_tslib-6e8ca86b.js";import{F as t,K as s,D as i,a}from"./dx-keyboard-navigator-38aff319.js";import{S as o}from"./single-slot-element-base-4ab30292.js";import{k as n}from"./key-fa0d8a82.js";import{a as r,b as d,P as l,K as m,d as c,e as p,c as h}from"./menu-keyboard-strategy-40347a11.js";import{E as u}from"./popup-a1c2390a.js";import{e as b}from"./custom-element-267f9a21.js";import"./eventhelper-8570b930.js";import"./layouthelper-1d804c8c.js";import"./point-e4ec110e.js";import"./constants-58283e53.js";import"./custom-events-helper-e7f279d3.js";import"./dispatcheraction-19309c7b.js";import"./focus-utils-6f61e33c.js";import"./touch-167bb2e4.js";import"./browser-f8f6e902.js";import"./common-eb095e4d.js";import"./disposable-d2c2d283.js";import"./logicaltreehelper-99f1adf9.js";import"./dom-utils-751497ba.js";import"./dom-e3fa5208.js";import"./css-classes-f45f6949.js";import"./data-qa-utils-8be7c726.js";import"./dx-ui-element-db9e89a3.js";import"./lit-element-base-7a85dca5.js";import"./lit-element-70cf14f4.js";import"./property-d3853089.js";import"./constants-3937401e.js";import"./rafaction-bba7928b.js";import"./transformhelper-ebad0156.js";import"./positiontracker-d7595cd2.js";import"./branch-bf06b0d2.js";import"./capturemanager-89a507c8.js";import"./portal-9686dca9.js";import"./constants-058ebb50.js";import"./dx-html-element-pointer-events-helper-1bf230d1.js";import"./devices-9f03a976.js";import"./nameof-factory-64d95f5b.js";class y extends l{constructor(e,t,s){super(e,t),this._parentStrategy=s,this.selectedItemIndex=-1}get parentStrategy(){return this._parentStrategy}initialize(){super.initialize(),this.targetElement.setAttribute(m,"")}activate(){this.selectedItemIndex>=0&&super.activate()}updateSelectedItemByIndex(e){e>=0&&super.updateSelectedItemByIndex(e)}queryItems(){return this.queryItemsBySelector(".dxbl-context-menu-item, .dxbl-context-menu-template")}onActiveStateChanged(e){e||(this.selectedItemElement&&t.removeTabIndex(this.selectedItemElement),t.removeTabIndex(this.targetElement))}doAction(e){this.selectedItemElement&&(this.doClick(this.selectedItemElement,e),r(this.selectedItemElement)&&this.openSubMenu(d.First))}async openSubMenu(e){this.requestSubMenuOpen();const t=await this.waitSubMenuShown();e===d.Last?t.focusLastItem():t.focusFirstItem()}handlePopupShown(){this.parentStrategy.onSubMenuShown(this),this.focusContainer()}handlePopupClosed(){this.parentStrategy.onSubMenuClosed(this)}onSubMenuClosed(e){super.onSubMenuClosed(e),this.focusContainer()}focusContainer(){const e=t.findFocusableElements(this.targetElement);e.length>0&&t.focusElement(e[0])}createSubMenuStrategy(e,t){return new g(e,t,this)}}class f extends y{closeSelf(){return!!r(this.selectedItemElement)&&(this.openSubMenu(d.Last),!0)}}class g extends y{closeSelf(){const e=this.targetElement.placementTargetElement;return!!e&&(e.dispatchEvent(new c(p.Collapse)),this.parentStrategy.updateSelectedItemByChildElement(e,!1),this.parentStrategy.focusSelectedItem(),!0)}}class v extends s{constructor(e,t){super(e,t),this._prevActiveElement=null,this.boundHandlePopupKeyboardStrategyCreating=this.handlePopupKeyboardStrategyCreating.bind(this),this.targetElement.addEventListener(u.eventName,this.boundHandlePopupKeyboardStrategyCreating)}queryItems(){return this.queryItemsBySelector(".dxbl-dropdown-dialog")}onSubMenuShown(e){this._prevActiveElement||(this._prevActiveElement=document.activeElement)}onSubMenuClosed(e){e.targetElement.isConnected&&!h(e.targetElement)||this.tryRestoreFocusedElement()}handlePopupKeyboardStrategyCreating(e){e.detail.factory={createPopup:(e,t)=>new f(e,t,this)},e.stopPropagation()}handleKeyDown(e){return n.KeyUtils.getEventKeyCode(e)!==n.KeyCode.Tab||this.nestedContentSelected?super.handleKeyDown(e):(this.performShortcutEvent(e),e.shiftKey?this.leaveBackward():this.leaveForward(),!0)}tryRestoreFocusedElement(){this._prevActiveElement&&this._prevActiveElement instanceof HTMLElement&&(this._prevActiveElement.focus(),this._prevActiveElement=null)}}let S=class extends o{constructor(){super(),this._keyboardNavigator=null,this.bindedOnChanged=this.onChanged.bind(this),this._observer=new MutationObserver(this.bindedOnChanged)}onChanged(e,t){null==e||e.forEach((e=>{e.addedNodes.forEach((e=>{e instanceof i&&(this._keyboardNavigator=e,this.initializeKeyboardNavigation())}))}))}connectedCallback(){this._keyboardNavigator=this.querySelector(a),this._keyboardNavigator?this.initializeKeyboardNavigation():this._observer.observe(this,{childList:!0})}initializeKeyboardNavigation(){this._keyboardNavigator&&!this._keyboardNavigator.initialized&&this._keyboardNavigator.initialize(this,new v(this._keyboardNavigator,this))}disconnectedCallback(){var e;this._observer.disconnect(),null===(e=this._keyboardNavigator)||void 0===e||e.disposeComponent()}};S=e([b("dxbl-context-menu")],S);const j={loadModule:function(){}};export{S as DxContextMenu,j as default};
