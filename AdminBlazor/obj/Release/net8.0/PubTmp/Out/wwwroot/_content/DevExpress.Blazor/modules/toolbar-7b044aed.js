import{_ as t}from"./_tslib-6e8ca86b.js";import{d as e}from"./dom-e3fa5208.js";import{E as i,h as s,u as o,m as r,F as n,G as l,l as a,R as d,f as h}from"./dom-utils-751497ba.js";import{d as u}from"./disposable-d2c2d283.js";import{P as c}from"./dx-html-element-pointer-events-helper-1bf230d1.js";import{D as m,a as p}from"./dropdown-menu-keyboard-strategy-2cdd5aef.js";import{T as y}from"./toolbar-css-classes-49e6b0a8.js";import{S as b}from"./observables-589a5615.js";import{C as g}from"./css-classes-f45f6949.js";import{S as v}from"./single-slot-element-base-4ab30292.js";import{C as f}from"./custom-events-helper-e7f279d3.js";import{K as I,a as x}from"./dx-keyboard-navigator-38aff319.js";import{k}from"./key-fa0d8a82.js";import{h as C,S as L,M as T,a as S,b as w,D as E,c as M,i as B,d as R,e as W}from"./menu-keyboard-strategy-40347a11.js";import{M as N,z as P}from"./popup-a1c2390a.js";import{D as A}from"./dispatcheraction-19309c7b.js";import{F as H}from"./capturemanager-89a507c8.js";import{t as V}from"./state-949f2642.js";import{e as _}from"./property-d3853089.js";import{e as q}from"./custom-element-267f9a21.js";import"./browser-f8f6e902.js";import"./common-eb095e4d.js";import"./eventhelper-8570b930.js";import"./constants-58283e53.js";import"./devices-9f03a976.js";import"./dx-ui-element-db9e89a3.js";import"./lit-element-base-7a85dca5.js";import"./data-qa-utils-8be7c726.js";import"./lit-element-70cf14f4.js";import"./logicaltreehelper-99f1adf9.js";import"./layouthelper-1d804c8c.js";import"./point-e4ec110e.js";import"./portal-9686dca9.js";import"./constants-058ebb50.js";import"./focus-utils-6f61e33c.js";import"./touch-167bb2e4.js";import"./constants-3937401e.js";import"./rafaction-bba7928b.js";import"./transformhelper-ebad0156.js";import"./positiontracker-d7595cd2.js";import"./branch-bf06b0d2.js";import"./nameof-factory-64d95f5b.js";class z{constructor(t,e){this.toolbarModel=t,this.id=e,this.state="",this._isWidthCalculationLocked=!1,this.index=-1,this.adaptivePriority=0,this._width=0}getWidth(){return this.isVisible()?_t(this.getElement(),!1,Rt):0}getNoTextWidth(){return this.getWidth()}isVisible(){return!0}get isWidthCalculationLocked(){return this._isWidthCalculationLocked}updateState(t){this.state=t,this.updateStateCore(t)}updateStateCore(t){}lockWidthCalculation(){this._isWidthCalculationLocked=!0}unlockWidthCalculation(){this._isWidthCalculationLocked=!1}getGroupElement(){return null}reset(){}}class D extends z{constructor(t,e){var i,s,o,r,n;super(t,null!==(o=null!==(s=null===(i=e.element)||void 0===i?void 0:i.id)&&void 0!==s?s:e.id)&&void 0!==o?o:"-1"),this.item=e,this.adaptivePriority=null!==(n=null===(r=null==e?void 0:e.adaptivePriority)||void 0===r?void 0:r.value)&&void 0!==n?n:0}getElement(){return this.item.getElement()}updateStateCore(t){this.item.isDisplayed.update(t.indexOf("has-"+this.getName())>-1)}updateVisible(t){t||this.lockWidthCalculation(),this.item.updateVisible(t),t&&this.unlockWidthCalculation()}reset(){const t=this.getElement();t&&t.classList.remove(y.ToolbarHiddenItem)}}class U extends D{constructor(t,e){super(t,e)}getNoTextWidth(){return this.item.isDisplayed.value?function(t){let e=_t(t,!1,Rt);if(0===e)return e;if(t){const i=t.querySelector(Pt);if(i){const s=t.querySelector(At);e-=zt(i);let o=i;for(;o=o.nextElementSibling;)!Dt(o)&&Ut(o)&&o!==s&&(e-=_t(o))}}return e}(this.getElement()):0}getName(){return"item"}isVisible(){return this.item.isDisplayed.value}updateStateCore(t){const e=this.item.toolbar,i=-1===t.indexOf(y.ToolbarHasEllipsis);this.updateVisible(e.minRootItems>0?i||this.index<e.minRootItems:i)}getGroupElement(){return this.item.getGroupElement()}}class j extends D{constructor(t,e){super(t,e)}getName(){return"ellipsis"}updateStateCore(t){super.updateStateCore(t),this.updateVisible(this.item.isDisplayed.value)}reset(){this.updateVisible(!0)}}class O extends U{constructor(t,e){super(t,e),this.itemBlocks=[],this.addItem(e)}addItem(t){this.itemBlocks.push(new U(this.toolbarModel,t))}isVisible(){return this.itemBlocks.reduce((function(t,e){return t&&e.isVisible()}),!0)}getWidth(){return this.itemBlocks.reduce((function(t,e){return t+e.getWidth()}),0)}getNoTextWidth(){return this.itemBlocks.reduce((function(t,e){return t+e.getNoTextWidth()}),0)}updateVisible(t){this.itemBlocks.forEach((function(e){e.updateVisible(t)}))}tryAddItem(t){const e=this.itemBlocks[this.itemBlocks.length-1].item,i=e.groupName===t.groupName&&e.group===t.group&&e.adaptivePriority.value===t.adaptivePriority.value;return i&&this.addItem(t),i}}class F extends z{constructor(t,e,i){super(t,i),this.item=e}getName(){return"title"}getWidth(){return _t(this.getElement(),!1,Rt)}getElement(){return this.item.getElement()}}class K{constructor(t){this.items=[],this.isLocked=!1,this.subscriptions=[],t&&this.addRange(t)}subscribe(t){this.isLocked||t(this.getChanges(this.items,[])),this.subscriptions.push(t)}getChanges(t,e){return{addedItems:t||[],removedItems:e||[]}}forEach(t,e){this.items.forEach(t,e)}selectMany(t,e){return this.map(t,e).reduce((function(t,e){return t.concat(e)}),[])}reduce(t,e){return this.items.reduce(t,e)}map(t,e){return this.items.map(t,e)}filter(t,e){return this.items.filter(t,e)}any(){return this.count()>0}count(){return this.items.length}get(t){return this.items[t]}add(t){this.addItemCore(t)&&this.raiseChanges([t],[])}remove(t){this.removeItemCore(t)&&this.raiseChanges([],[t])}addRange(t){this.raiseChanges(t.map(this.addItemCore.bind(this)).filter((function(t){return!!t})),[])}removeRange(t){this.raiseChanges([],t.map(this.removeItemCore.bind(this)).filter((function(t){return!!t})))}addItemCore(t){return this.items.indexOf(t)>-1?null:this.items[this.items.length]=t}removeItemCore(t){const e=this.items.indexOf(t);return-1===e?null:this.items.splice(e,1)[0]}raiseChanges(t,e){const i=this.getChanges(t,e);(i.addedItems.length>0||i.removedItems.length>0)&&this.subscriptions.forEach((function(t){t(i)}))}lock(){this.isLocked=!0}unlock(){this.isLocked=!1}}class G{constructor(t){this.id=t,this._margins=void 0,this.blocks=[]}push(t){this.blocks.includes(t)||this.blocks.push(t),this.update()}toArray(){return Array.from(this.blocks)}get margins(){return this._margins||0}update(){if(!this._margins&&this.blocks.length){const t=this.blocks[0].getGroupElement();if(t){const i=e.DomUtils.getCurrentStyle(t);this._margins=e.DomUtils.pxToInt(i.marginRight)+e.DomUtils.pxToInt(i.marginLeft)}}}}class ${constructor(t,e,i){var s;this.layer=t,this.block=e,this.width=0,this._blockCollection=void 0;const o=e.getGroupElement();o&&(this._blockCollection=this.layer.getBlockCollection(o),null===(s=this._blockCollection)||void 0===s||s.push(e)),i.subscribe(e,((t,i=!1)=>{var s;null===t&&(t=null===(s=this.layer.getPrevLayer())||void 0===s?void 0:s.getActualBlocks().filter((function(t){return t.block===e}))[0].width),t!==this.width&&(this.width=null!=t?t:0,i||this.layer.requestUpdateLayoutModel())}))}get blockCollection(){return this._blockCollection||new G(null)}getMinWidth(){return this.width}getMaxWidth(t){return this.getMinWidth()}}class J extends ${getPrevLayerMinWidth(){const t=this.layer.getPrevLayer();return t?t.getActualBlocks().filter((t=>t.block===this.block))[0].getMinWidth():0}getMaxWidth(t){return t===this.layer?this.getPrevLayerMinWidth():this.getMinWidth()}}class Q extends ${}class X extends ${}class Y{constructor(t,e){this.widthCalculator=t,this.triggersResolver=e,this.widthSubscriber=null,this.widthCalculator=t,this.triggersResolver=e}subscribe(t,e){this.widthSubscriber=e;const s=this.widthCalculator.bind(this);this.triggersResolver(t).forEach((function(o){o.subscribe((function(){t.isWidthCalculationLocked||i((function(){e(s(t),!1)}))}),!0)})),i((function(){e(s(t),!0)}))}updateWidth(t){const e=this.widthSubscriber,s=this.widthCalculator.bind(this);i((function(){e(s(t),!0)}))}}let Z;Z={fullWidthItem:new Y((function(t){return t.getWidth()}),qt),fullWidthSystemItem:new Y((function(t){return t.getWidth()}),(function(t){return[]})),titleItem:new Y((function(t){return t.getWidth()}),(function(t){var e,i;return[null===(e=t.toolbarModel.title)||void 0===e?void 0:e.hasTitle,null===(i=t.toolbarModel.title)||void 0===i?void 0:i.text]})),noTextItem:new Y((function(t){return t.getNoTextWidth()}),qt),contextItem:function(t){return new Y((function(e){return t.items.filter((function(t){return"item"===t.getName()&&t.index<e.index&&t.isVisible()})).length>=e.toolbarModel.minRootItems||!e.isVisible()?0:null}),qt)},hiddenItem:new Y((function(){return 0}),(function(){return[]}))};class tt{getMin(t){return t.map((t=>t.minSize)).reduce(((t,e)=>t+e))}getMax(t){return t.map((t=>t.fullSize)).reduce(((t,e)=>t+e))}}class et extends tt{getRange(t,e,i){return{min:this.getMin(t)+e,max:this.getMax(t)+e}}}class it extends tt{getRange(t,e,i){return{min:this.getMin(t),max:this.getMax(t)+e}}}class st extends tt{constructor(){super(...arguments),this.prevLayerRangeCalculator=new it}getRange(t,e,i=[]){return{min:this.getMin(t)+e,max:this.getMax(i)+e-1}}}class ot{constructor(t,e,i,s){this.name=t,this.canApply=e,this.blocks=i,this.margin=s}orderBlock(t,e){const i=this.blocks.find((e=>e.id===t));if(!i)throw new Error(`No block with id ${t} in layer with type: ${this.type}`);i.index=e,this.blocks.sort(((t,e)=>ht(t,e)))}getBlock(t){const e=this.blocks.find((e=>e.id===t));if(!e)throw new Error(`No block with id ${t} in layer with type: ${this.type}`);return e}}class rt extends ot{constructor(){super(...arguments),this.type=ct.Default}updateBlock(t,e){const i=this.getBlock(t.id);if(0===t.width)return!1;const s=i.minWidth!==t.width||i.maxWidth!==t.width;return i.minWidth=t.width,i.maxWidth=t.width,s}}class nt extends ot{constructor(){super(...arguments),this.type=ct.FullSequential}updateBlock(t,e){const i=this.getBlock(t.id);let s=i.maxWidth!==t.width;return i.maxWidth=t.width,i.minWidth&&(s=s||i.minWidth!==t.width,i.minWidth=t.width),e||(s=s||0!==i.minWidth,i.minWidth=0),s}}class lt extends ot{constructor(){super(...arguments),this.type=ct.NoText}updateBlock(t,e){const i=this.getBlock(t.id);if(0===t.width)return!1;const s=i.minWidth!==t.width||i.maxWidth!==t.width;return i.minWidth=t.width,i.maxWidth=t.width,s}}class at extends ot{constructor(){super(...arguments),this.type=ct.NoTextSequential}updateBlock(t,e){const i=this.getBlock(t.id);let s=i.maxWidth!==t.width;return i.maxWidth=t.width,i.minWidth&&(s=s||i.minWidth!==t.width,i.minWidth=t.width),e||(s=s||0!==i.minWidth,i.minWidth=0),s}}class dt{constructor(){this.layers=[],this.fullLayerTypes=[ct.Default,ct.FullSequential],this.noTextLayerTypes=[ct.NoText,ct.NoTextSequential]}get isEmpty(){if(0===this.layers.length)return!0;return 0===this.layers.find((t=>t.type===ct.Default)).blocks.filter((t=>!t.isEllipse&&!t.isTitle&&0!==t.maxWidth)).length}get blockIds(){const t=this.layers.find((t=>t.type===ct.Default));return t&&0!==t.blocks.length?t.blocks.filter((t=>!t.isEllipse)).map((t=>t.id)):[]}resetLayers(t){this.layers=this.convertLayers(t).map(this.toLayer)}initLayers(t){return!!this.isEmpty&&(this.resetLayers(t),!0)}convertLayers(t){return t.map((t=>{const e=t.getActualBlocks();return{name:t.stateName,canApply:t.canApply,type:t.type,blocks:Ot(e,t).sort(((t,e)=>ht(t,e))),margin:(i=e,[...new Set(i.map((t=>t.blockCollection)))].map((t=>t.margins)).reduce(((t,e)=>t+e),0))};var i}))}updateFullSizeBlock(t,e){return this.updateBlock(t,e,this.fullLayerTypes)}updateNoTextBlock(t,e){return this.updateBlock(t,e,this.noTextLayerTypes)}updateBlock(t,e,i){let s=!1;for(const o of this.layers.filter((t=>i.includes(t.type))))s=o.updateBlock(t,e)||s;return s}orderBlock(t,e){for(const i of this.layers)i.orderBlock(t,e)}updateBlockByLayer(t,e,i){return this.layers.find((t=>t.type===i)).updateBlock(t,e)}getItemsByName(t){const e=this.layers.find((e=>e.name===t));return this.getBlocks(e)}getItemsByType(t){const e=this.layers.find((e=>e.type===t));return this.getBlocks(e)}getBlocks(t){return t.blocks.filter((t=>-1!==t.index))}getBlock(t,e){const i=this.layers.find((e=>e.name===t));if(i)return i.blocks.find((t=>t.index===e))}getBlockInEveryLayer(t){return this.layers.map((t=>t.blocks)).flat().filter((e=>e.id===t))}toLayer(t){const{name:e,canApply:i,type:s,blocks:o,margin:r}={...t};switch(s){case ct.Default:return new rt(e,i,o,r);case ct.FullSequential:return new nt(e,i,o,r);case ct.NoText:return new lt(e,i,o,r);case ct.NoTextSequential:return new at(e,i,o,r)}}}function ht(t,e){return t.isTitle||e.isTitle?t.index-e.index:t.isEllipse||e.isEllipse?e.index-t.index:t.adaptivePriority===e.adaptivePriority||e.isEllipse?t.index>e.index?1:-1:t.adaptivePriority-e.adaptivePriority}class ut{constructor(){this._layers=[],this.checkpointsByLayers=new Map}get layers(){return this._layers.filter((t=>t.canApply))}initialize(t){var e;this._layers=t,this.checkpointsByLayers.clear();let i=0;for(const t of this.layers){const s=this.getPoints(t,i).filter((t=>0!==t)),o=s.filter((t=>this.getCheckpoints().indexOf(t)<0));this.checkpointsByLayers.set(t.type,o),i=null!==(e=s[s.length-1])&&void 0!==e?e:0}}getLayerTypeByWidth(t){for(const e of this.layers.map((t=>t.type))){if(this.checkpointsByLayers.get(e).indexOf(t)>-1)return e}return ct.Default}getCheckpointPair(t){const e=this.getCheckpoints();let i=0,s=0;for(const o of e){if(o<t){s=o;break}i=o}return[i,s]}getCheckpoints(){const t=[...this.checkpointsByLayers.values()].flat();return[...new Set(t.sort(((t,e)=>t<e?1:-1)))]}getPoints(t,e=0){switch(t.type){case ct.Default:return this.getConstantLayerPoints(t);case ct.FullSequential:return this.getSeqPoints(t,!0,e);case ct.NoText:return this.getConstantLayerPoints(t);case ct.NoTextSequential:return this.getSeqPoints(t,!0,e)}return[]}getConstantLayerPoints(t){return[t.blocks.map((t=>t.fullSize)).reduce(((t,e)=>t+e),0)]}getSeqPoints(t,e,i){const s=[];let o=t.blocks.map((t=>t.fullSize)).reduce(((t,e)=>t+e),0);for(const e of t.blocks.slice().reverse()){const t=o-(e.fullSize-e.minWidth);t!==o&&e.index>-1&&(!i||t<i)&&s.push(t),o=t}return s}}var ct,mt,pt;!function(t){t[t.Default=0]="Default",t[t.FullSequential=1]="FullSequential",t[t.NoText=2]="NoText",t[t.NoTextSequential=3]="NoTextSequential"}(ct||(ct={}));class yt{constructor(t){this.onLayerApplied=t,this.layers=[],this.blockCollection=null,this.currentLayer=null,this.currentWidth=null,this.currentHeight=null,this._defaultLayer=null,this._sequentialLayer=null,this.minWidth=null,this.virtualLayout=new dt,this.layerCheckpointService=new ut,this.layersCheckpoints=[],this.prevPoint=0,this.nextPoint=0,this.toolbarWidthUpdate=()=>{},this.toolbarHeightUpdate=()=>{},this.toolbarIsVisible=()=>!0}initialize(t,e,i){this.blockCollection=t,this.elementContentWidthSubscription=s(e,(t=>{var e;this.currentWidth===t.width&&this.currentHeight===t.height||(null===this.currentWidth&&(null===(e=this.blockCollection)||void 0===e||e.subscribe((t=>{t.addedItems.forEach(this.addItemBlock.bind(this)),t.removedItems.forEach(this.removeItemBlock.bind(this))}))),this.getCheckpoints(),this.currentWidth=t.width,this.currentHeight&&this.currentHeight===t.height||(this.currentHeight=t.height,this.toolbarHeightUpdate(this.currentHeight)),this.minWidth||this.setMinWidth(),this.currentLayer&&!this.checkForLayoutUpdate()||(this.virtualLayout.isEmpty&&(this.virtualLayout.resetLayers(this.layers),this.getCheckpoints()),this.setCheckpoints(),this.setLayout()),i&&i(t))}))}addBlockToCollection(t){var e;null===(e=this.blockCollection)||void 0===e||e.add(t)}removeBlockToCollection(t){var e;null===(e=this.blockCollection)||void 0===e||e.remove(t)}dispose(){this.elementContentWidthSubscription&&o(this.elementContentWidthSubscription)}getLastLayer(){return this.layers[this.layers.length-1]||null}setDefaultLayer(t,e){const i=this._defaultLayer=new gt("default",t,this,e);this.layers.push(i)}setSimultaneousTransitionLayer(t,e,i){this.layers.push(new ft(t,ct.NoText,e,this.getLastLayer(),i))}setSequentialTransitionLayer(t,e,i,s){const o=this._sequentialLayer=new vt(t,e,i,this.getLastLayer(),s);this.layers.push(o)}addItemBlock(t){this.layers.forEach((function(e){e.addBlock(t)}))}removeItemBlock(t){this.layers.forEach((function(e){e.removeBlock(t)}))}removeItemBlocks(t){for(const e of t)this.removeItemBlock(e)}checkForLayoutUpdate(){const t=this.currentWidth;return this.nextPoint>0&&t<this.nextPoint||this.prevPoint>0&&t>this.prevPoint}updateFromVirtualLayer(t){const e=this.layers.find((e=>e.type===t.type));e.canApply=t.canApply;for(const i of e.layoutBlocks){const e=t.blocks.find((t=>t.id===i.block.id));e&&(i.width=e.minWidth)}}orderFromVirtualLayer(t){const e=this.layers.find((e=>e.type===t.type)),i=e.layoutBlocks,s=t.blocks;for(const i of e.layoutBlocks){const e=t.blocks.find((t=>t.id===i.block.id));e&&(i.block.index=e.index)}e.layoutBlocks=[...i].sort(((t,e)=>s.indexOf(s.find((e=>e.id===t.block.id)))-s.indexOf(s.find((t=>t.id===e.block.id)))))}recalculateLayout(){this.setLayout()}setCheckpoints(){[this.prevPoint,this.nextPoint]=this.layerCheckpointService.getCheckpointPair(this.currentWidth)}updateCheckpoints(t){const[e,i]=[this.prevPoint,this.nextPoint];this.resetCheckpoints();const s=this.currentWidth;t&&(e!==this.prevPoint&&s<this.prevPoint||i!==this.nextPoint&&s>this.nextPoint)&&this.setLayout()}resetCheckpoints(){this.virtualLayout.resetLayers(this.layers),this.layerCheckpointService.initialize(this.virtualLayout.layers),this.layersCheckpoints=this.layerCheckpointService.getCheckpoints(),this.setCheckpoints(),this.setMinWidth()}setLayout(){const t=this.layerCheckpointService.getLayerTypeByWidth(this.nextPoint>0&&this.currentWidth>this.nextPoint?this.nextPoint:this.prevPoint),e=this.layers.find((e=>e.type===t));this.virtualLayout.resetLayers(this.layers),this.applyLayer(e)}setMinWidth(){const t=this.getCheckpoints();this.minWidth=t[t.length-1],this.toolbarWidthUpdate()}updateLayout(){const t=this.findLayersForWidth(this.currentWidth)[0];t&&(this.applyLayer(t),this.minWidth=Math.min(...this.layers.filter((t=>t.latestRange)).map((t=>t.latestRange.min))))}getCheckpoints(){return this.layersCheckpoints.length||this.virtualLayout.isEmpty||!this.toolbarIsVisible()||this.resetCheckpoints(),this.layersCheckpoints}resetToDefault(){this.applyLayer(this.layers[0],!0)}applyLayer(t,e=!1){if(this.currentLayer=t,e)t.activateAndReset(this.currentWidth);else{this.virtualLayout.initLayers(this.layers);const e=this.virtualLayout.layers.find((t=>t.type===this.currentLayer.type));t.activate(this.currentWidth,e.blocks)}this.onLayerApplied&&this.onLayerApplied(t)}findLayersForWidth(t){return this.layers.filter((function(e){return e.isValidWidth(t)}))}forceUpdate(){null!==this.currentWidth&&this.updateLayout()}getMinWidth(){return this.minWidth?this.minWidth:this._sequentialLayer?this._sequentialLayer.getActualBlocks().map((t=>t.getMinWidth())).reduce(((t,e)=>t+e),0):null}}class bt{constructor(t,e,i,s,o){this.stateName=t,this.type=e,this.blockUpdaterGetter=i,this.prevLayer=s,this.canApply=o,this.nextLayer=null,this.layoutBlocks=[],this.nextLayer=null,s&&(s.nextLayer=this)}getNextLayer(){return null!=this.nextLayer?this.nextLayer.canApply?this.nextLayer:this.nextLayer.getNextLayer():null}getPrevLayer(){return null!=this.prevLayer?this.prevLayer.canApply?this.prevLayer:this.prevLayer.getPrevLayer():null}requestUpdateLayoutModel(){var t;null===(t=this.getPrevLayer())||void 0===t||t.requestUpdateLayoutModel()}getBlockCollection(t){var e;return null===(e=this.getPrevLayer())||void 0===e?void 0:e.getBlockCollection(t)}isValidWidth(t){if(!this.canApply||!t)return!1;const e=this.getRangeNew();return!this.getNextLayer()&&e.min>t||!this.getPrevLayer()&&e.max<t||e.min<=t&&e.max>=t}getRange(){const t=new Set,e=this.latestRange=this.getActualBlocks().reduce(((e,i)=>(t.add(i.blockCollection),{min:e.min+i.getMinWidth(),max:e.max+i.getMaxWidth(this)})),{min:0,max:0});return t.forEach((t=>{e.min+=t.margins,e.max+=t.margins})),e}getRangeNew(){const t=Ot(this.getActualBlocks(),this),e=this.type===ct.NoText&&this.prevLayer?Ot(this.prevLayer.getActualBlocks(),this.prevLayer):[];return this.latestRange=this.rangeCalculator.getRange(t,0,e)}getActualBlocks(){const t=this.getPrevLayer();return t?t.getActualBlocks().map((t=>this.layoutBlocks.filter((function(e){return e.block===t.block}))[0]||t)):this.layoutBlocks}activate(t,e){t&&this.layoutBlocks.forEach((t=>{t.block.updateState(this.stateName)}))}addBlock(t){const e=this.blockUpdaterGetter(t);if(e){const i=this.createBlock(t,e);this.layoutBlocks.push(i)}}removeBlock(t){const e=this.layoutBlocks.find((e=>e.block.id===t));if(e){const t=this.layoutBlocks.indexOf(e);this.layoutBlocks.splice(t,1)}}activateAndReset(t){}}class gt extends bt{constructor(t,e,i,s){super(t,ct.Default,e,null,s),this.layoutModel=i,this.rangeCalculator=new et,this.blockCollection=new Map}requestUpdateLayoutModel(){this.layoutModel.updateLayout()}createBlock(t,e){return new X(this,t,e)}activateAndReset(t){this.activate(t,[]),this.layoutBlocks.forEach((t=>{t.block.reset()}))}getBlockCollection(t){return this.getBlockCollectionCore(t)}getBlockCollectionCore(t){let e=this.blockCollection.get(t);return e||this.blockCollection.set(t,e=new G(t)),e}}class vt extends bt{constructor(){super(...arguments),this.rangeCalculator=new it}activate(t,e){const i=this.getActualBlocks();this.getRangeNew();let s=this.latestRange.max,o=this.stateName;const r=new Map;for(let n=e.length-1;n>=0;n--){const l=e[n],a=i.find((t=>t.block.id===l.id));if(s>t){s-=l.fullSize-l.minSize;const e=a.blockCollection.id,i=(r.has(e)?r:r.set(e,a.blockCollection.toArray())).get(e);if(i&&i.splice(i.indexOf(a.block),1),s<=t){a.block.updateState(o);const t=this.getPrevLayer();o=t?t.stateName:"";continue}}a.block.updateState(o)}}getRange(){const t=new Set;return this.latestRange=this.getActualBlocks().reduce(((e,i)=>(t.add(i.blockCollection),{min:e.min+i.getMinWidth(),max:e.max+i.getMaxWidth(this)})),{min:0,max:0}),t.forEach((t=>{this.latestRange.max+=t.margins})),this.latestRange}createBlock(t,e){return new J(this,t,e)}}class ft extends bt{constructor(){super(...arguments),this.rangeCalculator=new st}createBlock(t,e){return new Q(this,t,e)}getRange(){const t=new Set;let e=this.getActualBlocks().reduce((function(e,i){return t.add(i.blockCollection),e+i.getMinWidth()}),0);t.forEach((t=>{e+=t.margins}));const i=this.getPrevLayerRangeMax();return this.latestRange={min:e,max:i}}getPrevLayerRangeMax(){const t=this.getPrevLayer();return t?t.getRangeNew().max-1:0}}!function(t){t[t.Contained=0]="Contained",t[t.Plain=1]="Plain"}(mt||(mt={})),function(t){t[t.Default=0]="Default",t[t.Large=1]="Large"}(pt||(pt={}));class It{constructor(t,e){this.element=t,this.toolbar=e,this.index=new b(-1),this.isVisible=new b(this.defaultIsVisible()),this.isVisible.subscribe((t=>{this.onIsVisibleChanged(t)}),!0)}defaultIsVisible(){return!0}getElement(){return this.element}updateVisible(t){this.isVisible.update(t)}onIsVisibleChanged(t){const e=this.getElement();e&&(t?this.show(e):this.hide(e))}show(t){t.classList.remove(y.ToolbarHiddenItem)}hide(t){t.classList.add(y.ToolbarHiddenItem)}}class xt extends It{constructor(){super(...arguments),this.isDisplayed=new b(!0),this.text=new b(""),this.iconCssClass=new b("")}show(t){t.style.display=""}hide(t){t.style.display="none"}getGroupElement(){return null}}class kt extends xt{constructor(t,e,i){super(t,e),this.group=i,this.groupName=new b(""),this.adaptivePriority=new b(-1)}onIsVisibleChanged(t){super.onIsVisibleChanged(t),this.group.onItemVisibleChanged()}getElement(){return document.querySelector(`#${this.id}`)}getParent(){const t=this.getElement();return t&&t.parentElement?t.parentElement:null}getGroupElement(){return this.group.getElement()}}class Ct extends xt{constructor(t,e){super(t,e)}defaultIsVisible(){return null}}class Lt extends It{constructor(t,e){super(t,e),this.items=[]}addItem(t){this.items.push(t)}onItemVisibleChanged(){if(0===this.items.length)return;const t=this.items.some((t=>t.isVisible.value));this.updateVisible(t)}getElement(){if(0===this.items.length)return null;const t=r(this.items[0].getElement(),jt(Wt,this.toolbar.id));return t||this.items[0].getParent()}}class Tt extends It{constructor(t,e){super(null,t),this.elementSelector=e,this.hasTitle=new b(!1),this.text=new b(""),this.text.subscribe((t=>{this.hasTitle.update(null!=t&&""!==t)}))}getElement(){return document.querySelector(this.elementSelector)}}class St{constructor(t,e){this.element=t,this.id=e,this.items=[],this.itemMap=new Map,this.groupMap=new Map,this.canHideRootItems=!1,this.canCollapseToIcons=!1,this.minRootItems=0}}class wt{}wt.Button=g.Prefix+"-btn",wt.ButtonFirst=wt.Button+"-first",wt.ButtonLast=wt.Button+"-last",wt.ButtonTool=wt.Button+"-tool",wt.ButtonGroup=wt.Button+"-group",wt.ButtonGroupFirst=wt.ButtonGroup+"-first",wt.ButtonGroupVertical=wt.ButtonGroup+"-vertical",wt.ButtonGroupLeft=wt.ButtonGroup+"-left",wt.ButtonGroupRight=wt.ButtonGroup+"-right";class Et{constructor(t){this.dataToolbarId=t,this.virtualElementCreator={[y.ToolbarGroup]:this.createVirtualGroup,[y.ToolbarItem]:this.createVirtualRootItem,[y.ToolbarPlaceholder]:this.createVirtualPlaceholder,[y.ButtonEllipsis]:this.createVirtualRootItem},this.toolbar=document.querySelector(`[${Ht}='${this.dataToolbarId}']`),this.buttonToolbar=this.toolbar.querySelector(`.${y.ButtonToolbar}`),this.virtualButtonToolbar=document.createElement("div"),this.copyToolbar(),this.toolbar.appendChild(this.virtualButtonToolbar)}copyToolbar(){this.virtualButtonToolbar.classList.remove(...this.virtualButtonToolbar.classList),this.virtualButtonToolbar.classList.add(y.VirtualToolbar),this.virtualButtonToolbar.classList.add(...this.buttonToolbar.classList);const t=[...this.buttonToolbar.children],e=[];for(const i of t){const t=[...i.classList].find((t=>null!=this.virtualElementCreator[t]));e.push(this.virtualElementCreator[t].bind(this,i)())}this.numberToolbarGroups(e.filter((t=>t.classList.contains(y.ToolbarGroup)))),this.virtualButtonToolbar.innerHTML="",e.forEach((t=>this.virtualButtonToolbar.appendChild(t)))}numberToolbarGroups(t){for(let e=0;e<t.length;e++)0===e&&t[e].classList.add(wt.ButtonGroupFirst)}getElementWidth(t){this.buttonToolbar.style.width=this.buttonToolbar.offsetWidth+"px";const i=this.virtualButtonToolbar.querySelector(`[virtual-id=${t}]`),s=i.parentElement;let o=0,r=0;const n=[...s.children].find((t=>t.classList.contains(y.ToolbarGroupSeparator)));let l=0;if(null!=i.parentElement&&i.parentElement.classList.contains(y.ToolbarGroup)){const t=e.DomUtils.getCurrentStyle(i.parentElement);if(i.parentElement.lastElementChild===i&&(r=e.DomUtils.pxToInt(t.marginRight)),i.parentElement.firstElementChild===i&&(o=e.DomUtils.pxToInt(t.marginLeft)),s.classList.contains(wt.ButtonGroupFirst)&&s.children[1]===i)o=e.DomUtils.pxToInt(t.marginLeft);else if(s.firstElementChild===n&&n.nextElementSibling===i){const t=n;if(t){const i=e.DomUtils.getCurrentStyle(s),o=e.DomUtils.getCurrentStyle(t);l+=e.DomUtils.pxToInt(i.marginLeft)+t.offsetWidth+e.DomUtils.pxToInt(o.marginRight)}}}return this.buttonToolbar.style.width="",0===i.offsetWidth?0:i.offsetWidth+o+r+l}setRenderMode(t){t==mt.Plain?this.virtualButtonToolbar.classList.add(y.ButtonPlainToolbar):this.virtualButtonToolbar.classList.remove(y.ButtonPlainToolbar)}applyFullLayer(){this.applyAdaptivityState(y.ToolbarDefaultLayer)}applyNoTextLayer(){this.applyAdaptivityState(y.ToolbarNoItemText)}applyAdaptivityState(t){t.indexOf(y.ToolbarNoItemText)>-1?this.virtualButtonToolbar.classList.add(y.ToolbarNoItemText):this.virtualButtonToolbar.classList.remove(y.ToolbarNoItemText)}createVirtualGroup(t){const e=document.createElement("div"),i=e.querySelectorAll(`.${y.ToolbarItem} > .${wt.Button}`),s=i.length>0?i[0].id:"",o=i.length>0?i[i.length-1].id:"";for(const i of t.attributes)e.setAttribute(i.name,i.value);for(let i=0;i<t.children.length;i++)e.appendChild(this.createVirtualItem(t.children[i],s,o));return e.classList.remove(y.ToolbarHiddenItem),e}createVirtualRootItem(t){return this.createVirtualItem(t,"","")}createVirtualItem(t,e,i){const s=document.createElement("div");for(const e of[...t.attributes].filter((t=>"id"!==t.name)))s.setAttribute(e.name,e.value);if(s.setAttribute("virtual-id",t.id),s.style.display="block",t.children.length>0)for(const o of t.children){const t=o.tagName===y.ToolbarItem?this.createVirtualItem(o,e,i):this.createVirtualChild(o,e,i);s.appendChild(t)}else s.innerHTML=t.innerHTML;return s}createVirtualPlaceholder(t){const e=document.createElement("DIV");for(const i of[...t.attributes].filter((t=>"id"!==t.name)))e.setAttribute(i.name,i.value);return e.style.width=t.clientWidth+"px",e}createVirtualChild(t,e,i){const s=t.cloneNode(!0);return s.id="",s.setAttribute("virtual-id",t.id),s.classList.remove(y.ToolbarHiddenItem),t.classList.contains(wt.Button)&&(e===s.id&&s.classList.add(wt.ButtonFirst),i===s.id&&s.classList.add(wt.ButtonLast)),s}}class Mt{constructor(t,e,i){this.layoutModel=t,this.layoutOptions=e,this.minRootItemIds=[],this.virtualLayout=new dt,this.virtualToolbar=new Et(i),this.setRenderMode(this.layoutOptions.renderMode),this.setMinRootItems()}updateMinRootItems(t){this.virtualLayout.resetLayers(this.layoutModel.layers);const e=this.virtualLayout.layers.find((t=>t.type===ct.FullSequential)),i=this.virtualLayout.layers.find((t=>t.type===ct.NoTextSequential));e.canApply=t>0;const s=this.virtualLayout.getItemsByName(this.layoutModel.currentLayer.stateName),o=this.getAffectedItemIds(s.map((t=>t.id)),this.layoutOptions.minRootItems,t);t-this.layoutOptions.minRootItems>0?(e.blocks.filter((t=>o.includes(t.id))).forEach((t=>t.minWidth=t.maxWidth)),i.blocks.filter((t=>o.includes(t.id))).forEach((t=>t.minWidth=t.maxWidth))):(e.blocks.filter((t=>o.includes(t.id))).forEach((t=>t.minWidth=0)),i.blocks.filter((t=>o.includes(t.id))).forEach((t=>t.minWidth=0))),this.layoutOptions.minRootItems=t,this.setMinRootItems(),this.layoutModel.updateFromVirtualLayer(e),this.layoutModel.updateFromVirtualLayer(i),this.layoutModel.updateCheckpoints(!0)}setMinRootItems(){if(0===this.virtualLayout.layers.length)return;const t=this.virtualLayout.layers.find((t=>t.type===ct.FullSequential)).blocks.filter((t=>!t.isTitle&&!t.isEllipse));this.minRootItemIds=this.getAffectedItemIds(t.map((t=>t.id)),0,this.layoutOptions.minRootItems)}setRenderMode(t){this.layoutOptions.renderMode=t,this.virtualToolbar.setRenderMode(this.layoutOptions.renderMode)}updateRenderMode(t){this.virtualLayout.resetLayers(this.layoutModel.layers),this.virtualToolbar.copyToolbar(),this.setRenderMode(t);for(const t of this.virtualLayout.blockIds){const e={id:t,width:0};for(const t of this.virtualLayout.layers){t.type===ct.NoText?this.virtualToolbar.applyNoTextLayer():this.virtualToolbar.applyFullLayer();const i=this.renderVirtualResizeModel(e);t.updateBlock(i,this.checkIfIsInMinRootItems(e.id))}}this.updateAllRealLayers(!0)}updateCanHideRootItems(t){if(this.refreshVirtualLayout(),this.layoutOptions.canHideRootItems===t)return;this.layoutOptions.canHideRootItems=t;const e=this.virtualLayout.layers.find((t=>t.type===ct.FullSequential)),i=this.virtualLayout.layers.find((t=>t.type===ct.NoTextSequential));e.canApply=this.layoutOptions.canHideRootItems&&(this.layoutOptions.minRootItems>0||!this.layoutOptions.canCollapseToIcons),i.canApply=this.layoutOptions.canHideRootItems,this.updateAllRealLayers(!0)}updateCanCollapseToIcons(t){if(this.refreshVirtualLayout(),this.layoutOptions.canCollapseToIcons===t)return;this.layoutOptions.canCollapseToIcons=t;const e=this.virtualLayout.layers.find((t=>t.type===ct.NoText)),i=this.virtualLayout.layers.find((t=>t.type===ct.NoTextSequential));e.canApply=this.layoutOptions.canCollapseToIcons,i.canApply=this.layoutOptions.canCollapseToIcons&&this.layoutOptions.canHideRootItems,this.updateAllRealLayers(!0)}addBlock(t){this.virtualLayout.initLayers(this.layoutModel.layers)}refreshVirtualLayout(){this.virtualLayout.resetLayers(this.layoutModel.layers),this.setMinRootItems()}removeBlocks(t){this.virtualLayout.initLayers(this.layoutModel.layers),this.refreshVirtualToolbar(),this.layoutModel.updateCheckpoints(!0)}orderBlock(t){this.virtualLayout.orderBlock(t.id,t.index),this.setMinRootItems(),this.updateAllRealLayers(!0),this.orderAllRealLayers()}updateBlockSize(t,e){this.refreshVirtualLayout(),e&&this.virtualToolbar.copyToolbar();let i=!1;var s;i=t.isTitle?this.virtualLayout.updateBlock(t,this.checkIfIsInMinRootItems(t.id),(s=ct,Object.keys(s).filter((t=>Number.isNaN(Number(t)))).map((t=>s[t]))))||i:this.renderVirtualInLayers(t)||i,this.updateAllRealLayers(i)}renderVirtualInLayers(t){let e=!1;for(const i of this.virtualLayout.layers){i.type===ct.NoText?this.virtualToolbar.applyNoTextLayer():this.virtualToolbar.applyFullLayer();const s=this.renderVirtualResizeModel(t);e=i.updateBlock(s,this.checkIfIsInMinRootItems(t.id))||e}return e}renderVirtualResizeModel(t){const e=this.virtualToolbar.getElementWidth(t.id);return{id:t.id,width:e}}getAffectedItemIds(t,e,i){const s=t.slice(0,e),o=t.slice(0,i);return i>e?o.filter((t=>!s.includes(t))):s.filter((t=>!o.includes(t)))}updateAllRealLayers(t){for(const t of this.virtualLayout.layers)this.layoutModel.updateFromVirtualLayer(t);this.layoutModel.updateCheckpoints(t)}orderAllRealLayers(){for(const t of this.virtualLayout.layers)this.layoutModel.orderFromVirtualLayer(t);this.layoutModel.updateCheckpoints(!0)}refreshVirtualToolbar(){this.virtualToolbar.copyToolbar()}checkIfIsInMinRootItems(t){return this.minRootItemIds.includes(t)}}class Bt{constructor(t,e,i,s,o,r,n,l){this.id=t,this.index=e,this.adaptivePriority=i,this.minWidth=s,this.maxWidth=o,this.margin=r,this.isTitle=n,this.isEllipse=l}get fullSize(){return this.maxWidth}get minSize(){return this.minWidth}}const Rt=!1,Wt="data-dxtoolbar-group-id",Nt=".dxbl-btn-toolbar",Pt=".dxbl-image:not(.dxbl-toolbar-dropdown-toggle)",At=".dxbl-image.dxbl-toolbar-dropdown-toggle",Ht="data-dxtoolbar-id",Vt=1;function _t(t,i=!1,s=!1){if(!t)return 0;let o=Math.ceil(n(t)+(i?0:zt(t)));if(t.parentElement&&!s){const i=[...t.parentElement.children].find((t=>t.classList.contains(y.ToolbarGroupSeparator)));if(t.parentElement.lastElementChild===t){const i=e.DomUtils.getCurrentStyle(t.parentElement);o+=e.DomUtils.pxToInt(i.marginRight)}if(t.parentElement.firstElementChild===i&&i.nextElementSibling===t){const s=i;if(s){const i=e.DomUtils.getCurrentStyle(t.parentElement),r=e.DomUtils.getCurrentStyle(s);o+=0!==s.offsetWidth?s.offsetWidth:Vt+e.DomUtils.pxToInt(i.marginLeft)+e.DomUtils.pxToInt(r.marginRight)}}if(t.parentElement.firstElementChild===t){const i=e.DomUtils.getCurrentStyle(t.parentElement);o+=e.DomUtils.pxToInt(i.marginLeft)}}return o}function qt(t){return[t.item.text,t.item.isDisplayed,t.item.iconCssClass]}function zt(t){return l(t)}function Dt(t){return e.DomUtils.hasClassName(t,"popout")}function Ut(t){return"absolute"!==e.DomUtils.getCurrentStyle(t).position}function jt(t,e){return`[${t}=${e}]`}function Ot(t,e){return[...new Set(t)].map((t=>new Bt(t.block.id,t.block.index,t.block.adaptivePriority,t.getMinWidth(),t.getMaxWidth(e),t.blockCollection.margins,t.block instanceof F,t.block instanceof j)))}class Ft{constructor(t){this.items=t}}class Kt extends CustomEvent{constructor(t){super(Kt.eventName,{detail:new Ft(t),bubbles:!0})}}Kt.eventName="dxbl-toolbar.update",f.register(Kt.eventName,(t=>t.detail));class Gt{constructor(t){this.item=t}}class $t extends CustomEvent{constructor(t){super($t.eventName,{detail:new Gt(t),bubbles:!0})}}$t.eventName="dxbl-toolbar-item.update";class Jt{constructor(t,e=!1){this.size=t,this.force=e}}class Qt extends CustomEvent{constructor(t,e=!1){super(Qt.eventName,{detail:new Jt(t,e),bubbles:!0})}}Qt.eventName="dxbl-toolbar-item.resized";class Xt extends CustomEvent{constructor(t){super(Xt.eventName,{detail:{visible:t},bubbles:!0})}}Xt.eventName="dxbl-toolbar-item.visibility-changed";class Yt{constructor(t){this.item=t}}class Zt extends CustomEvent{constructor(t){super(Zt.eventName,{detail:new Yt(t),bubbles:!0,composed:!0})}}Zt.eventName="dxbl-toolbar-item.ordered";const te=[".dxbl-btn:not([disabled]):not(.dxbl-toolbar-hidden-item)",".dxbl-btn-split:not([disabled]):not(.dxbl-toolbar-hidden-item)",".dxbl-toolbar-item-tmpl"].map((t=>`.dxbl-toolbar-menu-item > ${t}`)).join(",");class ee extends p{constructor(t,e,i){super(t,e,te,i)}switchToNestedContent(){return!this.isSplitButtonMenuItem(this.selectedItemElement)&&super.switchToNestedContent()}doAction(t){if(this.isSplitButtonMenuItem(this.selectedItemElement)){const e=this.selectedItemElement.querySelector(".dxbl-dropdown-item.dxbl-btn");if(e)return void this.doClick(e,t)}super.doAction(t)}isSplitButtonMenuItem(t){return C(t,he)}}var ie,se;!function(t){t[t.Header=0]="Header",t[t.Body=1]="Body"}(ie||(ie={})),function(t){t[t.Shown=0]="Shown",t[t.Closed=1]="Closed"}(se||(se={}));class oe extends N{constructor(t,e,i){super(t,e),this._dispatcherAction=new A,this._activeSection=null,this._initialized=null,this._focusSemaphore=new L,this._parentStrategy=i,this._sectionElementMap={[ie.Header]:null,[ie.Body]:null},this._modalStatusSignal=new P}get headerElement(){return this._sectionElementMap[ie.Header]}set headerElement(t){this._sectionElementMap[ie.Header]=t}get bodyElement(){return this._sectionElementMap[ie.Body]}set bodyElement(t){this._sectionElementMap[ie.Body]=t}initialize(){this._initialized=this.initializeCore()}initializeCore(){return super.initialize(),this.headerElement&&this.bodyElement?Promise.resolve():this.shcheduleInitialization()}shcheduleInitialization(){return this._dispatcherAction.cancel(),new Promise((t=>{this._dispatcherAction.execute((()=>{super.initialize(),t()}))}))}queryItems(){return this.headerElement=this.targetElement.querySelector(".dxbl-modal-header"),this.bodyElement=this.targetElement.querySelector(".dxbl-modal-body"),[this.headerElement,this.bodyElement]}async activate(){var t;await this._initialized,H.cancelRestoreFocus();const e=null!==(t=this._activeSection)&&void 0!==t?t:ie.Body;this.setActiveSection(e)}createItemStrategy(t){return t===this.headerElement?new re(this.navigator,this.headerElement):t===this.bodyElement?new ne(this.navigator,this.bodyElement,this._parentStrategy,this._focusSemaphore,this._modalStatusSignal):null}handleKeyDown(t){return k.KeyUtils.getEventKeyCode(t)===k.KeyCode.Tab?(this.setActiveSection(this.toggleActiveSection()),!0):super.handleKeyDown(t)}toggleActiveSection(){return this._activeSection===ie.Body?ie.Header:ie.Body}setActiveSection(t){const e=null!=t?t:ie.Body,i=this.navigator.getStrategy(this._sectionElementMap[e]);this._focusSemaphore.doAllowedAction((()=>{null==i||i.activate()})),this._activeSection=e}onPopupShown(){super.onPopupShown(),this._modalStatusSignal.raise(this.targetElement,se.Shown)}onPopupClosed(){super.onPopupClosed(),this._modalStatusSignal.raise(this.targetElement,se.Closed)}}class re extends I{initialize(){super.initialize(),this.selectedItemIndex=0}queryItems(){return this.queryItemsBySelector(".dxbl-btn").filter((t=>t&&!C(t,"dxbl-invisible")))}handleKeyDown(t){switch(k.KeyUtils.getEventKeyCode(t)){case k.KeyCode.Enter:case k.KeyCode.Space:return this.raiseClickEvent(this.selectedItemElement,t.ctrlKey,t.metaKey,t.shiftKey),!0;case k.KeyCode.Left:return this.moveToPrevItem(!0),!0;case k.KeyCode.Right:return this.moveToNextItem(!0),!0;case k.KeyCode.Up:case k.KeyCode.Down:return!0;default:return super.handleKeyDown(t)}}}class ne extends ee{constructor(t,e,i,s,o){super(t,e,i),this._boundModalStatusChanged=this.modalStatusChanged.bind(this),this._levelController=new T,this._focusSemaphore=s,this._modalStatusSignal=o,this._modalStatusSignal.subscribe(this._boundModalStatusChanged)}get menuLevel(){return this._levelController.currentLevel}modalStatusChanged(t,e){e===se.Shown?this.onPopupShown():this.onPopupClosed()}initialize(){super.initialize(),this._levelController.updateState(this.selectedItemIndex,this.itemCount),this.selectedItemIndex=this._levelController.selectedItemIndex}activate(){this._focusSemaphore.doIfAllowed((()=>{super.activate()})),this._focusSemaphore.disallow()}handleLeftKey(t){return this.menuLevel>0?(this.moveToPrevLevel(t),!0):!!S(this.selectedItemElement)&&(this.moveToNextLevel(t,w.Last),!0)}handleRightKey(t){return!!S(this.selectedItemElement)&&(this.moveToNextLevel(t,w.First),!0)}doAction(t){S(this.selectedItemElement)&&this.moveToNextLevel(t,w.First),super.doAction(t)}moveToNextLevel(t,e){this.performShortcutEvent(t),this._levelController.moveToNextLevel(e),this._focusSemaphore.allow()}moveToPrevLevel(t){this.performShortcutEvent(t),this._levelController.moveToPrevLevel(),this._focusSemaphore.allow()}getShortcutContext(){return{level:this.menuLevel,selectedItemIndex:this.selectedItemIndex}}handlePopupClosed(){super.handlePopupClosed(),this._levelController.clearState()}addEventSubscriptions(){}removeEventSubscriptions(){this._modalStatusSignal.unsubscribe(this._boundModalStatusChanged)}}const le=":scope > .dxbl-btn-toolbar:not(.dxbl-virtual-toolbar)",ae=[...[".dxbl-btn:not([disabled]):not(.dxbl-toolbar-hidden-item)",".dxbl-btn-split:not([disabled]):not(.dxbl-toolbar-hidden-item) > .dxbl-btn",".dxbl-toolbar-item-tmpl"].map((t=>`${le} .dxbl-toolbar-item[visible] > ${t}`)),`${le} .dxbl-toolbar-btn-ellipsis[visible]:not([disabled]):not(.dxbl-toolbar-hidden-item) > .dxbl-btn`].join(","),de="dxbl-btn-split-dropdown",he="dxbl-btn-split",ue=`.${he}`;class ce extends E{queryItems(){return this.queryItemsBySelector(ae)}getShortcutContext(){return{itemIndex:this.selectedItemIndex}}handleKeyDownCore(t){switch(k.KeyUtils.getEventKeyCode(t)){case k.KeyCode.Right:return this.subMenuStrategy||this.moveToNextItem(!0),!0;case k.KeyCode.Left:return this.subMenuStrategy||this.moveToPrevItem(!0),!0;case k.KeyCode.Home:return this.selectItem(0),!0;case k.KeyCode.End:return this.selectItem(this.itemCount-1),!0;case k.KeyCode.Up:if(t.altKey){if(this.isMenuExpanded())return this.requestSubMenuClose(),!0}else if(this.subMenuStrategy)return this.subMenuStrategy.focusLastItem(),!0;return!1;case k.KeyCode.Down:if(t.altKey){if(this.hasMenu())return this.requestSubMenuOpen(),this.focusSubMenuItemAsync(w.First),!0}else if(this.subMenuStrategy)return this.subMenuStrategy.focusFirstItem(),!0;return!1;case k.KeyCode.Tab:return!this.nestedContentSelected&&(this.requestSubMenuClose(),t.shiftKey?this.leaveBackward():this.leaveForward(),!0);case k.KeyCode.Enter:case k.KeyCode.Space:return this.hasMenu()&&this.focusSubMenuItemAsync(w.First),!1;default:return!1}}focusSubMenuItemAsync(t){return this.shouldRestoreFocus=M(this.targetElement),super.focusSubMenuItemAsync(t)}hasMenu(){return S(this.selectedItemElement)||C(this.selectedItemElement,de)}isMenuExpanded(){return B(this.selectedItemElement)||C(this.selectedItemElement,de)&&B(this.selectedItemElement.closest(ue))}requestSubMenuOpen(){var t;null===(t=this.selectedItemElement)||void 0===t||t.dispatchEvent(new R(W.Expand))}requestSubMenuClose(){var t;null===(t=this.selectedItemElement)||void 0===t||t.dispatchEvent(new R(W.Collapse))}createPopupStrategy(t,e){return new ee(t,e,this)}createModalStrategy(t,e){return new oe(t,e,this)}}const me=new class{constructor(){this.toolbars=new Map}addToolbar(t){this.toolbars.set(t.id,t)}removeToolbar(t){this.toolbars.delete(t.id)}addToolbarItem(t){const e=this.getToolbar(t.id);e&&e.addItem(t)}removeToolbarItem(t){for(const e of this.toolbars.values())e.removeItem(t)}getToolbar(t){const e=document.querySelector(`#${t}`);if(!e)return;const i=e.closest(`.${y.Toolbar}`);return i?this.toolbars.get(i.id):void 0}};let pe=class extends v{constructor(){super(...arguments),this.isLoading=!0,this.isLayoutCalculated=!1,this.model=null,this._keyboardNavigator=null,this.layoutModel=null,this.minWidth=null,this.reinitRequested=!1,this.items=[],this.toolbarItemResizedHandler=this.resizeToolbarItem.bind(this),this.toolbarItemUpdatedHandler=this.updateToolbarItem.bind(this),this.toolbarItemVisibilityChangedHandler=this.toolbarItemVisibilityChanged.bind(this),this.toolbarItemOrderHandler=this.orderToolbarItem.bind(this),this.toolbarTitle="",this.minRootItemCount=0,this.collapseItemsToIcons=!1,this.hideRootItems=!1,this.itemSize=0,this.renderMode=mt.Contained,this.itemSpacingMode=pt.Default,this.ellipsisId=null,this.layoutUpdateService=null}connectedCallback(){super.connectedCallback(),me.addToolbar(this),this.addEventListener(Qt.eventName,this.toolbarItemResizedHandler),this.addEventListener($t.eventName,this.toolbarItemUpdatedHandler),this.addEventListener(Xt.eventName,this.toolbarItemVisibilityChangedHandler),this.addEventListener(Zt.eventName,this.toolbarItemOrderHandler)}disconnectedCallback(){this.removeEventListener(Qt.eventName,this.toolbarItemResizedHandler),this.removeEventListener($t.eventName,this.toolbarItemUpdatedHandler),this.removeEventListener(Xt.eventName,this.toolbarItemVisibilityChangedHandler),this.removeEventListener(Zt.eventName,this.toolbarItemOrderHandler),me.removeToolbar(this),super.disconnectedCallback()}updated(t){var e,i,s,o;super.updated(t),t.has("ellipsisId")&&this.initializeToolbar(null!=this.ellipsisId),t.has("collapseItemsToIcons")&&(null===(e=this.layoutUpdateService)||void 0===e||e.updateCanCollapseToIcons(this.collapseItemsToIcons)),t.has("hideRootItems")&&(null===(i=this.layoutUpdateService)||void 0===i||i.updateCanHideRootItems(this.hideRootItems)),t.has("minRootItemCount")&&(this.model&&(this.model.minRootItems=this.minRootItemCount),null===(s=this.layoutUpdateService)||void 0===s||s.updateMinRootItems(this.minRootItemCount)),t.has("renderMode")&&(null===(o=this.layoutUpdateService)||void 0===o||o.updateRenderMode(this.renderMode))}updateLayout(){var t;null===(t=this.layoutModel)||void 0===t||t.updateLayout()}addItem(t){var e,i,s,o;if(t.isEllipse)return;if(!(null===(i=null===(e=this.model)||void 0===e?void 0:e.items)||void 0===i?void 0:i.find((e=>e.id===t.id)))&&this.model){const e=this.initItem(t,!0),i=this.getItemsBlocks(this.model,[e]);null===(s=this.layoutModel)||void 0===s||s.addItemBlock(i[0])}t&&!this.items.some((e=>e.id===t.id))&&(this.items.push(t),null===(o=this.layoutUpdateService)||void 0===o||o.addBlock(t))}removeItem(t){var e,i,s,o;const r=null===(e=this.model)||void 0===e?void 0:e.items.find((e=>e.id===t.id));if(r&&this.model){const t=this.model.items.indexOf(r);null===(i=this.model)||void 0===i||i.items.splice(t,1),null===(s=this.layoutModel)||void 0===s||s.removeItemBlock(r.id),null===(o=this.layoutUpdateService)||void 0===o||o.removeBlocks([r.id])}}resizeToolbarItem(t){this.processToolbarItem(t.detail.size,t.detail.force)}updateToolbarItem(t){this.processToolbarItem(t.detail.item)}toolbarItemVisibilityChanged(t){this.initializeKeyboardNavigator()}initializeKeyboardNavigator(){this._keyboardNavigator&&(this._keyboardNavigator.initialized?this._keyboardNavigator.reinitialize():this._keyboardNavigator.initialize(this,new ce(this._keyboardNavigator,this)))}orderToolbarItem(t){var e;const i=t.detail.item,s=this.items.find((t=>t.id===i.id));s&&(s.index=i.index,null===(e=this.layoutUpdateService)||void 0===e||e.orderBlock(i))}processToolbarItem(t,e=!1){var i;if(0===this.offsetHeight)return;const s=this.items.find((e=>e.id===t.id));s&&(s.width!==t.width||e)&&(s.width=t.width,"none"!==window.getComputedStyle(this).display&&(t.isEllipse||null===(i=this.layoutUpdateService)||void 0===i||i.updateBlockSize(t,!0)))}initializeToolbar(t){const e={mainElement:this,canCollapseToIcons:this.collapseItemsToIcons,canHideRootItems:this.hideRootItems,minRootItems:this.minRootItemCount,title:this.toolbarTitle,items:this.items,itemSize:this.itemSize,renderMode:this.renderMode,itemSpacingMode:this.itemSpacingMode,adaptiveMenuModel:{id:this.ellipsisId}};t?this.reinit(e):this.init(e)}initItem(t,e=!1){const i=document.querySelector(`#${t.id}[dxbl-toolbar-adaptive-item]`);const s=this.model.groupMap;i&&i.classList.remove(y.ToolbarHiddenItem);const o=r(i,jt(Wt,this.dataset.dxtoolbarId));let n=null;s.has(o)&&(n=s.get(o)),n||(n=new Lt(o,this.model),s.set(o,n));const l=new kt(i,this.model,n);return l.text.update(t.text),l.groupName.update(t.groupName),l.adaptivePriority.update(t.adaptivePriority),l.iconCssClass.update(t.iconCssClass),l.isDisplayed.update(t.visible),l.index.update(t.index),l.id=t.id,this.model.itemMap.set(l.id,l),this.model.items.every((t=>t.id!==l.id))&&(n.addItem(l),this.model.items.push(l)),l}init(t){var s;const o=t.mainElement;if(!o)return;this.isLayoutCalculated=!1;const r=o.dataset.dxtoolbarId,n=jt("data-dxtoolbar-title-id",r),l=jt("data-dxtoolbar-ellipsis-id",r),d=document.querySelector(l),h=this.model=new St(o,r),u=h.groupMap;Array.from(t.items).forEach((t=>this.initItem(t))),h.canHideRootItems=t.canHideRootItems,h.canCollapseToIcons=t.canCollapseToIcons,h.minRootItems=t.minRootItems,h.itemSize=t.itemSize,h.renderMode=t.renderMode,h.itemSpacing=t.itemSpacingMode;const c=new K([]),m=new Tt(h,n);m.text.update(t.title),h.title=m;const p=document.querySelector(n);c.add(new F(h,m,null!==(s=null==p?void 0:p.id)&&void 0!==s?s:"-1"));const b=Array.from(u.values()),g=b.some((t=>t))?b.map((t=>t.items)).reduce(((t,e)=>t.concat(e))):[];c.addRange(this.getItemsBlocks(h,g.filter((t=>t.element))));const v=new Ct(d,h);v.id=t.adaptiveMenuModel.id,c.add(new j(h,v)),h.ellipsisViewModel=v,this._keyboardNavigator=this.querySelector(x),this.initializeKeyboardNavigator();const f=Z.contextItem(c),I=this.layoutModel=new yt((t=>{this.isLayoutCalculated||(this.isLayoutCalculated=!0,i((()=>{this.updateToolbarHeight(),this.isLoading=!1})));const s=h.element.querySelector(Nt)||h.element;if(t.stateName.indexOf(y.ToolbarNoItemText)>-1?e.DomUtils.addClassName(s,y.ToolbarNoItemText):e.DomUtils.removeClassName(s,y.ToolbarNoItemText),e.DomUtils.removeClassName(o,y.Loading),a(o))return;const r=h.items.concat(h.ellipsisViewModel).map((t=>({Id:t.id,IsVisible:t.isVisible.value})));this.dispatchEvent(new Kt(Array.from(r)))}));I.setDefaultLayer((function(t){switch(t.getName()){case"item":return Z.fullWidthItem;case"title":return Z.titleItem}return Z.hiddenItem}),!0),I.setSequentialTransitionLayer(y.ToolbarHasEllipsis,ct.FullSequential,(function(t){switch(t.getName()){case"ellipsis":return Z.fullWidthSystemItem;case"item":return f}}),h.canHideRootItems&&(h.minRootItems>0||!h.canCollapseToIcons)),I.setSimultaneousTransitionLayer(y.ToolbarNoItemText,(function(t){switch(t.getName()){case"item":return Z.noTextItem;case"ellipsis":return Z.hiddenItem}}),h.canCollapseToIcons),I.setSequentialTransitionLayer(h.canCollapseToIcons?`${y.ToolbarNoItemText} ${y.ToolbarHasEllipsis}`:y.ToolbarHasEllipsis,ct.NoTextSequential,(function(t){switch(t.getName()){case"item":return f;case"ellipsis":return Z.fullWidthSystemItem}}),h.canHideRootItems&&h.canCollapseToIcons),c.forEach((t=>t._width=t.getWidth())),I.initialize(c,h.element.querySelector(Nt)||h.element,(t=>{this.height!==t.height&&(this.isLayoutCalculated=!1,this.height=t.height),this.checkUpdateMinWidth(h)})),I.toolbarWidthUpdate=()=>this.checkUpdateMinWidth(h),I.toolbarHeightUpdate=t=>this.updateToolbarHeight(),I.toolbarIsVisible=()=>"none"!==window.getComputedStyle(this).display&&0!==this.offsetWidth,setTimeout((()=>{document.querySelector(`#${this.id}`)&&(this.layoutUpdateService=new Mt(I,{canCollapseToIcons:this.collapseItemsToIcons,canHideRootItems:this.hideRootItems,minRootItems:this.minRootItemCount,renderMode:this.renderMode},this.getAttribute(Ht)))}))}reinit(t){this.reinitRequested||(this.reinitRequested=!0,d((()=>{this.resetToDefault(),this.disposeModel(),d((()=>{this.reinitRequested=!1,this.init(t)}))})))}resetToDefault(){var t;null===(t=this.layoutModel)||void 0===t||t.resetToDefault()}updateSettings(){}oldUpdateSettings(t){var e,i;if(!this.model)return;let s=!1,o=!1;if(this.model.canHideRootItems!==t.canHideRootItems&&(this.model.canHideRootItems=t.canHideRootItems,s=!0),this.model.canCollapseToIcons!==t.canCollapseToIcons&&(this.model.canCollapseToIcons=t.canCollapseToIcons,s=!0),this.model.minRootItems!==t.minRootItems&&(this.model.minRootItems=t.minRootItems,o=!0),this.model.itemSize!==t.itemSize&&(this.model.itemSize=t.itemSize,o=!0),this.model.renderMode!==t.renderMode&&(this.model.renderMode=t.renderMode,o=!0),this.model.itemSpacing!==t.itemSpacingMode&&(this.model.itemSpacing=t.itemSpacingMode,o=!0),null===(e=this.model.title)||void 0===e||e.text.update(t.title),!o){const e=Array.from(t.items).map((t=>t.id)),i=Array.from(this.model.itemMap.values()).map((t=>t.id));o=!((r=e).length===(n=i).length&&r.every(((t,e)=>t===n[e])))}var r,n;o?this.reinit(t):(Array.from(t.items).forEach((t=>{if(!this.model)return;const e=this.model.itemMap.get(t.id);e&&(e.text.update(t.text),e.groupName.update(t.groupName),e.adaptivePriority.update(t.adaptivePriority),e.index.update(t.index),e.iconCssClass.update(t.iconCssClass),e.isDisplayed.update(t.visible))})),s&&(null===(i=this.layoutModel)||void 0===i||i.forceUpdate()))}disposeModel(){var t;null===(t=this.layoutModel)||void 0===t||t.dispose()}dispose(){this.disposeModel()}getItemsBlocks(t,e){return e.reduce(((e,i)=>e.group&&e.group.tryAddItem(i)?e:i.groupName.value?{group:e.blocks[e.blocks.length]=new O(t,i),blocks:e.blocks}:{group:null,blocks:e.blocks.concat([new U(t,i)])}),{blocks:[],group:null}).blocks.sort((function(t,e){return t.item.adaptivePriority.value-e.item.adaptivePriority.value})).map((function(t,e){return t.index=e,t}))}updateToolbarHeight(){const t=this.querySelector(Nt);this.style.height=(!this.isLoading&&t?t.offsetHeight:this.offsetHeight)+"px"}checkUpdateMinWidth(t){var e;const i=null===(e=this.layoutModel)||void 0===e?void 0:e.getMinWidth();i&&this.minWidth!==i&&(this.minWidth=i,t.element.style.minWidth=i+"px")}};t([V()],pe.prototype,"layoutModel",void 0),t([V()],pe.prototype,"items",void 0),t([_({type:String,attribute:"toolbar-title"})],pe.prototype,"toolbarTitle",void 0),t([_({type:Number,attribute:"min-root-item-count"})],pe.prototype,"minRootItemCount",void 0),t([_({type:Boolean,attribute:"auto-collapse-items-to-icons"})],pe.prototype,"collapseItemsToIcons",void 0),t([_({type:Boolean,attribute:"auto-hide-root-items"})],pe.prototype,"hideRootItems",void 0),t([_({type:Number,attribute:"item-size"})],pe.prototype,"itemSize",void 0),t([_({type:mt,attribute:"render-mode"})],pe.prototype,"renderMode",void 0),t([_({type:pt,attribute:"item-spacing-mode"})],pe.prototype,"itemSpacingMode",void 0),t([_({type:String,attribute:"ellipsis-id"})],pe.prototype,"ellipsisId",void 0),pe=t([q(y.Toolbar)],pe);const ye=new Map,be=new ResizeObserver((t=>{for(const e of t){const t=e.target;t&&t.updateSize()}}));let ge=class extends v{constructor(){super(...arguments),this.text="",this.groupName="",this.adaptivePriority=0,this.iconCssClass="",this.visible=!1,this.index=0,this.justHidden=!1}get isEllipse(){return this.classList.contains(y.ButtonEllipsis)}get isTitle(){return this.classList.contains(y.ToolbarTitle)}get isPlaceholder(){return this.classList.contains(y.ToolbarPlaceholder)}get isHidden(){return"none"===this.style.display}update(t){t.has("text")&&this.updateSize(!0),t.has("visible")&&this.dispatchEvent(new Xt(this.visible)),t.has("index")&&this.itemOrdered(),super.update(t)}updateSize(t=!1){(!this.isHidden||this.justHidden||(this.justHidden=!0,t))&&(this.isHidden||!this.justHidden?this.dispatchEvent(new Qt({id:this.id,width:this.offsetWidth,isTitle:this.isTitle,isEllipse:this.isEllipse,isHidden:this.isHidden},t)):this.justHidden=!1)}connectedCallback(){super.connectedCallback(),me.addToolbarItem(this.toolbarItem),this.isEllipse||this.isPlaceholder||be.observe(this)}disconnectedCallback(){super.disconnectedCallback(),me.removeToolbarItem(this.toolbarItem),this.isEllipse||this.isPlaceholder||be.unobserve(this)}itemOrdered(){this.index>-1&&this.dispatchEvent(new Zt(this.toolbarItem))}get toolbarItem(){return{id:this.id,groupName:this.groupName,text:this.text,adaptivePriority:this.adaptivePriority,iconCssClass:this.iconCssClass,visible:this.visible,index:this.index,width:this.offsetWidth,isEllipse:this.isEllipse,isTitle:this.isTitle}}};function ve(t,e){return Promise.resolve("ok")}function fe(t){return e(t=h(t),ye),Array.from(ye.keys()).forEach((t=>{a(t)&&e(t,ye)})),Promise.resolve("ok");function e(t,e){if(!t)return;const i=t.querySelector(Nt);i&&u(i);const s=e.get(t);null==s||s.dispose(),e.delete(t)}}t([_({type:String,attribute:"text"})],ge.prototype,"text",void 0),t([_({type:String,attribute:"group-name"})],ge.prototype,"groupName",void 0),t([_({type:Number,attribute:"adaptive-priority"})],ge.prototype,"adaptivePriority",void 0),t([_({type:String,attribute:"icon-css-class"})],ge.prototype,"iconCssClass",void 0),t([_({type:Boolean,attribute:"visible"})],ge.prototype,"visible",void 0),t([_({type:Number,attribute:"index"})],ge.prototype,"index",void 0),ge=t([q(y.ToolbarItem)],ge),customElements.define("dxbl-toolbar-menu-item",class extends m{constructor(){super(...arguments),this.boundOnButtonClick=this.onButtonClick.bind(this)}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.boundOnButtonClick)}disconnectedCallback(){this.removeEventListener("click",this.boundOnButtonClick),super.disconnectedCallback()}canHandlePointerDown(t){return c.containsInComposedPath(t,this)}onButtonClick(t){if(null===this.getAttribute("submit-form-on-click"))return;const e=this.getAttribute("data-dxtoolbar-container-id");if(e){const t=document.querySelector(`[${Ht}=${e}]`);if(t){const e=document.createElement("input");e.type="submit",e.hidden=!0,t.appendChild(e),e.click(),t.removeChild(e)}}}});const Ie={init:ve,dispose:fe};export{pe as ToolbarComponent,ge as ToolbarItem,Ie as default,fe as dispose,ve as init};
