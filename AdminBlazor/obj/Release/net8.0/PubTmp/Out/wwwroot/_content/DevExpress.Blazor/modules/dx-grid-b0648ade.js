import{D as e}from"./dx-html-element-base-3bcbe019.js";import{C as t}from"./css-classes-f45f6949.js";import{H as n,T as i,b as s,a as o,c as r,d as l,e as a}from"./dx-html-element-pointer-events-helper-1bf230d1.js";import{DxUIHandlersBridgeTagName as d}from"./dx-ui-handlers-bridge-f9de17dd.js";import{b as h}from"./browser-f8f6e902.js";import{k as u}from"./key-fa0d8a82.js";import{S as c,D as m,V as g,a as C,b as p}from"./dx-scroll-viewer-0d4fe99f.js";import{S as f}from"./scroll-viewer-css-classes-6b178e01.js";import{S as b}from"./svg-utils-42e68e75.js";import{T as v}from"./transformhelper-ebad0156.js";import{d as E}from"./dom-e3fa5208.js";import{a as I,K as y,F as S}from"./dx-keyboard-navigator-38aff319.js";import{T as w,B as x}from"./dx-virtual-scroll-viewer-0d5749a3.js";import{a as R,R as D,D as N}from"./layouthelper-1d804c8c.js";import{u as P,o as H,D as T,v as W,q as B,w as F,S as M}from"./popup-a1c2390a.js";import{removeFocusHiddenAttribute as O,addFocusHiddenAttribute as A}from"./focus-utils-6f61e33c.js";import"./data-qa-utils-8be7c726.js";import"./eventhelper-8570b930.js";import"./constants-58283e53.js";import"./devices-9f03a976.js";import"./common-eb095e4d.js";import"./_tslib-6e8ca86b.js";import"./custom-events-helper-e7f279d3.js";import"./dispatcheraction-19309c7b.js";import"./dom-utils-751497ba.js";import"./thumb-3dd919b6.js";import"./point-e4ec110e.js";import"./rafaction-bba7928b.js";import"./positiontracker-d7595cd2.js";import"./branch-bf06b0d2.js";import"./property-d3853089.js";import"./custom-element-267f9a21.js";import"./lit-element-70cf14f4.js";import"./capturemanager-89a507c8.js";import"./logicaltreehelper-99f1adf9.js";import"./portal-9686dca9.js";import"./constants-058ebb50.js";import"./dx-ui-element-db9e89a3.js";import"./lit-element-base-7a85dca5.js";import"./nameof-factory-64d95f5b.js";import"./touch-167bb2e4.js";import"./disposable-d2c2d283.js";class K{}K.ClassName=t.Prefix+"-grid",K.DataTableClassName=K.ClassName+"-table",K.DataTableNoScrollClassName=K.DataTableClassName+"-no-scroll",K.TopPanelClassName=K.ClassName+"-top-panel",K.BottomPanelClassName=K.ClassName+"-bottom-panel",K.ToolbarContainerClassName=K.ClassName+"-toolbar-container",K.PagerPanelClassName="dxbl-pager-container",K.GroupPanelContentContainerClassName=K.ClassName+"-group-panel-container",K.SearchBoxContainerClassName=K.ClassName+"-search-box-container",K.SearchBoxClassName=K.ClassName+"-search-box",K.EmptyHeaderCellContentContainerClassName=K.ClassName+"-empty-header",K.GroupContentFreeSpaceClassName=K.ClassName+"-group-panel-free-space",K.HeaderRowClassName=K.ClassName+"-header-row",K.EditRowClassName=K.ClassName+"-edit-row",K.FilterRowClassName=K.ClassName+"-filter-row",K.GroupRowClassName=K.ClassName+"-group-row",K.FooterRowClassName=K.ClassName+"-footer-row",K.GroupFooterRowClassName=K.ClassName+"-group-footer-row",K.PagerRowClassName=K.ClassName+"-pager-row",K.EmptyRowClassName=K.ClassName+"-empty-row",K.ArmRowClassName=K.ClassName+"-arm-row",K.HeaderElementClassName=K.ClassName+"-header",K.HeaderContentClassName=K.ClassName+"-header-content",K.AllowDragClassName=K.ClassName+"-action",K.DraggableHeaderClassName=K.ClassName+"-draggable-header",K.SelectionCellClassName=K.ClassName+"-selection-cell",K.CommandCellClassName=K.ClassName+"-command-cell",K.FixedCellClassName=K.ClassName+"-fixed-cell",K.LastLeftFixedCellClassName=K.ClassName+"-last-fixed-left-cell",K.IndentCellClassName=K.ClassName+"-indent-cell",K.HeaderIndentCellClassName=K.ClassName+"-header-indent-cell",K.GroupFooterIndentCellClassName=K.ClassName+"-group-footer-indent-cell",K.ExpandButtonCellClassName=K.ClassName+"-expand-button-cell",K.DetailCellClassName=K.ClassName+"-detail-cell",K.EmptyDataRowCellClassName=K.ClassName+"-empty-data-area",K.EmptyCellClassName=K.ClassName+"-empty-cell",K.EditFormClassName=K.ClassName+"-edit-form",K.SelectedRowClassName=K.ClassName+"-selected-row",K.TouchSelectionClassName=K.ClassName+"-touch-selection",K.TouchSelectionEdgeClassName=K.ClassName+"-touch-selection-edge",K.MoveCursorCssClassName=K.ClassName+"-move-cursor",K.DraggingDownTargetClassName=K.ClassName+"-dragging-down-target",K.DraggingUpTargetClassName=K.ClassName+"-dragging-up-target",K.ColumnsResizeAnchorClassName=K.ClassName+"-column-resize-anchor",K.ColumnsSeparatorClassName=K.ClassName+"-columns-separator",K.HiddenEmptyCellClassName=K.ClassName+"-hidden-empty-cell",K.ColumnChooserItemClassName=K.ClassName+"-column-chooser-item",K.ColumnChooserDraggingItemClassName=K.ClassName+"-column-chooser-dragging-item",K.ColumnChooserDraggingItemNextSiblingClassName=K.ClassName+"-column-chooser-dragging-item-next-sibling",K.ColumnChooserItemDragAnchorClassName=K.ClassName+"-column-chooser-item-drag-anchor",K.ColumnChooserItemDragLockClassName=K.ClassName+"-column-chooser-item-drag-lock",K.HighlightedTextClassName=K.ClassName+"-highlighted-text",K.CalculateContentWidthsClassName=K.DataTableClassName+"-content-fit-calc";const z="dxbl-grid-header-content";class L{get previousColumnUid(){return this._previousColumnUid}get nextColumnUid(){return this._nextColumnUid}get nextVisibleColumnUid(){return this._nextVisibleColumnUid}constructor(e,t,n){this._previousColumnUid=e,this._nextColumnUid=t,this._nextVisibleColumnUid=n}}class U{get uID(){return this._uID}get allowGroup(){return this._allowGroup}get allowReorder(){return this._allowReorder}get dragRestrictions(){return this._dragRestrictions}get width(){return this._width}get minWidth(){return this._minWidth}get hasWidth(){return!!this._width}get isFreeWidth(){return!this.width&&!this.isIndent&&!this.isEmpty}get isPercentWidth(){return this.hasWidth&&-1!==this.width.indexOf("%")}get isAbsoluteWidth(){return this.hasWidth&&!this.isPercentWidth||this.isIndent}get colElementWidth(){return this._colElementWidth}set colElementWidth(e){this._colElementWidth=e}get isIndent(){return this._isIndent}get isEmpty(){return this._isEmpty}get isDetail(){return this._isDetail}get isEditable(){return this._isEditable}get fixedPosition(){return this._fixedPosition}constructor(e,t,n,i,s,o=!1,r=!1,l=!1,a=!1,d=!0,h=null){this._uID=e,this._allowGroup=t,this._allowReorder=d,this._dragRestrictions=h,this._width=n,this._colElementWidth=n,this._minWidth=i,this._isIndent=o,this._isEmpty=r,this._isDetail=l,this._isEditable=a,this._fixedPosition=s}getPercents(){return this.isPercentWidth?parseFloat(this.width.replace("%","")):0}updateWidth(e){this._width=e,this._colElementWidth=e}}var $,G,k;!function(e){e[e.ColumnsChanged=0]="ColumnsChanged",e[e.GridResize=1]="GridResize"}($||($={}));class V{constructor(e){this.grid=e}correctWidths(e){if(0===this.grid.columnsInfo.length)return!1;const t=this.grid.getDataTable();return!!t&&("fixed"===window.getComputedStyle(t).tableLayout&&(requestAnimationFrame((()=>{const t=this.grid.columnsInfo,n=this.grid.getColElements();if(e===$.ColumnsChanged&&V.resetColumnWidths(t,n),!V.canAcquireAbsoluteColumnWidths(this.grid))return;this.updateEmptyColumnVisibility();const i=new Map;for(let e=0;e<this.grid.columnsInfo.length;++e){const t=this.grid.columnsInfo[e];t.isAbsoluteWidth&&i.set(t,this.grid.getColElementOffsetWidth(e))}const s={columnsInfo:this.grid.columnsInfo,columnCurrentWidths:new Map,tableWidth:this.grid.getTableContainerWidth(),absoluteColumnWidths:i,percentColumns:this.grid.columnsInfo.filter((e=>e.isPercentWidth)),freeColumns:this.grid.columnsInfo.filter((e=>e.isFreeWidth)),emptyColumn:this.grid.columnsInfo.filter((e=>e.isEmpty))[0]};V.doDistributionWaves(s),V.applyColumnWidths(s,n),this.updateEmptyColumnVisibility(),this.grid.styleGenerator.updateFixedCellsStyle()})),!0))}autoFitColumnWidths(){const e=V.calculateContentWidths(this.grid);let t=0,n=0;for(const[i,s]of e)i.isIndent||(t+=s,i.isAbsoluteWidth&&(n+=s));const i=t-n,s=[],o=[];for(const[t,n]of e){const e=t.isPercentWidth||t.isFreeWidth?n/i*100+"%":`${n}px`;t.updateWidth(e),s.push(t.uID),o.push(e)}this.grid.notifyColumnsChanged(this.grid.columnsInfo),this.grid.onColumnWidthsChanged(s,o)}autoFitColumnWidthsLegacy(e=!1){const t=V.calculateContentWidths(this.grid);let n=0;for(const[e,i]of t)e.isIndent||(n+=i);const i=[],s=[];for(const[o,r]of t){const t=e?r/n*100+"%":`${r}px`;o.updateWidth(t),i.push(o.uID),s.push(t)}this.grid.notifyColumnsChanged(this.grid.columnsInfo),this.grid.onColumnWidthsChanged(i,s)}static calculateContentWidths(e){const t=new Map,n=e.getDataTable();if(n){n.classList.add(K.CalculateContentWidthsClassName);const i=e.getColElements();for(let n=0;n<i.length;n++){const i=e.columnsInfo[n];if(i&&-1!==i.uID){const s=e.getColElementOffsetWidth(n),o=s?Math.ceil(s)+1:0;t.set(i,o)}}n.classList.remove(K.CalculateContentWidthsClassName)}return t}updateEmptyColumnVisibility(){const e=this.grid.getColElements(),t=e[e.length-1];V.hasAnyDataColumnWithEmptyWidth(this.grid.columnsInfo,e)?t.classList.add(K.HiddenEmptyCellClassName):t.classList.remove(K.HiddenEmptyCellClassName)}static resetColumnWidths(e,t){for(let n=0;n<t.length;n++){const i=e[n];!i||i.isIndent||i.isEmpty||(t[n].style.width=i.width)}}static doDistributionWaves(e){let t=!1,n=0;do{V.performAllColumnsRealWidthCalculation(e),t=V.evaluateColumnMinWidthCorrection(e)}while(t&&++n<=e.columnsInfo.length)}static performAllColumnsRealWidthCalculation(e){e.columnCurrentWidths=new Map;const t=V.calculateAbsoluteColumnWidths(e);let n=Math.max(0,e.tableWidth-t);n=V.calculatePercentColumnWidths(e,n),n=V.calculateFreeColumnWidths(e,n),V.calculateEmptyColumnWidth(e,n)}static calculateAbsoluteColumnWidths(e){let t=0;for(const n of e.absoluteColumnWidths.keys()){const i=e.absoluteColumnWidths.get(n);t+=i,e.columnCurrentWidths.set(n,i)}return t}static calculatePercentColumnWidths(e,t){let n=0;for(const t of e.percentColumns)n+=t.getPercents();let i=e.tableWidth;const s=n>100?100/n:1,o=i*(n*s)/100;i*=t<o?t/o:1;let r=0;for(const t of e.percentColumns){const n=i*(t.getPercents()*s/100);e.columnCurrentWidths.set(t,n),r+=n}return t-r}static calculateFreeColumnWidths(e,t){if(e.freeColumns.length>0){const n=t/e.freeColumns.length;for(const t of e.freeColumns)e.columnCurrentWidths.set(t,n);return 0}return t}static calculateEmptyColumnWidth(e,t){e.emptyColumn&&e.columnCurrentWidths.set(e.emptyColumn,t)}static evaluateColumnMinWidthCorrection(e){const t=e.absoluteColumnWidths.size;for(const t of e.columnCurrentWidths.keys())e.columnCurrentWidths.get(t)>t.minWidth||0===t.minWidth||e.absoluteColumnWidths.set(t,t.minWidth);return e.percentColumns=e.percentColumns.filter((t=>!e.absoluteColumnWidths.has(t))),e.freeColumns=e.freeColumns.filter((t=>!e.absoluteColumnWidths.has(t))),t!==e.absoluteColumnWidths.size}static applyColumnWidths(e,t){for(let n=0;n<e.columnsInfo.length;++n){const i=e.columnsInfo[n];if(i.isIndent)continue;const s=e.absoluteColumnWidths.has(i)?`${e.absoluteColumnWidths.get(i)}px`:i.width;e.columnsInfo[n].colElementWidth=s,t[n].style.width=s}}static hasAnyDataColumnWithEmptyWidth(e,t){let n=0;for(let i=0;i<e.length;i++){const s=e[i];if(!s.isIndent&&!s.isEmpty&&(++n,!t[i].style.width))return!0}return 0===n}static canAcquireAbsoluteColumnWidths(e){for(let t=0;t<e.columnsInfo.length;++t){if(e.columnsInfo[t].isAbsoluteWidth&&null===e.getColElementOffsetWidth(t))return!1}return!0}}!function(e){e[e.Mouse=1]="Mouse",e[e.Keyboard=2]="Keyboard",e[e.DblClick=3]="DblClick"}(G||(G={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(k||(k={}));class _{get isResizing(){return!!this.resizeReason}get columnIndex(){return this._columnIndex}get columnsInfo(){return this.grid.columnsInfo}get tableContainerWidth(){return this._tableContainerWidth}get currentColumnInfo(){return this.columnsInfo[this.columnIndex]}constructor(e){this.startMousePosition=-1,this.startHeaderCellPosition=-1,this.timeoutId=null,this.initialColumnWidths=new Map,this.boundOnDocumentPointerMoveHandler=this.onPointerMove.bind(this),this.getColumnOffsetWidth=e=>this.grid.getColElementOffsetWidth(e),this.setColumnWidth=(e,t)=>{this.grid.getColElements()[e].style.width=t},this.grid=e,this.columnResizeSeparator=e.getColumnResizeSeparator()}startDrag(e,n){var i;this.initializeResizing(e),this.resizeReason=G.Mouse,this.startMousePosition=n,this.startHeaderCellPosition=this.getHeaderCellPosition(e),document.addEventListener("pointermove",this.boundOnDocumentPointerMoveHandler),document.body.classList.add(t.ResizeCursor),null===(i=this.grid.getScrollViewer())||void 0===i||i.startAutoScrolling(c.Horizontal,this.boundOnDocumentPointerMoveHandler)}autoFitColumnWidth(e){if(this.isResizing)return;const t=V.calculateContentWidths(this.grid).get(this.columnsInfo[e]);if(void 0!==t){this.resizeReason=G.DblClick,this.initializeResizing(e);const n=t-this.getColumnOffsetWidth(e),i=n>0?Math.ceil(n):Math.floor(n);this.performResize(i),requestAnimationFrame((()=>setTimeout((()=>this.finalizeResizing(!1)))))}}anchorFocused(e){this.resizeReason=G.Keyboard,this.initializeResizing(e)}anchorUnfocused(){this.finalizeResizing(!1)}stopDrag(){this.finalizeResizing(!1)}cancelDrag(){this.timeoutId&&clearTimeout(this.timeoutId),this.finalizeResizing(!0)}performMoveStep(e){if(this.resizeReason===G.Mouse)return;let t=e===k.Right?1:-1;this.isReverseResizing&&(t*=-1);const n=this.calculateDiffByMoveStep(t);this.performResize(n),this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout((()=>this.createNotificationAction()()),500)}initializeResizing(e){this.columnResizeSeparator=this.grid.getColumnResizeSeparator(),this._columnIndex=e,this._tableContainerWidth=this.grid.getTableContainerWidth(),this.initialColumnWidths.clear();const t=this.grid.getColElements();for(let e=0;e<t.length;++e)this.initialColumnWidths.set(e,t[e].style.width);this.initializeResizingCore();const n=this.getHeaderCell(e);this.columnResizeSeparator.show(n,this.isReverseResizing),this.grid.updateEmptyColumnVisibility()}performResize(e){var t;e=Math.round(e),this.performResizeCore(e),requestAnimationFrame((()=>this.grid.styleGenerator.updateFixedCellsStyle())),null===(t=this.columnResizeSeparator)||void 0===t||t.render()}finalizeResizing(e){var n,i;if(!this.resizeReason)return;this.resizeReason===G.Mouse&&(document.removeEventListener("pointermove",this.boundOnDocumentPointerMoveHandler),document.body.classList.remove(t.ResizeCursor),null===(n=this.grid.getScrollViewer())||void 0===n||n.stopAutoScrolling(),this.startMousePosition=-1,this.startHeaderCellPosition=-1),null===(i=this.columnResizeSeparator)||void 0===i||i.hide();let s=null;if(e){this.cancelResizeCore();const e=this.grid.getColElements();this.initialColumnWidths.forEach(((t,n)=>{t!==e[n].style.width&&(e[n].style.width=t)})),this.initialColumnWidths.clear(),requestAnimationFrame((()=>this.grid.styleGenerator.updateFixedCellsStyle()))}else s=this.createNotificationAction(),this.finalizeResizeCore();this.grid.updateEmptyColumnVisibility(),this.resizeReason=void 0,this._columnIndex=void 0,this._tableContainerWidth=void 0,this.timeoutId&&clearTimeout(this.timeoutId),s&&s()}createNotificationAction(){const e=this.applyResizingAndGetChangedColumns(),t=e.map((e=>e.uID)),n=e.map((e=>e.width));return()=>{this.grid.onColumnWidthsChanged(t,n)}}getHeaderCellPosition(e){return this.getHeaderCell(e).getBoundingClientRect().x}getHeaderCell(e){return this.grid.getHeaderRow().cells.item(e)}onPointerMove(e){const t=this.getHeaderCellPosition(this.columnIndex);let n=e.pageX-this.startMousePosition;if(this.isReverseResizing)n*=-1;else{n+=this.startHeaderCellPosition-t}this.performResize(n)}}class q extends _{constructor(){super(...arguments),this.columnInitialWidth=-1,this.columnNewWidth=-1,this.nextColumnInitialWidth=-1,this.nextColumnNewWidth=-1,this.nextColumnIndex=-1,this.totalPercents=0,this.totalFreeWidth=0}get nextColumnInfo(){return this.columnsInfo[this.nextColumnIndex]}get isReverseResizing(){return!1}calculateDiffByMoveStep(e){return this.columnNewWidth-this.columnInitialWidth+Math.min(5,Math.ceil((this.columnInitialWidth+this.nextColumnInitialWidth)/100))*e}initializeResizingCore(){this.columnInitialWidth=this.getColumnOffsetWidth(this.columnIndex),this.columnNewWidth=this.columnInitialWidth,this.nextColumnIndex=this.columnIndex+1,this.nextColumnInitialWidth=this.getColumnOffsetWidth(this.nextColumnIndex),this.nextColumnNewWidth=this.nextColumnInitialWidth;for(let e=0;e<this.columnsInfo.length;++e){const t=this.columnsInfo[e];t.isPercentWidth&&(this.totalPercents+=t.getPercents()),t.isFreeWidth&&(this.totalFreeWidth+=this.getColumnOffsetWidth(e))}}performResizeCore(e){this.columnNewWidth=this.columnInitialWidth+e,this.columnNewWidth<this.currentColumnInfo.minWidth&&(this.columnNewWidth=this.currentColumnInfo.minWidth),this.nextColumnNewWidth=this.columnInitialWidth+this.nextColumnInitialWidth-this.columnNewWidth;const t=this.columnInitialWidth+this.nextColumnInitialWidth-this.nextColumnInfo.minWidth;this.columnNewWidth>t&&(this.columnNewWidth=t,this.nextColumnNewWidth=this.nextColumnInfo.minWidth),requestAnimationFrame((()=>{this.isResizing&&(this.setColumnWidth(this.columnIndex,`${this.columnNewWidth}px`),this.setColumnWidth(this.nextColumnIndex,`${this.nextColumnNewWidth}px`))}))}cancelResizeCore(){this.reset()}applyResizingAndGetChangedColumns(){const e=[];if(this.currentColumnInfo.isPercentWidth||this.nextColumnInfo.isPercentWidth)return this.currentColumnInfo.isPercentWidth?this.calculateNewWidthsForPercentColumn(this.currentColumnInfo,this.columnNewWidth,this.columnInitialWidth,this.nextColumnInfo,this.nextColumnNewWidth,this.nextColumnInitialWidth):this.calculateNewWidthsForPercentColumn(this.nextColumnInfo,this.nextColumnNewWidth,this.nextColumnInitialWidth,this.currentColumnInfo,this.columnNewWidth,this.columnInitialWidth);{const t=0!==this.totalPercents,n=(this.currentColumnInfo.isFreeWidth||this.nextColumnInfo.isFreeWidth)&&!t;if((this.currentColumnInfo.isAbsoluteWidth||this.currentColumnInfo.isFreeWidth&&t)&&(this.currentColumnInfo.updateWidth(`${this.columnNewWidth}px`),e.push(this.currentColumnInfo)),n){const t=this.totalFreeWidth+(this.currentColumnInfo.isFreeWidth?this.columnNewWidth-this.columnInitialWidth:0)+(this.nextColumnInfo.isFreeWidth?this.nextColumnNewWidth-this.nextColumnInitialWidth:0);for(let n=0;n<this.columnsInfo.length;++n){const i=this.columnsInfo[n];i.isFreeWidth&&(i.updateWidth(100*this.getColumnOffsetWidth(n)/t+"%"),e.push(i))}}}return e.includes(this.nextColumnInfo)||(this.nextColumnInfo.updateWidth(`${this.nextColumnNewWidth}px`),e.push(this.nextColumnInfo)),e}calculateNewWidthsForPercentColumn(e,t,n,i,s,o){const r=[],l=(e,t,n)=>e*t/n,a=e.getPercents(),d=l(a,t,n);if(e.updateWidth(e.colElementWidth===e.width?`${d}%`:`${t}px`),r.push(e),i.isPercentWidth)i.updateWidth(`${l(i.getPercents(),s,o)}%`),r.push(i);else{i.updateWidth(`${s}px`),r.push(i);const t=this.totalPercents-a+d;if(t>100){const n=t/this.totalPercents;for(let t=0;t<this.columnsInfo.length;++t){const i=this.columnsInfo[t];i.isPercentWidth&&(i.updateWidth(i.getPercents()/n+"%"),i!==e&&r.push(i))}}}return r}finalizeResizeCore(){this.reset()}reset(){this.columnInitialWidth=-1,this.columnNewWidth=-1,this.nextColumnInitialWidth=-1,this.nextColumnNewWidth=-1,this.nextColumnIndex=-1,this.totalFreeWidth=0,this.totalPercents=0}}class j extends _{constructor(){super(...arguments),this.enforcedColumnWidths=new Map,this.columnInitialWidth=-1,this.columnNewWidth=-1}get isReverseResizing(){return"right"===this.currentColumnInfo.fixedPosition}calculateDiffByMoveStep(e){return this.columnNewWidth-this.columnInitialWidth+Math.min(5,Math.ceil(2*this.columnInitialWidth/100))*e}initializeResizingCore(){if(this.columnInitialWidth=this.getColumnOffsetWidth(this.columnIndex),this.columnNewWidth=this.columnInitialWidth,this.currentColumnInfo.fixedPosition){let e=this.tableContainerWidth;for(let t=0;t<this.columnsInfo.length;++t){const n=this.columnsInfo[t];n!==this.currentColumnInfo&&n.fixedPosition&&(e-=this.getColumnOffsetWidth(t))}this.columnMaxWidth=Math.max(this.columnInitialWidth,e)}this.enforcedColumnWidths.clear();for(let e=0;e<this.columnsInfo.length;++e){const t=this.columnsInfo[e];if(!t.isIndent&&!t.isEmpty&&!t.isAbsoluteWidth){const t=`${this.getColumnOffsetWidth(e)}px`;this.setColumnWidth(e,t),this.enforcedColumnWidths.set(e,t)}}}performResizeCore(e){let t=this.columnInitialWidth+e;t<this.currentColumnInfo.minWidth&&(t=this.currentColumnInfo.minWidth),this.columnMaxWidth&&t>this.columnMaxWidth&&(t=this.columnMaxWidth),this.columnNewWidth=t;const n=this.columnIndex;requestAnimationFrame((()=>{this.isResizing&&this.setColumnWidth(n,`${t}px`)}))}cancelResizeCore(){this.reset()}applyResizingAndGetChangedColumns(){const e=[],t=this.columnsInfo,n=t[this.columnIndex];return n.updateWidth(`${this.columnNewWidth}px`),e.push(n),this.enforcedColumnWidths.forEach(((i,s)=>{const o=t[s];o!==n&&(o.updateWidth(i),e.push(o))})),e}finalizeResizeCore(){this.reset()}reset(){this.columnInitialWidth=-1,this.columnNewWidth=-1,this.enforcedColumnWidths.clear(),this.columnMaxWidth=void 0}}class Y extends e{constructor(){super(),this.cell=null,this.leftSide=!1,this.parentWidth=0,this.tableContainerResizeObserver=new ResizeObserver(this.onTableContainerSizeChanged.bind(this)),this.boundOnTableContainerScroll=this.onTableContainerScroll.bind(this)}get tableContainer(){return this._tableContainer}initializeComponent(){super.initializeComponent(),this.initializeTableContainer(),this.tableContainer.addEventListener("scroll",this.boundOnTableContainerScroll),this.tableContainerResizeObserver.observe(this.tableContainer)}initializeTableContainer(){this._tableContainer=this.closest(`.${f.ContentContainerClassName}`)}disposeComponent(){super.disposeComponent(),this.tableContainer.removeEventListener("scroll",this.boundOnTableContainerScroll),this.tableContainerResizeObserver.unobserve(this.tableContainer)}show(e,t){this.cell=e,this.leftSide=t,this.classList.add(Y.ActiveColumnResizeSeparator),this.render()}hide(){this.cell=null,this.leftSide=!1,this.classList.remove(Y.ActiveColumnResizeSeparator),this.style.transform="none"}render(){requestAnimationFrame((()=>{if(!this.cell)return;const e=this.getColumnSeparatorPosition(this.cell),t=this.getBorderWidth(this.cell),n=Y.getCenteredByBorderPosition(e,this.offsetWidth,t),i=this.getActualHeight();this.style.transform=`translateX(${n})`,i>0&&(this.style.height=`${i}px`)}))}onTableContainerScroll(){this.render()}onTableContainerSizeChanged(e){const t=e[0].contentRect.width;this.parentWidth!==t&&(this.parentWidth=t,this.render())}getColumnSeparatorPosition(e){const t=e.offsetLeft-this.tableContainer.scrollLeft;return this.leftSide?t:t+e.offsetWidth}getActualHeight(){const e=this.tableContainer.querySelector(`.${K.DataTableClassName} > tfoot`);if(!e)return 0;const t=e.getBoundingClientRect().height;return this.tableContainer.getBoundingClientRect().height-t}getBorderWidth(e){var t;const n=Y.getBorderWidthByElement(e,"border-right-width");if(n>0)return n;const i=null===(t=this.cell)||void 0===t?void 0:t.nextElementSibling;return i&&Y.getBorderWidthByElement(i,"border-left-width")}static getBorderWidthByElement(e,t){const n=getComputedStyle(e),i=n.getPropertyValue(t);return parseFloat(i)||parseFloat(n.borderWidth)}static getCenteredByBorderPosition(e,t,n){return e-(t-n)/2+"px"}}var X,J,Q,Z,ee;Y.ActiveColumnResizeSeparator=t.Active,function(e){e[e.ItemMoving=0]="ItemMoving",e[e.Stop=1]="Stop",e[e.Cancel=2]="Cancel"}(X||(X={}));class te{constructor(e){this.boundOnDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.reorderContext=null,this.reorderingCallback=e}start(e,t,n){const i=e.map((e=>e.getBoundingClientRect())),s=e.map((e=>e.getAttribute("data-column-fixed-position"))),o=e.indexOf(t),r=t.parentElement,l=te.calculateReorderIntervals(i,o,s),a=te.findInterval(l,0);this.reorderContext={state:X.ItemMoving,startY:n.y,currentY:n.y,offsetParentStartY:te.calcOffsetParentY(r),offsetParent:r,draggingItemIndex:o,draggingItem:t,items:e,intervals:l,initialInterval:a,currentInterval:a},this.refreshUI(),document.addEventListener("pointermove",this.boundOnDocumentMouseMoveHandler)}stop(){this.end(X.Stop)}cancel(){this.end(X.Cancel)}end(e){null!=this.reorderContext&&(this.reorderContext.state=e,this.refreshUI(),document.removeEventListener("pointermove",this.boundOnDocumentMouseMoveHandler))}onDocumentMouseMove(e){null!=this.reorderContext&&(this.reorderContext.currentY=e.y,this.refreshUI())}refreshUI(){if(null==this.reorderContext)return;const e=this.reorderContext.offsetParentStartY-te.calcOffsetParentY(this.reorderContext.offsetParent),t=this.reorderContext.currentY-this.reorderContext.startY+e;let n=te.findInterval(this.reorderContext.intervals,t);this.reorderContext.state===X.Cancel&&(n=this.reorderContext.initialInterval),this.reorderContext.currentInterval=n,this.applyTransformations(t)}applyTransformations(e){requestAnimationFrame((()=>{if(null==this.reorderContext)return;const t=this.reorderContext.currentInterval;if(null==t)return;const n=this.reorderContext.state===X.ItemMoving&&e>=t.top&&e<=t.bottom;for(let i=0;i<t.transforms.length;i++){let s=t.transforms[i];i===this.reorderContext.draggingItemIndex&&n&&(s=e),this.reorderContext.items[i].style.transform="translate(0, "+s+"px)"}this.reorderingCallback(this.reorderContext.items,t.itemIndices,this.reorderContext.draggingItemIndex,this.reorderContext.state)}))}static calcOffsetParentY(e){return e.getBoundingClientRect().y-e.scrollTop}static calculateReorderIntervals(e,t,n){const i=te.calcIntervalBounds(e,t,n),s=Array.from(Array(e.length).keys());s.splice(t,1);const o=e[t].height,r=[];for(let e=0;e<i.length;e++){const n=i[e],l=Array.from(s);l.splice(n.itemIndex,0,t),r.push({top:n.top,bottom:n.bottom,itemIndices:l,transforms:this.calcItemsTransformations(l,o),itemIndex:n.itemIndex})}return r}static calcIntervalBounds(e,t,n){const i=Array.from(Array(e.length).keys()),s=n[t];let o=0!==t?i.slice(0,t).reverse():[],r=t!==i.length-1?i.slice(t+1):[];n.filter((e=>null!==e)).length>0&&(o=o.filter((e=>n[e]===s)),r=r.filter((e=>n[e]===s)));const l=this.calcIntervalBoundsCore(e,o),a=this.calcIntervalBoundsCore(e,r),d=[];l.reverse();for(let e=0;e<l.length;e++){const t=l[e];d.push({top:-1*t.bottom,bottom:-1*t.top,itemIndex:t.itemIndex})}return d.push({top:d.length>0?d[d.length-1].bottom+1:0,bottom:a.length>0?a[0].top-1:0,itemIndex:t}),d.concat(a)}static calcIntervalBoundsCore(e,t){if(0===t.length)return[];let n=0;const i=[];for(let s=0;s<t.length;s++){const o=e[t[s]].height;i.push(n+Math.ceil(o/2)),n+=o}i.push(n);const s=[];for(let e=0;e<i.length-1;e++)s.push({top:1+i[e],bottom:i[e+1],itemIndex:t[e]});return s}static calcItemsTransformations(e,t){const n=[];for(let i=0;i<e.length;i++){let s=0;const o=e.indexOf(i)-i;0!==o&&(s=t*o),n.push(s)}return n}static findInterval(e,t){for(let n=0;n<e.length;n++)if(t>=e[n].top&&t<=e[n].bottom)return e[n];return t<e[0].top?e[0]:t>e[e.length-1].bottom?e[e.length-1]:null}}class ne{}ne.VisibleIndexName="data-visible-index",ne.SummaryItem=K.ClassName+"-summary-item",ne.EditCell="data-edit-cell";class ie{static getBodyCellsSelector(e){return this.getDataTableBodySelector(e)+" > tr > td"}static getBodyEditRowSelector(e){return this.getDataTableBodySelector(e)+` > .${K.EditRowClassName}`}static getDataTableBodySelector(e){return`${Le}[${Ue}="${e}"] > .${f.ClassName} > .${f.ContentContainerClassName} > .${K.DataTableClassName} > tbody`}}ie.DataTableSelector=`.${K.DataTableClassName}`,ie.TableBodyRows=`.${K.DataTableClassName} > tbody > tr`,ie.TableCell=`${ie.TableBodyRows} > td`,ie.TableHeader=`.${K.DataTableClassName} > thead > tr > th`,ie.TableHeaderCell=`${ie.TableHeader} > ${K.HeaderContentClassName}`,ie.TableHeaderCellContent=`${ie.TableHeaderCell} span`,ie.TableGroupFooterCell=`${ie.TableBodyRows}.${K.GroupFooterRowClassName} > td`,ie.TableGroupFooterCellContent=`${ie.TableGroupFooterCell} > div[${ne.SummaryItem}]`,ie.TableFooterCell=`.${K.DataTableClassName} > tfoot > tr > td`,ie.TableFooterCellContent=`${ie.TableFooterCell} > div[${ne.SummaryItem}]`,ie.TableCellSelector=`.${K.DataTableClassName} > * > tr > td`,ie.TitleElementsSelector=[ie.TableCellSelector,ie.TableHeaderCellContent,ie.TableHeader,ie.TableFooterCellContent,ie.TableGroupFooterCellContent,ie.TableFooterCell].join(", "),ie.ColElementSelector=`:scope > .${f.ClassName} > .${f.ContentContainerClassName} > .${K.DataTableClassName} > colgroup > col`,ie.RowSelector=`:scope > * > tr:not(.${K.EmptyRowClassName}):not(.${K.ArmRowClassName}):not([${w}]):not([${x}])`,ie.HeaderRowSelector=`.${K.HeaderRowClassName}`,ie.FilterRowSelector=`.${K.FilterRowClassName}`,ie.EditRowSelector=`.${K.EditRowClassName}`,ie.EditFormRowCellSelector=`:scope > .${K.EditFormClassName}`,ie.GroupRowSelector=`.${K.GroupRowClassName}`,ie.DataRowSelector=`tr[${ne.VisibleIndexName}]:not(.${K.EditRowClassName}):not(.${K.GroupRowClassName})`,ie.EmptyDataRowCellSelector=`:scope > .${K.EmptyDataRowCellClassName}`,ie.DetailRowCellSelector=`:scope > .${K.DetailCellClassName}`,ie.FooterRowSelector=`.${K.FooterRowClassName}`,ie.GroupFooterRowSelector=`.${K.GroupFooterRowClassName}`,ie.KeyboardNavigatorSelector=`:scope > ${I}`,ie.ToolbarContainerSelector=`.${K.ToolbarContainerClassName}`,ie.TopPanelSelector=`.${K.TopPanelClassName}`,ie.PagerPanelSelector=`.${K.PagerPanelClassName}`;class se extends y{constructor(e,t){super(e.getKeyboardNavigator(),t),this.grid=e}canSwitchToNestedContentMode(){return!0}get editorManager(){return this.grid.editorManager}get isEditing(){return this.grid.isEditing}get isInplaceEditingEnabled(){return this.grid.enableInplaceEditing}get isFocusedRowEnabled(){return this.grid.enableFocusedRow}getToolbarContainer(){return this.grid.getToolbarContainer()}getDataTable(){return this.grid.getDataTable()}getPagerPanel(e){return this.grid.getPagerPanel(e)}getGroupPanelContentContainer(){return this.grid.getGroupPanelContentContainer()}getSearchBoxContainer(){return this.grid.getSearchBoxContainer()}getScrollViewer(){return this.grid.getScrollViewer()}getScrollViewerContent(){return this.grid.getScrollViewerContent()}getColumnUID(e){return this.grid.getColumnUID(e)}getColumnInfoByCell(e){return this.grid.getColumnInfoByCell(e)}}!function(e){e[e.None=0]="None",e[e.GroupPanel=1]="GroupPanel",e[e.DataTable=2]="DataTable",e[e.Pager=3]="Pager",e[e.ColumnChooser=4]="ColumnChooser",e[e.ToolbarContainer=5]="ToolbarContainer",e[e.SearchBox=6]="SearchBox"}(J||(J={})),function(e){e[e.None=0]="None",e[e.Header=1]="Header",e[e.Filter=2]="Filter",e[e.Edit=3]="Edit",e[e.EditForm=4]="EditForm",e[e.Group=5]="Group",e[e.Data=6]="Data",e[e.EmptyData=7]="EmptyData",e[e.Detail=8]="Detail",e[e.Footer=9]="Footer",e[e.GroupFooter=10]="GroupFooter"}(Q||(Q={})),function(e){e[e.Data=0]="Data",e[e.Edit=1]="Edit",e[e.Selection=2]="Selection",e[e.Command=3]="Command"}(Z||(Z={}));class oe{static getNavigationAreaType(e){return e.matches(ie.ToolbarContainerSelector)?J.ToolbarContainer:e.matches(ie.DataTableSelector)?J.DataTable:e.matches(ie.PagerPanelSelector)?J.Pager:e.matches(ie.TopPanelSelector)?J.GroupPanel:J.None}static getRowType(e){return e.matches(ie.HeaderRowSelector)?Q.Header:e.matches(ie.FilterRowSelector)?Q.Filter:e.matches(ie.EditRowSelector)?Q.Edit:e.querySelector(ie.EditFormRowCellSelector)?Q.EditForm:e.matches(ie.GroupRowSelector)?Q.Group:e.matches(ie.DataRowSelector)?Q.Data:e.querySelector(ie.EmptyDataRowCellSelector)?Q.EmptyData:e.querySelector(ie.DetailRowCellSelector)?Q.Detail:e.matches(ie.FooterRowSelector)?Q.Footer:e.matches(ie.GroupFooterRowSelector)?Q.GroupFooter:Q.None}static getCellType(e){return void 0!==e.dataset.editCell?Z.Edit:oe.isSelectionCell(e)?Z.Selection:oe.isCommandCell(e)?Z.Command:Z.Data}static isCommandCell(e){var t;return null!==(t=null==e?void 0:e.matches(`.${K.CommandCellClassName}`))&&void 0!==t&&t}static isExpandButtonCell(e){var t;return null!==(t=null==e?void 0:e.matches(`.${K.ExpandButtonCellClassName}`))&&void 0!==t&&t}static isSelectionCell(e){var t;return null!==(t=null==e?void 0:e.matches(`.${K.SelectionCellClassName}`))&&void 0!==t&&t}static isFixedCell(e){var t;return null!==(t=null==e?void 0:e.matches(`.${K.FixedCellClassName}`))&&void 0!==t&&t}static isSearchBoxContainer(e){return null==e?void 0:e.matches(`.${K.SearchBoxContainerClassName}`)}}class re{static isEditRowCell(e){return null!==e&&e.rowType===Q.Edit}static areIdentical(e,t){return null!==e&&null!==t&&(e.rowIndex===t.rowIndex&&e.columnInfo.uID===t.columnInfo.uID)}static fromElement(e,t){const n=re.getCellElement(e,t);if(null!==n){const t=re.getRowType(n),i=oe.getCellType(n),s=re.getCellRowIndex(n),o=e.getColumnInfoByCell(n);if(null!==t&&null!==i&&null!==s&&null!==o)return new re(i,t,s,o)}return null}static getCellElement(e,t){if(null===e.uId||null==t)return null;const n=t.closest(ie.getBodyCellsSelector(e.uId));if(null!==n)return n;const i=P.getPortalFrom(t);return null!==i?i.closest(ie.getBodyCellsSelector(e.uId)):null}static getRowType(e){if(null===e)return null;const t=e.parentElement;return null===t?null:oe.getRowType(t)}static getCellRowIndex(e){const t=null==e?void 0:e.parentElement;if(null!=t){const e=t.dataset.visibleIndex;if(void 0!==e)return parseInt(e)}return null}constructor(e,t,n,i){this._type=e,this._rowType=t,this._rowIndex=n,this._columnInfo=i}get type(){return this._type}get rowIndex(){return this._rowIndex}get rowType(){return this._rowType}get columnInfo(){return this._columnInfo}}class le{constructor(e){this.activePopup=null,this.pendingCommandId=null,this.boundOnDocumentFocusOutHandler=this.onDocumentFocusOut.bind(this),this.boundOnDocumentFocusInHandler=this.onDocumentFocusIn.bind(this),this.boundOnPopupShownHandler=this.onPopupShown.bind(this),this.boundOnPopupClosingHandler=this.onPopupClosing.bind(this),this.boundOnPopupClosedHandler=this.onPopupClosed.bind(this),this.grid=e}get isPendingCommandResult(){return null!==this.pendingCommandId}get isEditorPopupShown(){return null!==this.activePopup}initialize(){document.addEventListener("focusout",this.boundOnDocumentFocusOutHandler),document.addEventListener("focusin",this.boundOnDocumentFocusInHandler),document.addEventListener(H.eventName,this.boundOnPopupShownHandler)}dispose(){document.removeEventListener("focusout",this.boundOnDocumentFocusOutHandler),document.removeEventListener("focusin",this.boundOnDocumentFocusInHandler),document.removeEventListener(H.eventName,this.boundOnPopupShownHandler)}showEditor(e,t=null){if(!this.allowInteraction)return!1;if(!this.uiHandlersBridge)return!1;const n=this.grid.getCellInfo(e);return null!==n&&(n.type===Z.Data&&(!!n.columnInfo.isEditable&&(this.pendingCommandId=le.InitializationCommandId,document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.pendingCommandId=this.uiHandlersBridge.send("showEditor",{visibleIndex:n.rowIndex,columnUid:n.columnInfo.uID},(e=>{this.pendingCommandId===e.id&&(null!==t&&t(e.result),this.pendingCommandId=null)})),!0)))}closeEditor(e=ee.Save,t=null){return!!this.allowInteraction&&(!!this.uiHandlersBridge&&(this.pendingCommandId=le.InitializationCommandId,this.pendingCommandId=this.uiHandlersBridge.send("closeEditor",{action:e},(e=>{this.pendingCommandId===e.id&&(null!==t&&t(e.result),this.pendingCommandId=null)})),!0))}notifyPendingEditorShow(e){this.allowInteraction&&(e?this.pendingCommandId=le.ServerSideShowCommandId:this.pendingCommandId===le.ServerSideShowCommandId&&(this.pendingCommandId=null))}get allowInteraction(){return this.grid.enableInplaceEditing}get uiHandlersBridge(){return this.grid.uiHandlersBridge}onDocumentFocusOut(e){var t;if(!this.allowInteraction)return;if(!this.grid.isEditing)return;if(this.isPendingCommandResult)return;const n=this.grid.getCellInfo(e.target);if(!re.isEditRowCell(n))return;const i=this.grid.getCellInfo(null!==(t=e.relatedTarget)&&void 0!==t?t:this.activePopup);re.isEditRowCell(i)||this.closeEditor()}onDocumentFocusIn(e){if(!this.allowInteraction)return;if(!this.isPendingCommandResult)return;null===this.grid.getCellInfo(e.target)&&this.closeEditor()}onPopupShown(e){if(!this.allowInteraction)return;if(!this.grid.isEditing)return;if(!(e.target instanceof T))return;const t=this.grid.getCellInfo(e.target);re.isEditRowCell(t)&&(this.activePopup=e.target,this.activePopup.addEventListener(W.eventName,this.boundOnPopupClosingHandler),this.activePopup.addEventListener(B.eventName,this.boundOnPopupClosedHandler))}onPopupClosing(e){if(null===this.activePopup)return;if(this.activePopup.removeEventListener(W.eventName,this.boundOnPopupClosingHandler),e.detail.closeReason!==F.OutsideClick)return;null===this.grid.getCellInfo(document.activeElement)&&(this.activePopup.removeEventListener(B.eventName,this.boundOnPopupClosedHandler),this.activePopup=null,this.closeEditor())}onPopupClosed(e){null!==this.activePopup&&(this.activePopup.removeEventListener(W.eventName,this.boundOnPopupClosingHandler),this.activePopup.removeEventListener(B.eventName,this.boundOnPopupClosedHandler),setTimeout((()=>this.activePopup=null),0))}}le.InitializationCommandId=-1,le.ServerSideShowCommandId=-2,function(e){e[e.Save=0]="Save",e[e.Cancel=1]="Cancel",e[e.Hide=2]="Hide"}(ee||(ee={}));class ae{static calculateHorizontalScrollCorrection(e,t,n){let i=0;const s=e.getBoundingClientRect();for(const e of t){const t=e.getBoundingClientRect(),o=this.getIntersectionRectangle(s,t);if(!o.isEmpty){const e=n?o.left-t.right:o.right-t.left;s.x-=e,i+=e}}return i}static calculateBoundaryItemIndex(e,t,n){const i=Math.ceil(this.getDataAreaViewportHeight(t)),s=e.getTableBodyBoundaryItemIndex(!n);let o=n&&e.selectedItemIndex<=s||!n&&e.selectedItemIndex>=s?s:e.selectedItemIndex;const r=e.getItem(o);let l=this.getElementHeight(r);r&&!this.isOutsideViewportItemRequired(e,t,o,n)&&(l+=this.calculateHeightOffsetValue(r,t,n));let a=o;for(;l<=i||o===e.selectedItemIndex;){if(!n&&o<=0||n&&o>=e.itemCount-1)break;o=a,a=n?o+1:o-1,l+=this.getElementHeight(e.getItem(a))}return o}static isOutsideViewportItemRequired(e,t,n,i){const s=e.getItem(i?n+1:n-1);if(s){const e=s.getBoundingClientRect(),n=t.getHeaderElement(),o=t.getFooterElement();if(i&&o)return!this.getIntersectionRectangle(e,o.getBoundingClientRect()).isEmpty;if(!i&&n)return!this.getIntersectionRectangle(e,n.getBoundingClientRect()).isEmpty;return this.getIntersectionRectangle(e,t.getBoundingClientRect()).height<this.getElementHeight(s)}return!0}static calculateHeightOffsetValue(e,t,n){const i=t.getDataAreaRectangle(),s=i.y,o=i.y+i.height,r=e.getBoundingClientRect();return m.calcScrollOffsetY(s,o,r.top,r.bottom,n?g.Top:g.Bottom)}static getDataAreaViewportHeight(e){const t=M.viewport(),n=null==e?void 0:e.getRectangle();return n&&n.height<t.height?n.height-this.calcStickyElementsHeight(e):t.height}static calcStickyElementsHeight(e){let t=0;for(const n of this.getStickyElements(e))t+=this.getElementHeight(n);return t}static getStickyElements(e){return e?[e.getHeaderElement(),e.getFooterElement()]:[]}static getElementHeight(e){return e?e.getBoundingClientRect().height:0}static getIntersectionRectangle(e,t){const n=new R(e.x,e.y,e.width,e.height),i=new R(t.x,t.y,t.width,t.height);return D.intersect(n,i)}}class de{static selectInputValue(e){null!==e&&e instanceof HTMLInputElement&&N.isTextInput(e)&&e.select()}}const he=`:scope > *:not(.${[K.IndentCellClassName,K.HeaderIndentCellClassName,K.GroupFooterIndentCellClassName,K.EmptyCellClassName,K.HiddenEmptyCellClassName].join(",.")})`;class ue extends se{constructor(e,t,n){super(t,n),this.tableStrategy=e}getRowVisibleIndex(){return N.getAttributeIntValue(this.targetElement,ne.VisibleIndexName,-1)}selectFirstCell(){this.selectItem(0)}selectLastCell(){this.selectItem(this.itemCount-1)}getSelectedColumnUid(){var e;return null!==(e=this.getColumnUidByCell(this.selectedItemElement))&&void 0!==e?e:null}syncSelectedColumn(e){const t=null!==e?this.items.findIndex((t=>this.getColumnUidByCell(t)===e)):-1;this.selectedItemIndex=Math.max(t,0)}leaveRow(){S.removeTabIndex(this.selectedItemElement)}getShortcutContext(){return{RowType:this.getRowType(),VisibleIndex:this.getRowVisibleIndex()}}queryItems(){return this.queryItemsBySelector(he)}handleKeyDown(e){if(super.handleKeyDown(e))return!0;if(this.nestedContentSelected)return!1;switch(u.KeyUtils.getEventKeyCode(e)){case u.KeyCode.Left:return this.moveToPrevItem(),!0;case u.KeyCode.Right:return this.moveToNextItem(),!0;case u.KeyCode.Home:if(!e.ctrlKey)return this.selectFirstCell(),!0;break;case u.KeyCode.End:if(!e.ctrlKey)return this.selectLastCell(),!0}return!1}selectItem(e){super.selectItem(e),this.navigator.isActive&&this.alignRequiredVisibleElement(this.selectedItemElement)}isImmediatelyClickEnabled(){return this.isActiveCommandCell()||this.isActiveExpandButtonCell()||this.isSelectionCell()}isActiveCommandCell(){return oe.isCommandCell(this.selectedItemElement)}isActiveExpandButtonCell(){return oe.isExpandButtonCell(this.selectedItemElement)}isSelectionCell(){return oe.isSelectionCell(this.selectedItemElement)}isFixedCell(e){return oe.isFixedCell(e)}getColumnUidByCell(e){var t;return null===(t=this.getColumnInfoByCell(e))||void 0===t?void 0:t.uID}alignRequiredVisibleElement(e){const t=this.getScrollViewerContent();if(t&&!this.isFixedCell(e)){e.scrollIntoView({block:"nearest"});const n=Array.from(Array(this.itemCount-this.selectedItemIndex-1),((e,t)=>++t)).map((e=>this.getItem(e+this.selectedItemIndex))).filter((e=>this.isFixedCell(e)));if(n.length>0){const i=ae.calculateHorizontalScrollCorrection(e,n.reverse(),!1);t.scrollBy(i,0)}const i=Array.from(Array(this.selectedItemIndex),((e,t)=>t++)).map((e=>this.getItem(e))).filter((e=>this.isFixedCell(e)));if(i.length>0){const n=ae.calculateHorizontalScrollCorrection(e,i,!0);t.scrollBy(n,0)}}}}class ce extends ue{constructor(e,t,n){super(e,t,n)}getRowType(){return Q.Header}getShortcutContext(){return{RowType:this.getRowType(),ColumnUID:this.getSelectedColumnUID()}}handleKeyDown(e){if(super.handleKeyDown(e))return!0;if(this.nestedContentSelected)return!1;switch(u.KeyUtils.getEventKeyCode(e)){case u.KeyCode.Space:return this.performShortcutEvent(e),!0;case u.KeyCode.Down:return e.altKey&&this.performShortcutEvent(e),e.altKey}return!1}isImmediatelyClickEnabled(){return!0}getSelectedColumnUID(){return this.getColumnUID(this.selectedItemElement)}}class me extends ue{constructor(e,t,n){super(e,t,n)}focusNestedEditor(){this.switchToNestedContent(),this.selectFocusedInputValue()}selectFocusedInputValue(){de.selectInputValue(document.activeElement)}}class ge extends me{constructor(e,t,n){super(e,t,n)}handleKeyDown(e){if(this.nestedContentSelected&&this.isActiveEditorCell()){if(u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Tab)return e.shiftKey&&this.selectedItemIndex>0?(this.moveToPrevItem(),this.focusNestedEditor()):!e.shiftKey&&this.selectedItemIndex<this.itemCount-1?(this.moveToNextItem(),this.focusNestedEditor()):this.leaveFromNestedContent(),!0;if(u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Enter&&!e.shiftKey)return this.leaveFromNestedContent(),!0}return super.handleKeyDown(e)}isActiveEditorCell(){return!this.isActiveCommandCell()&&!this.isActiveExpandButtonCell()&&!this.isSelectionCell()}}class Ce extends ge{constructor(e,t,n){super(e,t,n)}getRowType(){return Q.Filter}}class pe extends ge{constructor(e,t,n){super(e,t,n)}getRowType(){return Q.Edit}}class fe extends me{constructor(e,t,n){super(e,t,n)}getRowType(){return Q.Edit}handleKeyDown(e){if(this.editorManager.isPendingCommandResult)return!0;if(this.isEditorCell()){if(this.isActiveEditorCell()){if(u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Tab){if(this.tableStrategy.startEditNearestRowItem(!e.shiftKey))return!0;if(this.tableStrategy.endEditRowItem(ee.Hide))return!0}if(u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Enter&&!e.shiftKey&&!this.editorManager.isEditorPopupShown&&this.tableStrategy.endEditRowItem(ee.Hide))return!0}else if(u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Enter&&this.isEditorCell()&&this.tableStrategy.startEditRowItem(this,this.selectedItemIndex))return!0;if(u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Esc&&this.tableStrategy.endEditRowItem(ee.Cancel))return!0}return super.handleKeyDown(e)}updateSelectedItemByChildElement(e,t){if(!t){const t=this.findItemElementIndexByChild(e);t>=0&&t<this.itemCount&&(this.isEditorCell(t)?this.tableStrategy.startEditRowItem(this,t):this.tableStrategy.endEditRowItem(ee.Hide))}super.updateSelectedItemByChildElement(e,t)}isEditorCell(e=-1){const t=e>=0&&e<this.itemCount?this.getItem(e):this.selectedItemElement;return null!==t&&(!oe.isCommandCell(t)&&!oe.isExpandButtonCell(t)&&!oe.isSelectionCell(t))}isActiveEditorCell(){return oe.getCellType(this.selectedItemElement)===Z.Edit}}class be extends ue{constructor(e,t,n){super(e,t,n)}getRowType(){return Q.EditForm}}class ve extends ue{constructor(e,t,n){super(e,t,n)}getRowType(){return Q.Group}queryItems(){return new Array}handleKeyDown(e){return this.nestedContentSelected||u.KeyUtils.getEventKeyCode(e)!==u.KeyCode.Left&&u.KeyUtils.getEventKeyCode(e)!==u.KeyCode.Right?super.handleKeyDown(e):(this.performShortcutEvent(e),!0)}isImmediatelyClickEnabled(){return!0}}class Ee extends ue{constructor(e,t,n){super(e,t,n)}getRowType(){return Q.Data}handleKeyDown(e){if(this.editorManager.isPendingCommandResult)return!0;if(!this.nestedContentSelected){const t=u.KeyUtils.getEventKeyCode(e);if(!e.shiftKey||t!==u.KeyCode.Up&&t!==u.KeyCode.Down||this.performShortcutEvent(e),t===u.KeyCode.Space)return this.performShortcutEvent(e),!0;if(t===u.KeyCode.Enter&&this.tableStrategy.startEditRowItem(this,this.selectedItemIndex))return!0}return super.handleKeyDown(e)}updateSelectedItemByChildElement(e,t){if(this.isInplaceEditingEnabled&&!t){const t=this.findItemElementIndexByChild(e);t>=0&&t<this.itemCount&&this.tableStrategy.startEditRowItem(this,t)}super.updateSelectedItemByChildElement(e,t)}}class Ie extends ue{constructor(e,t,n){super(e,t,n)}getRowType(){return Q.EmptyData}}class ye extends ue{constructor(e,t,n){super(e,t,n)}getRowType(){return Q.Detail}}class Se extends ue{constructor(e,t,n){super(e,t,n)}getRowType(){return Q.Footer}}class we extends ue{constructor(e,t,n){super(e,t,n)}getRowType(){return Q.GroupFooter}}class xe extends se{constructor(e,t){super(e,t),this.savedVisibleIndex=-1,this.savedSelectedColumnUid=null,this.restoreSelectedColumn=!1,this.expectedFocusedRowFromServer=!1,this.boundOnVisibleElementChangedHandler=this.onMakeRowVisible.bind(this),this.addEventSubscriptions()}onDispose(){super.onDispose(),this.removeEventSubscriptions()}getShortcutContext(){return{AreaType:J.DataTable}}queryItems(){return this.queryItemsBySelector(ie.RowSelector)}getSelectedItemStrategy(){return super.getSelectedItemStrategy()}createItemStrategy(e){switch(oe.getRowType(e)){case Q.Header:return new ce(this,this.grid,e);case Q.Filter:return new Ce(this,this.grid,e);case Q.Edit:return this.isInplaceEditingEnabled?new fe(this,this.grid,e):new pe(this,this.grid,e);case Q.EditForm:return new be(this,this.grid,e);case Q.Group:return new ve(this,this.grid,e);case Q.Data:return new Ee(this,this.grid,e);case Q.EmptyData:return new Ie(this,this.grid,e);case Q.Detail:return new ye(this,this.grid,e);case Q.Footer:return new Se(this,this.grid,e);case Q.GroupFooter:return new we(this,this.grid,e)}throw new Error("Not implemented")}selectItem(e){const t=this.getSelectedItemStrategy(),n=this.getStrategy(e);this.saveFocusedRowVisibleIndex(n),this.syncSelectedColumns(t,n),super.selectItem(e),t&&t!==n&&t.leaveRow(),this.restoreSelectedColumn=!1}getStrategy(e){return e=this.validateItemIndex(e),this.navigator.getStrategy(this.getItem(e))}saveFocusedRowVisibleIndex(e){!this.expectedFocusedRowFromServer&&this.isFocusableRow(e.getRowType())&&(this.savedVisibleIndex=e.getRowVisibleIndex())}syncSelectedColumns(e,t){const n=e&&e!==t;n&&this.isColumnSyncRequired(e.getRowType())&&(this.savedSelectedColumnUid=e.getSelectedColumnUid()),(this.restoreSelectedColumn||n&&this.isColumnSyncRequired(t.getRowType()))&&t.syncSelectedColumn(this.savedSelectedColumnUid)}saveRowSelectedColumnUid(e){this.savedSelectedColumnUid=e.getSelectedColumnUid(),this.restoreSelectedColumn=!0}isColumnSyncRequired(e){switch(e){case Q.Header:case Q.Filter:case Q.Edit:case Q.Data:case Q.Footer:case Q.GroupFooter:return!0}return!1}isFocusableRow(e){switch(e){case Q.Group:case Q.Edit:case Q.Data:return!0}return!1}addEventSubscriptions(){const e=this.getScrollViewer();e&&e.addEventListener(C.eventName,this.boundOnVisibleElementChangedHandler)}removeEventSubscriptions(){const e=this.getScrollViewer();e&&e.removeEventListener(C.eventName,this.boundOnVisibleElementChangedHandler)}onMakeRowVisible(e){if(e.detail.isFocusRequired){const t=this.items.indexOf(e.detail.element);this.selectItem(t)}}handleKeyDown(e){var t,n;switch(this.expectedFocusedRowFromServer=!1,u.KeyUtils.getEventKeyCode(e)){case u.KeyCode.Down:return this.moveToNextItem(),!0;case u.KeyCode.Up:return this.moveToPrevItem(),!0;case u.KeyCode.PageDown:return this.handlePageDown()||this.performShortcutEvent(e),!0;case u.KeyCode.PageUp:return this.handlePageUp()||this.performShortcutEvent(e),!0;case u.KeyCode.Home:if(e.ctrlKey)return this.selectItem(this.getTableBodyBoundaryItemIndex(!1)),null===(t=this.getSelectedItemStrategy())||void 0===t||t.selectFirstCell(),!0;break;case u.KeyCode.End:if(e.ctrlKey)return this.selectItem(this.getTableBodyBoundaryItemIndex(!0)),null===(n=this.getSelectedItemStrategy())||void 0===n||n.selectLastCell(),!0;break;case u.KeyCode.Tab:if(e.shiftKey)return this.moveToHeaderRow()}return!1}handleKeyUp(e){switch(u.KeyUtils.getEventKeyCode(e)){case u.KeyCode.Down:case u.KeyCode.Up:case u.KeyCode.PageUp:case u.KeyCode.PageDown:case u.KeyCode.Home:case u.KeyCode.End:this.notifyFocusedRowChanged()}return!1}moveToPrevItem(){super.moveToPrevItem(),this.scrollToElement()}moveToNextItem(){super.moveToNextItem(),this.scrollToElement()}handlePageUp(){this.savedVisibleIndex=-1;const e=this.getTableBodyBoundaryItemIndex(!1);if(this.selectedItemIndex<=e)return this.expectedFocusedRowFromServer=this.isFocusedRowEnabled,!1;const t=this.getScrollViewer();if(t){const n=ae.calculateBoundaryItemIndex(this,t,!1);this.selectItem(n<e?e:n),this.scrollToElement(g.Top)}return!0}handlePageDown(){this.savedVisibleIndex=-1;const e=this.getTableBodyBoundaryItemIndex(!0);if(this.selectedItemIndex>=e)return this.expectedFocusedRowFromServer=this.isFocusedRowEnabled,!1;const t=this.getScrollViewer();if(t){const n=ae.calculateBoundaryItemIndex(this,t,!0);this.selectItem(n>e?e:n),this.scrollToElement(g.Bottom)}return!0}notifyFocusedRowChanged(){this.isFocusedRowEnabled&&this.savedVisibleIndex>-1&&(this.grid.notifyFocusedRowChanged(this.savedVisibleIndex),this.savedVisibleIndex=-1)}scrollToElement(e=null){const t=this.getScrollViewer();t&&m.scrollToElementRellyOnStickyDescendants(this.selectedItemElement,e,t)}moveToHeaderRow(){const e=this.findHeaderRowItemIndex();return e>-1&&e!==this.selectedItemIndex&&(this.selectItem(e),!0)}findHeaderRowItemIndex(){for(let e=0;e<this.itemCount;e++)if(oe.getRowType(this.getItem(e))===Q.Header)return e;return-1}getTableBodyBoundaryItemIndex(e){const t=this.items.filter((e=>e.matches(ie.TableBodyRows)));return this.items.indexOf(e?t[t.length-1]:t[0])}startEditRowItem(e,t){if(null===e||!this.isInplaceEditableRow(e))return!1;if(t<0||t>=e.itemCount)return!1;const n=this.isEditing;return!!this.editorManager.showEditor(e.getItem(t),(i=>{if(i){const e=this.getEditRowStrategy();null!==e&&(e.updateSelectedItemByIndex(t),this.saveRowSelectedColumnUid(e),e.focusNestedEditor())}n&&O(e.targetElement)}))&&(n&&A(e.targetElement),e.selectItem(t),this.saveRowSelectedColumnUid(e),!0)}endEditRowItem(e=ee.Save){const t=this.getSelectedItemStrategy();return!(null===t||!this.isInplaceEditableRow(t))&&(t.leaveFromNestedContent(),e!==ee.Hide&&this.saveRowSelectedColumnUid(t),this.editorManager.closeEditor(e))}startEditNearestRowItem(e){const t=this.findNearestEditablePosition(e);if(null===t)return!1;const n=this.getItemStrategy(t[0]);return this.startEditRowItem(n,t[1])}findNearestEditablePosition(e){const t=e?1:-1,n=this.itemCount,i=this.selectedItemIndex;for(let s=i;s>=0&&s<n;s+=t){const n=this.getItemStrategy(s);if(null===n||!this.isInplaceEditableRow(n))continue;let o;o=s===i?n.selectedItemIndex+t:e?0:n.itemCount-1;for(let e=o;e>=0&&e<n.itemCount;e+=t){const t=n.getItem(e),i=this.getColumnInfoByCell(t);if(null!==i&&i.isEditable)return[s,e]}}return null}isInplaceEditableRow(e){if(!this.isInplaceEditingEnabled)return!1;const t=e.getRowType();return t===Q.Data||t===Q.Edit}getEditRowStrategy(){for(let e=0;e<this.itemCount;e++){const t=this.getItemStrategy(e);if(t instanceof me&&t.getRowType()===Q.Edit)return t}return null}}class Re extends se{constructor(e){super(e,e),this.searchBoxInputSelector=`.${K.SearchBoxClassName} > input`}getShortcutContext(){return{IsMacOSPlatform:h.Browser.MacOSPlatform}}queryItems(){return new Array(this.getToolbarContainer(),this.getPagerPanel(!0),this.getTopPanel(),this.getDataTable(),this.getPagerPanel(!1))}createItemStrategy(e){switch(oe.getNavigationAreaType(e)){case J.ToolbarContainer:return new De(this.grid,e);case J.GroupPanel:case J.SearchBox:return new Ne(this.grid,e);case J.DataTable:return new xe(this.grid,e);case J.Pager:return new Pe(this.grid,e)}return null}handleKeyDown(e){return u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Tab?(e.shiftKey?this.moveToPrevItem():this.moveToNextItem(),!0):!(!e.ctrlKey||u.KeyUtils.getEventKeyCode(e)!==u.KeyCode.Key_f)&&this.tryFocusSearchBox()}moveToPrevItem(){this.selectedItemIndex>0?super.moveToPrevItem():this.leaveBackward()}moveToNextItem(){this.selectedItemIndex<this.itemCount-1?super.moveToNextItem():this.leaveForward()}getTopPanel(){var e,t;const n=null!==(e=this.getGroupPanelContentContainer())&&void 0!==e?e:this.getSearchBoxContainer();return null!==(t=null==n?void 0:n.closest(ie.TopPanelSelector))&&void 0!==t?t:null}tryFocusSearchBox(){const e=this.getSearchBoxContainer();if(e){const t=e.querySelector(this.searchBoxInputSelector);return S.focusElement(null!=t?t:e),!0}return!1}}class De extends se{constructor(e,t){super(e,t)}getShortcutContext(){return{AreaType:J.ToolbarContainer}}}class Ne extends se{constructor(e,t){super(e,t),this.itemSelector=`.${K.HeaderElementClassName}`,this.searchBoxContainer=null,this.searchBoxContainer=this.getSearchBoxContainer()}getShortcutContext(){return{AreaType:this.getAreaType(),ColumnUID:this.getSelectedColumnUID()}}queryItems(){const e=this.queryItemsBySelector(this.itemSelector);return e.push(this.searchBoxContainer),e}handleKeyDown(e){if(e.ctrlKey&&(u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Enter||u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Space))return!0;if(super.handleKeyDown(e))return!0;if(this.nestedContentSelected)return!1;switch(u.KeyUtils.getEventKeyCode(e)){case u.KeyCode.Left:return this.moveToPrevItem(),!0;case u.KeyCode.Right:return this.moveToNextItem(),!0;case u.KeyCode.Space:return this.performShortcutEvent(e),!0;case u.KeyCode.Up:if(!this.isSearchBoxItemSelected()&&this.isSearchBoxInMobileView()){const e=this.items.findIndex((e=>oe.isSearchBoxContainer(e)));return this.selectItem(e),!0}break;case u.KeyCode.Down:if(e.altKey&&!this.isSearchBoxItemSelected())return this.performShortcutEvent(e),!0;if(!e.altKey&&this.isSearchBoxItemSelected()&&this.isSearchBoxInMobileView())return this.selectItem(0),!0}return!1}isImmediatelyClickEnabled(){return this.selectedItemElement!==this.searchBoxContainer}getAreaType(){return oe.isSearchBoxContainer(this.selectedItemElement)?J.SearchBox:J.GroupPanel}getSelectedColumnUID(){return this.getColumnUID(this.selectedItemElement)}isSearchBoxItemSelected(){return this.getAreaType()===J.SearchBox}isSearchBoxInMobileView(){return!!this.searchBoxContainer&&this.searchBoxContainer.offsetWidth===this.targetElement.offsetWidth}}class Pe extends se{constructor(e,t){super(e,t)}getShortcutContext(){return{AreaType:J.Pager}}handleKeyDown(e){if(super.handleKeyDown(e))return!0;if(this.nestedContentSelected)return!1;switch(u.KeyUtils.getEventKeyCode(e)){case u.KeyCode.Left:case u.KeyCode.Right:case u.KeyCode.Home:case u.KeyCode.End:return this.performShortcutEvent(e),!0}return!1}}class He extends y{constructor(e,t){super(t,e),this.itemSelector=`.${K.ColumnChooserItemClassName}`,this.savedColumnUID=null,this.boundOnDragStopHandler=this.onDragStop.bind(this),this.columnChooser=e,this.addEventSubscriptions()}initialize(){super.initialize(),null!==this.savedColumnUID&&this.restoreSelectedColumn()}queryItems(){return this.queryItemsBySelector(this.itemSelector)}getShortcutContext(){return{AreaType:J.ColumnChooser,ColumnUID:this.getSelectedColumnUID()}}isImmediatelyClickEnabled(){return!0}handleKeyDown(e){if(super.handleKeyDown(e))return!0;if(this.nestedContentSelected)return!1;switch(u.KeyUtils.getEventKeyCode(e)){case u.KeyCode.Up:return this.moveToPrevItem(),!0;case u.KeyCode.Down:return this.moveToNextItem(),!0;case u.KeyCode.Tab:return e.shiftKey?this.moveToPrevItem(!0):this.moveToNextItem(!0),!0;case u.KeyCode.Space:return this.performShortcutEvent(e),!0}return!1}onDispose(){super.onDispose(),this.removeEventSubscriptions()}onDragStop(e){this.savedColumnUID=this.getSelectedColumnUID()}restoreSelectedColumn(){const e=this.findItemByColumnUID(this.savedColumnUID);e>=0&&this.selectItem(e),this.savedColumnUID=null}addEventSubscriptions(){this.columnChooser.addEventListener(s.eventName,this.boundOnDragStopHandler)}removeEventSubscriptions(){this.columnChooser.removeEventListener(s.eventName,this.boundOnDragStopHandler)}findItemByColumnUID(e){return this.items.findIndex((t=>this.getColumnUID(t)===e))}getSelectedColumnUID(){return this.getColumnUID(this.selectedItemElement)}getColumnUID(e){var t;return null!==(t=this.columnChooser.getColumnUid(e))&&void 0!==t?t:-1}}var Te,We,Be,Fe;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(Te||(Te={}));class Me{constructor(){this.downTargetElement=Me.addTargetToDom(K.DraggingDownTargetClassName,b.ArrowDownIconName),this.upTargetElement=Me.addTargetToDom(K.DraggingUpTargetClassName,b.ArrowUpIconName);const e=this.upTargetElement.getBoundingClientRect();this.targetElementSize={width:e.width,height:e.height},this.upTargetElementPosition=null,this.downTargetElementPosition=null,this.hide()}show(){this.upTargetElementPosition&&this.downTargetElementPosition&&(this.downTargetElement.style.transform=v.translateByPoint(this.downTargetElementPosition),this.upTargetElement.style.transform=v.translateByPoint(this.upTargetElementPosition),this.downTargetElement.classList.remove(t.DisplayNone),this.upTargetElement.classList.remove(t.DisplayNone))}hide(){this.downTargetElement.classList.add(t.DisplayNone),this.upTargetElement.classList.add(t.DisplayNone)}setPositionRelativeToElement(e,t){this.setUpTargetPosition(e,t),this.setDownTargetPosition(e,t)}setUpTargetPosition(e,t){this.upTargetElementPosition={x:this.getTargetXCoordinate(e,t),y:e.y+e.height}}setDownTargetPosition(e,t){this.downTargetElementPosition={x:this.getTargetXCoordinate(e,t),y:e.y-this.targetElementSize.height}}getTargetXCoordinate(e,t){let n=e.x-this.targetElementSize.width/2;return t===Te.Right&&(n+=e.width),n}dispose(){Me.removeElementsByClassName(K.DraggingDownTargetClassName),Me.removeElementsByClassName(K.DraggingUpTargetClassName)}static removeElementsByClassName(e){const t=document.querySelectorAll(`.${e}`);for(let e=0;e<t.length;e++)t[e].remove()}static addTargetToDom(e,t){const n=document.createElement("div");return n.className=e,n.innerHTML=b.getSvgHtml(t),document.body.appendChild(n),n}}!function(e){e[e.HeaderRow=0]="HeaderRow",e[e.GroupPanel=1]="GroupPanel",e[e.ColumnChooser=2]="ColumnChooser"}(We||(We={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(Be||(Be={}));class Oe{constructor(e){this.boundOnDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.boundOnDocumentScrollHandler=this.onDocumentScroll.bind(this),this.boundOnHeaderMouseMoveHandler=this.onHeaderMouseMove.bind(this),this.boundOnElementMouseOutHandler=this.onElementMouseOut.bind(this),this.boundOnGroupPanelMouseMoveHandler=this.onGroupPanelMouseMove.bind(this),this.boundOnEmptyHeaderCellMouseMoveHandler=this.onEmptyHeaderCellMouseMove.bind(this),this.boundOnGroupFreeSpaceMouseMoveHandler=this.onGroupFreeSpaceMouseMove.bind(this),this.draggableContext=null,this.isRefreshUIRequested=!1,this.grid=e}start(e,t){if(!this.isColumnDraggingAllowed(e))return;const n=Oe.addDraggableHeaderToDOM(e);this.draggableContext=this.createDraggableContext(e,n,t),this.addEventSubscriptions(),this.updateDraggableElement(t),this.grid.styleGenerator.notifyColumnDragStarted()}stop(){var e;this.isRefreshUIRequested=!1,null===(e=this.draggableContext)||void 0===e||e.targets.dispose(),this.draggableContext=null,Oe.removeDraggableHeaderFromDom(),this.removeEventSubscriptions(),document.body.classList.remove(K.MoveCursorCssClassName),this.grid.styleGenerator.notifyColumnDragEnded()}isStarted(){return!!this.draggableContext}updateDraggableContextByEvent(e){const t=document.elementFromPoint(e.clientX,e.clientY);this.updateDraggableContextByElement(t,e)}onDocumentMouseMove(e){this.updateDraggableElement(e)}onDocumentScroll(e){this.draggableContext&&(this.draggableContext.currentScrollPosition=Oe.getDocumentScrollPosition(),this.draggableContext.srcHeaderPosition=Oe.getElementPosition(this.draggableContext.srcHeaderElement),this.draggableContext.mouseOverElement&&this.setMouseOverElementInfo(this.draggableContext.mouseOverElement),this.updateDraggableElementPosition(),this.refreshUI())}onHeaderMouseMove(e){this.updateDraggableContextByElement(e.target,e)}onElementMouseOut(e){this.clearMoveStateFromDraggableContext(),this.refreshUI()}onGroupPanelMouseMove(){const e=this.grid.getGroupPanelContentContainer();this.onPanelElementMouseMove(e,We.GroupPanel)}onEmptyHeaderCellMouseMove(){const e=this.grid.getEmptyHeaderCellContentContainer();this.onPanelElementMouseMove(e,We.HeaderRow)}onGroupFreeSpaceMouseMove(){const e=this.grid.getGroupContentFreeSpaceElement();this.onPanelElementMouseMove(e,We.GroupPanel)}isColumnDraggingAllowed(e){const t=this.grid.getColumnInfo(e);return!!t&&(t.allowReorder||t.allowGroup&&!!this.grid.getGroupPanelContentContainer())}updateDraggableElement(e){this.draggableContext&&(this.draggableContext.currentCursorPosition={x:e.pageX,y:e.pageY},this.draggableContext.initialScrollPosition=this.draggableContext.currentScrollPosition,this.updateDraggableElementPosition(),this.refreshUI())}onPanelElementMouseMove(e,t){e&&this.draggableContext&&this.draggableContext.mouseOverElement!==e&&this.draggableContext.srcHeaderElement!==e.previousElementSibling&&(this.clearMoveStateFromDraggableContext(),this.setMouseOverElementInfo(e),this.draggableContext.dropArea=t,this.isPossibleDropToCurrentArea()&&(this.draggableContext.isPossibleDropColumn=!0,this.draggableContext.targets.setPositionRelativeToElement(this.draggableContext.mouseOverElementRect,Te.Left)),this.refreshUI())}isPossibleDropToCurrentArea(){var e,t,n;return(null===(e=this.draggableContext)||void 0===e?void 0:e.allowGroup)||(null===(t=this.draggableContext)||void 0===t?void 0:t.dropArea)===(null===(n=this.draggableContext)||void 0===n?void 0:n.srcArea)}createColumnDraggedHandlerArgs(){var e;if(!this.draggableContext||!this.draggableContext.isPossibleDropColumn)return null;const t=this.draggableContext;let n=t.beforeColumnUid;return t.dropArea===We.HeaderRow&&(n=null!==(e=(e=>{var t;return e.dragRestrictions?null!==(t=e.dragRestrictions.nextColumnUid)&&void 0!==t?t:-1:null})(t.draggedColumn))&&void 0!==e?e:n),{columnUid:t.draggedColumn.uID,beforeColumnUid:n,srcArea:t.srcArea,dropArea:t.dropArea}}getLatestVisibleColumnIndex(){for(let t=this.grid.columnsInfo.length-1;t>=0;t--)if(!(e=this.grid.columnsInfo[t]).isIndent&&!e.isEmpty)return t;var e;return-1}getRestrictedDropHeaderInfo(e){const t=this.getDropColumnArea(e);if(!!(!this.draggableContext||!this.draggableContext.draggedColumn.dragRestrictions||this.draggableContext.srcArea!==We.GroupPanel||this.draggableContext.dropArea===We.GroupPanel||t!==We.HeaderRow))return null;let n,i=Be.Left;const s=this.getLatestVisibleColumnIndex(),o=this.draggableContext.draggedColumn.dragRestrictions;let r=-1;return o&&null!==o.nextVisibleColumnUid?r=this.grid.columnsInfo.findIndex((e=>e.uID===o.nextVisibleColumnUid&&!e.isIndent)):(r=s,i=Be.Right),-1!==r&&(n=this.grid.getHeaderCells()[r]),n?{dropHeaderElement:n,position:i}:null}updateDraggableContextByElement(e,t){const n=this.grid.findHeaderElement(e);n&&(this.updateDraggableContext(n,t),this.refreshUI())}updateDraggableContext(e,t){var n,i;if(this.clearMoveStateFromDraggableContext(),null==this.draggableContext)return;const s=e?this.getRestrictedDropHeaderInfo(e):null;if(s&&(e=s.dropHeaderElement),this.draggableContext.srcHeaderElement!==e&&(this.setMouseOverElementInfo(e),this.isPossibleDropToCurrentArea())){const o=void 0!==(null==s?void 0:s.position)?s.position===Be.Left:this.isThereCursorInLeftPart(t);if(o&&e.previousElementSibling!==this.draggableContext.srcHeaderElement){const t=this.grid.getColumnInfo(e),i=this.grid.getColumnInfo(e.previousElementSibling);if(!this.canDropBetweenColumns(i,t))return void(this.draggableContext.isPossibleDropColumn=!1);this.draggableContext.beforeColumnUid=null!==(n=null==t?void 0:t.uID)&&void 0!==n?n:-1,this.draggableContext.isPossibleDropColumn=!0}if(!o&&e.nextElementSibling!==this.draggableContext.srcHeaderElement){const t=this.grid.getColumnInfo(e.nextElementSibling),n=this.grid.getColumnInfo(e);if(!this.canDropBetweenColumns(n,t))return void(this.draggableContext.isPossibleDropColumn=!1);this.draggableContext.beforeColumnUid=null!==(i=null==t?void 0:t.uID)&&void 0!==i?i:-1,this.draggableContext.isPossibleDropColumn=!0}this.draggableContext.isPossibleDropColumn&&this.draggableContext.targets.setPositionRelativeToElement(this.draggableContext.mouseOverElementRect,o?Te.Left:Te.Right)}}static canDropColumnWithDisabledReorderingBetweenColumns(e,t,n,i){var s,o;if(t!==We.GroupPanel)return!1;const r=e.dragRestrictions;if(r){const e=null!==(s=null==n?void 0:n.uID)&&void 0!==s?s:null,t=null!==(o=null==i?void 0:i.uID)&&void 0!==o?o:null;if(r.previousColumnUid!==e&&r.nextColumnUid!==t&&r.nextVisibleColumnUid!==t)return!1}return!0}canDropBetweenColumns(e,t){if(!this.draggableContext)return!1;if(this.draggableContext.dropArea===We.GroupPanel)return!0;if(!this.draggableContext.draggedColumn.allowReorder&&!Oe.canDropColumnWithDisabledReorderingBetweenColumns(this.draggableContext.draggedColumn,this.draggableContext.srcArea,e,t))return!1;const n=e=>"left"===e?0:"right"===e?2:1,i=[];e&&i.push(n(e.fixedPosition)),i.push(n(this.draggableContext.draggedColumn.fixedPosition)),t&&i.push(n(t.fixedPosition));for(let e=0;e<i.length-1;++e)if(i[e]>i[e+1])return!1;return!0}getDropColumnArea(e){const t=this.grid.getGroupPanelContentContainer();return t&&Oe.isThereHeaderInsideGroupPanel(t,e)?We.GroupPanel:We.HeaderRow}static isThereHeaderInsideGroupPanel(e,t){const n=e.childNodes.length;for(let i=0;i<n;i++)if(e.childNodes[i]===t)return!0;return!1}refreshUI(){this.isRefreshUIRequested||(this.isRefreshUIRequested=!0,requestAnimationFrame((()=>{this.isRefreshUIRequested=!1;const e=this.draggableContext;e&&(e.headerElement.style.transform=`translate(${Math.round(e.draggableElementPosition.x)}px, ${Math.round(e.draggableElementPosition.y)}px)`,e.headerElement.classList.add("visible"),e.isPossibleDropColumn?e.targets.show():e.targets.hide(),document.body.classList.add(K.MoveCursorCssClassName))})))}setMouseOverElementInfo(e){if(!this.draggableContext)return;this.draggableContext.mouseOverElement=e;const t=e.getBoundingClientRect();if(this.draggableContext.mouseOverElementRect={x:t.left+this.draggableContext.currentScrollPosition.x,y:t.top+this.draggableContext.currentScrollPosition.y,width:t.width,height:t.height},this.draggableContext.scrollViewerRect){const e=this.draggableContext.scrollViewerRect;this.draggableContext.mouseOverElementRect.x<e.x&&(this.draggableContext.mouseOverElementRect.x=e.x),this.draggableContext.mouseOverElementRect.x+this.draggableContext.mouseOverElementRect.width>e.x+e.width&&(this.draggableContext.mouseOverElementRect.width=e.x+e.width-this.draggableContext.mouseOverElementRect.x)}this.draggableContext.dropArea=this.getDropColumnArea(e)}isThereCursorInLeftPart(e){if(!this.draggableContext||!this.draggableContext.mouseOverElementRect)return!1;const t=this.draggableContext.mouseOverElementRect;return e.pageX<t.x+t.width/2}updateDraggableElementPosition(){if(!this.draggableContext)return;const e=this.draggableContext;e.draggableElementPosition={x:e.srcHeaderPosition.x+(e.currentCursorPosition.x-e.initialCursorPosition.x)+(e.currentScrollPosition.x-e.initialScrollPosition.x)+e.currentScrollPosition.x,y:e.srcHeaderPosition.y+(e.currentCursorPosition.y-e.initialCursorPosition.y)+(e.currentScrollPosition.y-e.initialScrollPosition.y)+e.currentScrollPosition.y}}addEventSubscriptions(){document.addEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.addEventListener("scroll",this.boundOnDocumentScrollHandler),this.addHeaderEventSubscriptions(),this.addGroupPanelEventSubscriptions(),this.addEmptyHeaderCellEventSubscriptions(),this.addGroupContentFreeSpaceElementEventSubscriptions()}addHeaderEventSubscriptions(){const e=this.grid.getHeaderCells();for(let t=0;t<e.length;t++){const n=e[t];n.addEventListener("pointermove",this.boundOnHeaderMouseMoveHandler),n.addEventListener("pointerout",this.boundOnElementMouseOutHandler)}}addEmptyHeaderCellEventSubscriptions(){const e=this.grid.getEmptyHeaderCellContentContainer();e&&this.addPanelElementEventSubscriptions(e,this.boundOnEmptyHeaderCellMouseMoveHandler)}addGroupPanelEventSubscriptions(){if(!this.shouldAddEventListenersToGroupPanel())return;const e=this.grid.getGroupPanelContentContainer();this.addPanelElementEventSubscriptions(e,this.boundOnGroupPanelMouseMoveHandler)}addGroupContentFreeSpaceElementEventSubscriptions(){const e=this.grid.getGroupContentFreeSpaceElement();e&&this.addPanelElementEventSubscriptions(e,this.boundOnGroupFreeSpaceMouseMoveHandler)}addPanelElementEventSubscriptions(e,t){e.addEventListener("pointermove",t),e.addEventListener("pointerout",this.boundOnElementMouseOutHandler)}removeEventSubscriptions(){document.removeEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.removeEventListener("scroll",this.boundOnDocumentScrollHandler),this.removeHeaderEventSubscriptions(),this.removeGroupPanelEventSubscriptions(),this.removeEmptyHeaderCellEventSubscriptions(),this.removeGroupContentFreeSpaceElementEventSubscriptions()}removeHeaderEventSubscriptions(){const e=this.grid.getHeaderCells();for(let t=0;t<e.length;t++){const n=e[t];n.removeEventListener("pointermove",this.boundOnHeaderMouseMoveHandler),n.removeEventListener("pointerout",this.boundOnElementMouseOutHandler)}}removeGroupPanelEventSubscriptions(){if(!this.shouldAddEventListenersToGroupPanel())return;const e=this.grid.getGroupPanelContentContainer();this.removePanelElementEventSubscriptions(e,this.boundOnGroupPanelMouseMoveHandler)}removeEmptyHeaderCellEventSubscriptions(){const e=this.grid.getEmptyHeaderCellContentContainer();e&&this.removePanelElementEventSubscriptions(e,this.boundOnEmptyHeaderCellMouseMoveHandler)}removeGroupContentFreeSpaceElementEventSubscriptions(){const e=this.grid.getGroupContentFreeSpaceElement();e&&this.removePanelElementEventSubscriptions(e,this.boundOnGroupFreeSpaceMouseMoveHandler)}removePanelElementEventSubscriptions(e,t){e.removeEventListener("pointermove",t),e.removeEventListener("pointerout",this.boundOnElementMouseOutHandler)}shouldAddEventListenersToGroupPanel(){const e=this.grid.getGroupPanelContentContainer();return!!e&&!(null==e?void 0:e.querySelector(`.${K.HeaderElementClassName}`))}static addDraggableHeaderToDOM(e){const t=document.createElement("div");t.className=`${K.DraggableHeaderClassName}`,e.classList.contains(K.SelectionCellClassName)&&t.classList.add(K.SelectionCellClassName),e.classList.contains(K.CommandCellClassName)&&t.classList.add(K.CommandCellClassName);const n=e.getBoundingClientRect();t.style.width=`${n.width}px`,t.style.height=`${n.height}px`;const i=getComputedStyle(e);t.style.padding=i.padding,t.style.font=i.font;const s=this.getContentElement(e).cloneNode(!0);return t.appendChild(s),document.body.appendChild(t),t}static getContentElement(e){return e.querySelector(`.${K.HeaderContentClassName}`)}static removeDraggableHeaderFromDom(){const e=document.querySelectorAll(`.${K.DraggableHeaderClassName}`);for(let t=0;t<e.length;t++)e[t].remove()}createDraggableContext(e,t,n){const i=Oe.getDocumentScrollPosition(),s=Oe.getPointerPosition(n),o=this.grid.getScrollViewer(),r=this.grid.getColumnInfo(e);return{srcHeaderPosition:Oe.getElementPosition(e),srcHeaderElement:e,headerElement:t,allowGroup:r.allowGroup,mouseOverElement:null,mouseOverElementRect:null,scrollViewerRect:o&&o.getRectangle(),isPossibleDropColumn:!1,draggedColumn:r,beforeColumnUid:null,srcArea:e.closest(`.${K.GroupPanelContentContainerClassName}`)?We.GroupPanel:We.HeaderRow,dropArea:We.HeaderRow,initialCursorPosition:s,currentCursorPosition:{x:0,y:0},draggableElementPosition:s,initialScrollPosition:i,currentScrollPosition:i,targets:new Me}}clearMoveStateFromDraggableContext(){this.draggableContext&&(this.draggableContext.mouseOverElement=null,this.draggableContext.mouseOverElementRect=null,this.draggableContext.isPossibleDropColumn=!1,this.draggableContext.beforeColumnUid=null)}static getPointerPosition(e){return{x:e.pageX,y:e.pageY}}static getDocumentScrollPosition(){return{x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop}}static getElementPosition(e){const{left:t,top:n}=e.getBoundingClientRect();return{x:t,y:n}}}class Ae{constructor(e){this._startSelectionRowIndex=-1,this._endSelectionRowIndex=-1,this.savedSelectedRows=[],this.boundOnRowPointerEnterHandler=this.onRowPointerEnter.bind(this),this.grid=e}get startSelectionRowIndex(){return this._startSelectionRowIndex}get endSelectionRowIndex(){return this._endSelectionRowIndex}start(e,t){this._startSelectionRowIndex=this.grid.getRowVisibleIndexByTarget(e),this._startSelectionRowIndex>-1&&(this._endSelectionRowIndex=this._startSelectionRowIndex,t&&this.storeSelectedRows(),this.addRowEventSubscriptions(),this.updateRowsSelection())}stop(){this._startSelectionRowIndex>-1&&(this.deselectRows(),this.removeRowEventSubscriptions(),this.restoreSelectedRows(),this._startSelectionRowIndex=-1,this._endSelectionRowIndex=-1)}isStarted(){return this._startSelectionRowIndex>-1&&this._endSelectionRowIndex>-1}updateSeletionByEvent(e){const t=document.elementFromPoint(e.clientX,e.clientY);this.updateSeletionByElement(t)}findRowElement(e){return this.grid.getMainElement().querySelector(`tr[${ne.VisibleIndexName}="${e}"]`)}findRowElements(){return this.grid.getMainElement().querySelectorAll(`tr[${ne.VisibleIndexName}]`)}findSelectedRowElements(){return this.grid.getMainElement().querySelectorAll(`tr.${K.SelectedRowClassName}[${ne.VisibleIndexName}]`)}addRowEventSubscriptions(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].addEventListener("pointerenter",this.boundOnRowPointerEnterHandler)}removeRowEventSubscriptions(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].removeEventListener("pointerenter",this.boundOnRowPointerEnterHandler)}updateSeletionByElement(e){const t=this.grid.getRowVisibleIndexByTarget(e,!0);t>-1&&(this._endSelectionRowIndex=t,this.updateRowsSelection())}onRowPointerEnter(e){this.updateSeletionByElement(e.target)}selectRows(e){for(let t=0;t<e.length;t++){const n=this.findRowElement(e[t]);n&&n.classList.add(0===t||t===e.length-1?K.TouchSelectionEdgeClassName:K.TouchSelectionClassName)}}deselectRows(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].classList.remove(K.TouchSelectionClassName,K.TouchSelectionEdgeClassName)}updateRowsSelection(){if(-1===this.startSelectionRowIndex||-1===this.endSelectionRowIndex)return;this.deselectRows();const e=Math.min(this.startSelectionRowIndex,this.endSelectionRowIndex),t=Math.max(this.startSelectionRowIndex,this.endSelectionRowIndex),n=Array.from({length:t-e+1},((t,n)=>n+e));this.selectRows(n)}storeSelectedRows(){const e=this.findSelectedRowElements();if(e)for(let t=0;t<e.length;t++)e[t].classList.remove(K.SelectedRowClassName),this.savedSelectedRows.push(e[t])}restoreSelectedRows(){for(let e=0;e<this.savedSelectedRows.length;e++)this.savedSelectedRows[e].classList.add(K.SelectedRowClassName);this.savedSelectedRows=[]}}!function(e){e[e.Disabled=0]="Disabled",e[e.LeftBorder=1]="LeftBorder",e[e.BetweenBorders=2]="BetweenBorders",e[e.RightBorder=3]="RightBorder"}(Fe||(Fe={}));class Ke{get highlightLeftBorder(){return this.scrollStatus===Fe.BetweenBorders||this.scrollStatus===Fe.RightBorder||this.isDragging}get highlightRightBorder(){return this.scrollStatus===Fe.BetweenBorders||this.scrollStatus===Fe.LeftBorder||this.isDragging}constructor(e){this.grid=e,this.gridUid="",this.lastGeneratedStyle="",this.isDragging=!1,this.scrollStatus=Fe.Disabled}notifyColumnDragStarted(){this.hasAnyFixedColumn()&&(this.isDragging=!0,requestAnimationFrame((()=>this.updateFixedCellsStyle())))}notifyColumnDragEnded(){this.hasAnyFixedColumn()&&(this.isDragging=!1,requestAnimationFrame((()=>this.updateFixedCellsStyle())))}scrollPositionUpdated(e){this.hasAnyFixedColumn()&&(this.scrollStatus=this.calcScrollStatus(e),requestAnimationFrame((()=>this.updateFixedCellsStyle())))}updateFixedCellsStyle(){this.gridUid=this.grid.getAttribute(Ue);const e=this.grid.querySelector("style");if(!e)return;let t="";this.hasAnyFixedColumn()&&(t+=this.createPositionStyles(),t+=this.createBorderStyles()),this.lastGeneratedStyle!==t&&(e.innerText=t,this.lastGeneratedStyle=t)}createPositionStyles(){const e=this.grid.getColElements(),t=this.getOffsetWidths(e),n=new Array(t.length),i=new Array(t.length);n[0]=0,i[t.length-1]=0;for(let e=1;e<t.length;++e)n[e]=n[e-1]+t[e-1];for(let e=t.length-2;e>=0;--e)i[e]=i[e+1]+t[e+1];const s=this.grid.columnsInfo.some((e=>"left"===e.fixedPosition));let o="";for(let e=0;e<this.grid.columnsInfo.length;++e){const t=this.grid.columnsInfo[e];let r=t.fixedPosition;if(t.isIndent&&s&&(r="left"),r){o+=this.createPositionStyleForColumn(e,r,"left"===r?n[e]:i[e])}}return o}hasAnyFixedColumn(){return this.grid.columnsInfo.some((e=>!!e.fixedPosition))}calcScrollStatus(e){const t=this.grid.getDataTable().clientWidth;return t===e.clientWidth?Fe.Disabled:0===e.scrollLeft?Fe.LeftBorder:Math.abs(t-e.clientWidth-e.scrollLeft)<1?Fe.RightBorder:Fe.BetweenBorders}createPositionStyleForColumn(e,t,n){return this.getTableRowsSelector()+` > .${K.FixedCellClassName}:nth-child(${e+1})`+` { ${t}: ${n}px; }`}createBorderStyles(){const e=["td","th"];let t="";if(this.highlightLeftBorder)for(const n of e)t+=this.getTableRowsSelector()+` > ${n}.${K.LastLeftFixedCellClassName} { border-right-color: var(--dxbl-grid-fixed-column-border-color); }`;if(this.highlightRightBorder)for(const n of e)t+=this.getTableRowsSelector()+` > ${n}:not(.${K.FixedCellClassName}) + ${n}.${K.FixedCellClassName} { border-left-color: var(--dxbl-grid-fixed-column-border-color); }`;return t}getTableRowsSelector(){return[`${Le}[${Ue}="${this.gridUid}"]`,`.${f.ClassName}`,`.${f.ContentContainerClassName}`,`.${K.DataTableClassName}`,"*","tr"].join(" > ")}getOffsetWidths(e){const t=[];for(let n=0;n<e.length;++n)t.push(this.grid.getColElementOffsetWidth(n));return t}}const ze=document.createElement("template");ze.innerHTML="\n<style></style>\n<slot />";const Le="dxbl-grid",Ue="data-dx-grid-uid";class $e extends e{constructor(){super(),this._columnsInfo=[],this._allowSelectRowByClick=!1,this._enableFocusedRow=!1,this._enableInplaceEditing=!1,this._enableMultiSelect=!1,this._hasRowClickEvent=!1,this._hasRowDblClickEvent=!1,this._isEditing=!1,this._latestAutoFitColumnWidthsRequestGuid=null,this.boundOnDragStartHandler=this.onDragStart.bind(this),this.boundOnDragStopHandler=this.onDragStop.bind(this),this.boundOnDragCancelHandler=this.onDragCancel.bind(this),this.boundOnClickHandler=this.onClick.bind(this),this.boundOnDblClickHandler=this.onDblClick.bind(this),this.boundOnScrollViewerUpdateHandler=this.onScrollViewerUpdate.bind(this),this.boundOnScrollViewerScrollHandler=this.onScrollViewerScroll.bind(this),this.boundOnDocumentKeyDownHandler=this.onDocumentKeyDown.bind(this),this.boundOnMouseDownHandler=this.onMouseDown.bind(this),this.currentWidth=-1,this.draggingHelper=new Oe(this),this.columnWidthsController=new V(this),this.selectionHelper=new Ae(this),this._editorManager=new le(this),this._styleGenerator=null,this.resizeObserver=new ResizeObserver(this.onSizeChanged.bind(this))}initializeComponent(){super.initializeComponent(),this._editorManager.initialize(),this._styleGenerator=new Ke(this),this._uiHandlersBridge=this.querySelector(d),this.initializeKeyboardNavigator(),this.ensureColumnResizeStrategy(),this.addEventSubscriptions(),this.resizeObserver.observe(this)}disposeComponent(){this.removeEventSubscriptions(),this.resizeObserver.unobserve(this),this._editorManager.dispose(),delete this._uiHandlersBridge,delete this.keyboardNavigator,super.disposeComponent()}get hoverTitleElementsSelector(){return ie.TitleElementsSelector}getMainElement(){return this}getDataTable(){return this.querySelector(ie.DataTableSelector)}getHeaderRow(){return this.querySelector(`thead > tr.${K.HeaderRowClassName}`)}getFilterRow(){return this.querySelector(`thead > tr.${K.FilterRowClassName}`)}getHeaderCells(){return this.querySelectorAll(`.${K.HeaderElementClassName}`)}getToolbarContainer(){return this.querySelector(`.${K.ToolbarContainerClassName}`)}getGroupPanelContentContainer(){return this.querySelector(`.${K.GroupPanelContentContainerClassName}`)}getSearchBoxContainer(){return this.querySelector(`.${K.SearchBoxContainerClassName}`)}getEmptyHeaderCellContentContainer(){return this.querySelector(`.${K.EmptyHeaderCellContentContainerClassName}`)}getGroupContentFreeSpaceElement(){return this.querySelector(`.${K.GroupContentFreeSpaceClassName}`)}getColElements(){return this.querySelectorAll(ie.ColElementSelector)}getFooterRow(){return this.querySelector(`.${K.FooterRowClassName}`)}getPagerPanel(e){return this.querySelector(`:scope > ${ie.PagerPanelSelector}.${e?K.TopPanelClassName:K.BottomPanelClassName}`)}getScrollViewer(){return this.querySelector(`.${f.ClassName}`)}getScrollViewerContent(){return this.querySelector(`.${f.ContentContainerClassName}`)}getTableContainerWidth(){const e=this.getScrollViewerContent();return e?null==e?void 0:e.getBoundingClientRect().width:0}getColumnResizeSeparator(){return this.querySelector(`.${K.ColumnsSeparatorClassName}`)}initializeKeyboardNavigator(){this.keyboardNavigator=this.querySelector(ie.KeyboardNavigatorSelector),this.keyboardNavigator&&!this.keyboardNavigator.initialized&&this.keyboardNavigator.initialize(this,new Re(this))}getKeyboardNavigator(){return this.keyboardNavigator}getColElementOffsetWidth(e){let t=this.getColElements()[e].getBoundingClientRect().width;if(0===t&&(h.Browser.Safari||h.Browser.MacOSMobilePlatform||h.Browser.WebKitFamily||h.Browser.AndroidDefaultBrowser)){const n=this.getHeaderRow();t=n?n.cells[e].getBoundingClientRect().width:null}return t}addEventSubscriptions(){var e;this.addEventListener(o.eventName,this.boundOnDragStartHandler),this.addEventListener(s.eventName,this.boundOnDragStopHandler),this.addEventListener(r.eventName,this.boundOnDragCancelHandler),this.addEventListener(l.eventName,this.boundOnClickHandler),this.addEventListener(a.eventName,this.boundOnDblClickHandler),this.addEventListener(p.eventName,this.boundOnScrollViewerUpdateHandler),null===(e=this.getScrollViewer())||void 0===e||e.subscribeToScroll(this.boundOnScrollViewerScrollHandler),document.addEventListener("keydown",this.boundOnDocumentKeyDownHandler),h.Browser.Firefox&&this.addEventListener("mousedown",this.boundOnMouseDownHandler)}removeEventSubscriptions(){var e;this.removeEventListener(o.eventName,this.boundOnDragStartHandler),this.removeEventListener(s.eventName,this.boundOnDragStopHandler),this.removeEventListener(r.eventName,this.boundOnDragCancelHandler),this.removeEventListener(l.eventName,this.boundOnClickHandler),this.removeEventListener(a.eventName,this.boundOnDblClickHandler),this.removeEventListener(p.eventName,this.boundOnScrollViewerUpdateHandler),null===(e=this.getScrollViewer())||void 0===e||e.unsubscribeFromScroll(),document.removeEventListener("keydown",this.boundOnDocumentKeyDownHandler),h.Browser.Firefox&&this.removeEventListener("mousedown",this.boundOnMouseDownHandler)}onDragStart(e){var t,n,i;const s=e.target,o=e.detail.source;if(this.isResizeAnchor(s)){const e=this.findHeaderElement(s),n=this.getElementIndex(e);null===(t=this.columnResizeStrategy)||void 0===t||t.startDrag(n,o.pageX)}else if(this.isHeaderContentElement(s)){const e=this.findHeaderElement(s);e&&(this.draggingHelper.start(e,o),null===(n=this.getScrollViewer())||void 0===n||n.startAutoScrolling(c.Horizontal,(e=>this.draggingHelper.updateDraggableContextByEvent(e))))}else this.selectionHelper.start(o.target,!o.ctrlKey&&!o.metaKey&&!e.detail.isLongTap),null===(i=this.getScrollViewer())||void 0===i||i.startAutoScrolling(c.Vertical,(e=>this.selectionHelper.updateSeletionByEvent(e)),(e=>{const t=this.getDataTable();if(t){const n=t.querySelector("thead");n&&(e.y+=n.offsetHeight,e.height-=n.offsetHeight);const i=t.querySelector("tfoot");i&&(e.height-=i.offsetHeight)}}));e.stopPropagation()}onDragStop(e){var t,n;if(null===(t=this.columnResizeStrategy)||void 0===t?void 0:t.isResizing)this.columnResizeStrategy.stopDrag();else if(this.draggingHelper.isStarted()){const e=this.draggingHelper.createColumnDraggedHandlerArgs();this.draggingHelper.stop(),this.onColumnDragged(e)}else if(this.selectionHelper.isStarted()){if(this.uiHandlersBridge&&this.selectionHelper.startSelectionRowIndex>-1&&this.selectionHelper.endSelectionRowIndex>-1){this.uiHandlersBridge.send("rowDragged",{startVisibleIndex:this.selectionHelper.startSelectionRowIndex,endVisibleIndex:this.selectionHelper.endSelectionRowIndex,cleanSelection:!e.detail.source.ctrlKey&&!e.detail.source.metaKey&&!e.detail.isLongTap})}this.selectionHelper.stop()}null===(n=this.getScrollViewer())||void 0===n||n.stopAutoScrolling(),e.stopPropagation()}onDragCancel(e){var t,n;(null===(t=this.columnResizeStrategy)||void 0===t?void 0:t.isResizing)?this.columnResizeStrategy.cancelDrag():this.draggingHelper.isStarted()?this.draggingHelper.stop():this.selectionHelper.isStarted()&&this.selectionHelper.stop(),null===(n=this.getScrollViewer())||void 0===n||n.stopAutoScrolling(),e.stopPropagation()}onClick(e){this.isResizeAnchor(e.target)&&e.detail.source.stopPropagation()}onDblClick(e){var t;const n=e.target;if(this.isResizeAnchor(n)){e.stopPropagation();const i=this.findHeaderElement(n),s=this.getElementIndex(i);null===(t=this.columnResizeStrategy)||void 0===t||t.autoFitColumnWidth(s)}}onScrollViewerUpdate(e){const t=this.getScrollViewerContent(),n=this.getDataTable();t&&n&&(n.offsetHeight<t.clientHeight?E.DomUtils.addClassName(n,K.DataTableNoScrollClassName):n.offsetHeight>t.clientHeight&&E.DomUtils.removeClassName(n,K.DataTableNoScrollClassName)),e.stopPropagation()}onScrollViewerScroll(){this.styleGenerator.scrollPositionUpdated(this.getScrollViewerContent())}getRowVisibleIndexByTarget(e,t){let n=e;for(;n&&n!==this&&(t||!n.classList.contains(K.EditRowClassName));){if("tr"===n.tagName.toLowerCase()&&n.dataset.visibleIndex)return parseInt(n.dataset.visibleIndex);n=n.parentElement}return-1}get allowSelectRowByClick(){return this._allowSelectRowByClick}set allowSelectRowByClick(e){this._allowSelectRowByClick=e,this.updateHandlePointerEventsMode()}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e,this.updateHandlePointerEventsMode()}get enableFocusedRow(){return this._enableFocusedRow}set enableFocusedRow(e){this._enableFocusedRow=e,this.updateHandlePointerEventsMode()}get enableInplaceEditing(){return this._enableInplaceEditing}set enableInplaceEditing(e){this._enableInplaceEditing=e}get isEditing(){return this._isEditing}set isEditing(e){this._isEditing=e}get keyboardNavigationEnabled(){return!!this.keyboardNavigator}get hasRowClickEvent(){return this._hasRowClickEvent}set hasRowClickEvent(e){this._hasRowClickEvent=e,this.updateHandlePointerEventsMode()}get hasRowDblClickEvent(){return this._hasRowDblClickEvent}set hasRowDblClickEvent(e){this._hasRowDblClickEvent=e,this.updateHandlePointerEventsMode()}get columnsInfo(){return this._columnsInfo}get styleGenerator(){return this._styleGenerator}get editorManager(){return this._editorManager}get uiHandlersBridge(){return this._uiHandlersBridge}get uId(){return this.getAttribute(Ue)}updateHandlePointerEventsMode(){this.handlePointerEventsMode=n.None,(this.hasRowClickEvent||this.enableFocusedRow)&&(this.handlePointerEventsMode|=n.Click),this.hasRowDblClickEvent&&(this.handlePointerEventsMode|=n.DblClick),this.allowSelectRowByClick&&(this.handlePointerEventsMode|=n.Click,this.enableMultiSelect&&h.Browser.TouchUI&&(this.handlePointerEventsMode|=n.Dragging))}notifyFocusedRowChanged(e){if(this.enableFocusedRow&&this.uiHandlersBridge){this.uiHandlersBridge.send("focusedRowChanged",{visibleIndex:e})}}notifyColumnsInitialized(e){this._columnsInfo=e}notifyColumnsChanged(e){this._columnsInfo=e,this.correctWidths($.ColumnsChanged)}notifyColumnResizeAnchorFocus(e){var t;const n=this.findHeaderElement(e),i=this.getElementIndex(n);null===(t=this.columnResizeStrategy)||void 0===t||t.anchorFocused(i)}notifyColumnResizeAnchorBlur(){var e;null===(e=this.columnResizeStrategy)||void 0===e||e.anchorUnfocused()}notifyColumnResizeAnchorMove(e){var t;null===(t=this.columnResizeStrategy)||void 0===t||t.performMoveStep(e)}updateEmptyColumnVisibility(){this.columnWidthsController.updateEmptyColumnVisibility()}autoFitColumnWidthsLegacy(e=!1){this.columnWidthsController.autoFitColumnWidthsLegacy(e)}autoFitColumnWidths(){this.columnWidthsController.autoFitColumnWidths()}correctWidths(e){var t;if(null===(t=this.columnResizeStrategy)||void 0===t?void 0:t.isResizing)return;this.columnWidthsController.correctWidths(e);const n=this.getScrollViewer();n&&n.refreshUI&&n.refreshUI()}getElementIndex(e){if(!e)return-1;if(e instanceof HTMLTableCellElement)return e.cellIndex;if(e&&e.parentElement)for(let t=0;t<e.parentElement.children.length;t++)if(e.parentElement.children[t]===e)return t;return-1}getColumnInfo(e){const t=this.findHeaderElement(e),n=this.getElementIndex(t);return 0<=n&&n<this.columnsInfo.length?this.columnsInfo[n]:null}getCellInfo(e){return re.fromElement(this,e)}getColumnInfoByCell(e){if(e instanceof HTMLElement){const t=this.getElementIndex(e);if(t>=0&&t<this.columnsInfo.length)return this.columnsInfo[t]}return null}getColumnUID(e){const t=this.getColumnInfo(e);return t?t.uID:-1}findHeaderElement(e){const t=e;return t?this.isHeaderElement(t)?t:t.closest(`.${K.HeaderElementClassName}`):null}isHeaderElement(e){return e&&e.classList.contains(K.HeaderElementClassName)}isHeaderContentElement(e){return e.tagName.toLowerCase()===z}isResizeAnchor(e){return e.classList.contains(K.ColumnsResizeAnchorClassName)}onDocumentKeyDown(e){if(!this.keyboardNavigationEnabled&&("Enter"===e.key||" "===e.key)){const t=this.findHeaderElement(e.target);if(t){const n=new MouseEvent("click",{bubbles:!0,cancelable:!0,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey});t.dispatchEvent(n)}}}onMouseDown(e){e.ctrlKey&&e.preventDefault()}onColumnChooserItemDragged(e,t){this.onColumnDragged({columnUid:e,beforeColumnUid:t,srcArea:We.ColumnChooser,dropArea:We.ColumnChooser})}onColumnDragged(e){e&&this.uiHandlersBridge&&this.uiHandlersBridge.send("columnHeaderDragged",e)}onColumnWidthsChanged(e,t){this.uiHandlersBridge&&this.uiHandlersBridge.send("columnWidthsChanged",{columnUids:e,widths:t})}onSizeChanged(e){const t=e[0].contentRect.width;this.currentWidth!==t&&t>0&&(this.correctWidths(-1===this.currentWidth?$.ColumnsChanged:$.GridResize),this.currentWidth=t)}getContentTemplate(){return ze}static get observedAttributes(){return["allow-select-row-by-click","enable-multi-select","has-row-click-event","has-row-dbl-click-event","resize-mode","enable-focused-row","enable-inplace-editing","is-editing","request-auto-fit-column-widths","focus-pending-editor-column-uid","is-pending-editor-show"]}attributeChangedCallback(e,t,n){var i;switch(e){case"allow-select-row-by-click":this.allowSelectRowByClick=null!==n;break;case"enable-focused-row":this.enableFocusedRow=null!==n;break;case"enable-multi-select":this.enableMultiSelect=null!==n;break;case"enable-inplace-editing":this.enableInplaceEditing=null!=n;break;case"has-row-click-event":this.hasRowClickEvent=null!==n;break;case"has-row-dbl-click-event":this.hasRowDblClickEvent=null!==n;break;case"is-editing":this.isEditing=null!==n;break;case"resize-mode":null===(i=this.columnResizeStrategy)||void 0===i||i.cancelDrag(),this.ensureColumnResizeStrategy();break;case"is-pending-editor-show":this.editorManager.notifyPendingEditorShow(null!==n);break;case"focus-pending-editor-column-uid":null!==n&&this.requestFocusEditor(parseInt(n));break;case"request-auto-fit-column-widths":if(n){const e=JSON.parse(n);if(e[0]&&e[0]!==this._latestAutoFitColumnWidthsRequestGuid)if(this._latestAutoFitColumnWidthsRequestGuid=e[0],2===e.length){const t=e[1];setTimeout((()=>{this.autoFitColumnWidthsLegacy(t)}))}else setTimeout((()=>{this.autoFitColumnWidths()}))}}}ensureColumnResizeStrategy(){const e=this.getAttribute("resize-mode");this.columnResizeStrategy=e?"next-column"===e?new q(this):new j(this):void 0}requestFocusEditor(e){setTimeout((()=>this.focusEditor(e)),0)}focusEditor(e){const t=this.uId;if(null===t)return;const n=this.querySelector(ie.getBodyEditRowSelector(t));if(null===n)return;let i=null;for(const t of n.cells){const n=this.getCellInfo(t);if(null!==n&&n.columnInfo.uID===e&&n.type===Z.Edit){i=t;break}}if(null===i)return;const s=S.findFocusableElements(i),o=s.length>0?s[0]:null;o&&(o.focus(),de.selectInputValue(o))}static findGrid(e){return document.querySelector(`${Le}[${Ue}="${e}"]`)}}customElements.define(Le,$e),customElements.define(z,class extends e{constructor(){super(),this.handlePointerEventsMode=n.Click|n.Dragging}get handlePointerEventsTarget(){return this.closest(`.${K.HeaderElementClassName}`)}get handlePointerEventsDelay(){return i}}),customElements.define("dxbl-grid-columns-info",class extends e{get data(){return this.getAttribute("data")}get columns(){return null!==this.data?this.parseColumns(this.data):[]}constructor(){super()}initializeComponent(){super.initializeComponent(),this.grid=this.closest(`.${K.ClassName}`),this.grid.notifyColumnsInitialized(this.columns)}parseColumns(e){const t=JSON.parse(e),n=[];for(let e=0;e<t.length;e++){const i=t[e],s=i.DragRestrictions?new L(i.DragRestrictions.PreviousColumnUid,i.DragRestrictions.NextColumnUid,i.DragRestrictions.NextVisibleColumnUid):null,o=new U(i.UID,i.AllowGroup,i.Width,i.MinWidth,i.FixedPosition,i.IsIndent,i.IsEmpty,i.IsDetail,i.IsEditable,i.AllowReorder,s);n.push(o)}return n}static get observedAttributes(){return["data"]}attributeChangedCallback(e,t,n){var i;null===(i=this.grid)||void 0===i||i.notifyColumnsChanged(this.parseColumns(n))}}),customElements.define("dxbl-column-resize-anchor",class extends e{constructor(){super(),this.boundOnAnchorFocusHandler=this.onAnchorFocus.bind(this),this.boundOnAnchorBlurHandler=this.onAnchorBlur.bind(this),this.boundOnKeyDownHandler=this.onKeyDown.bind(this),this.handlePointerEventsMode=n.Click|n.DblClick|n.Dragging}get handlePointerEventsDelay(){return i}initializeComponent(){var e,n,i;super.initializeComponent(),h.Browser.TouchUI&&this.classList.add(t.Touch),this.grid=this.closest(`.${K.ClassName}`),this.focusableElement=this.querySelector("div"),null===(e=this.focusableElement)||void 0===e||e.addEventListener("focus",this.boundOnAnchorFocusHandler),null===(n=this.focusableElement)||void 0===n||n.addEventListener("blur",this.boundOnAnchorBlurHandler),null===(i=this.focusableElement)||void 0===i||i.addEventListener("keydown",this.boundOnKeyDownHandler)}disposeComponent(){var e,t,n;super.disposeComponent(),null===(e=this.focusableElement)||void 0===e||e.removeEventListener("focus",this.boundOnAnchorFocusHandler),null===(t=this.focusableElement)||void 0===t||t.removeEventListener("blur",this.boundOnAnchorBlurHandler),null===(n=this.focusableElement)||void 0===n||n.removeEventListener("keydown",this.boundOnKeyDownHandler)}onAnchorFocus(e){var t;null===(t=this.grid)||void 0===t||t.notifyColumnResizeAnchorFocus(e.target)}onAnchorBlur(){var e;null===(e=this.grid)||void 0===e||e.notifyColumnResizeAnchorBlur()}onKeyDown(e){var t,n;e.keyCode===u.KeyCode.Left&&(e.preventDefault(),null===(t=this.grid)||void 0===t||t.notifyColumnResizeAnchorMove(k.Left)),e.keyCode===u.KeyCode.Right&&(e.preventDefault(),null===(n=this.grid)||void 0===n||n.notifyColumnResizeAnchorMove(k.Right))}}),customElements.define("dxbl-column-resize-separator",Y),customElements.define("dxbl-grid-column-chooser",class extends e{constructor(){super(),this.boundOnDragStartHandler=this.onDragStart.bind(this),this.boundOnDragStopHandler=this.onDragStop.bind(this),this.boundOnDragCancelHandler=this.onDragCancel.bind(this),this.grid=null,this.scrollViewer=null,this.itemsReorderHelper=new te(this.onItemsReording.bind(this)),this.handlePointerEventsMode=n.Dragging}get handlePointerEventsDelay(){return i}get useShadowDom(){return!1}initializeComponent(){super.initializeComponent(),this.addEventSubscriptions(),this.grid=$e.findGrid(this.getAttribute(Ue)),this.scrollViewer=this.querySelector(`.${f.ClassName}`),this.initializeKeyboardNavigator()}disposeComponent(){super.disposeComponent(),this.removeEventSubscriptions(),delete this.keyboardNavigator}getColumnUid(e){return parseInt(e.getAttribute("data-column-uid"))}addEventSubscriptions(){this.addEventListener(o.eventName,this.boundOnDragStartHandler),this.addEventListener(s.eventName,this.boundOnDragStopHandler),this.addEventListener(r.eventName,this.boundOnDragCancelHandler)}removeEventSubscriptions(){this.removeEventListener(o.eventName,this.boundOnDragStartHandler),this.removeEventListener(s.eventName,this.boundOnDragStopHandler),this.removeEventListener(r.eventName,this.boundOnDragCancelHandler)}initializeKeyboardNavigator(){this.keyboardNavigator=this.querySelector(I),this.keyboardNavigator&&!this.keyboardNavigator.initialized&&this.keyboardNavigator.initialize(this,new He(this,this.keyboardNavigator))}onDragStart(e){var t;const n=e.detail.source,i=n.target,s=i.closest(`.${K.ColumnChooserItemDragAnchorClassName}`),o=i.closest(`.${K.ColumnChooserItemClassName}`);if(null!=s&&null!=o){const e=Array.from(this.getElementsByClassName(K.ColumnChooserItemClassName));this.itemsReorderHelper.start(e,o,n),null===(t=this.scrollViewer)||void 0===t||t.startAutoScrolling(c.Vertical,(()=>{this.itemsReorderHelper.refreshUI()}))}}onDragStop(e){var t;this.itemsReorderHelper.stop(),null===(t=this.scrollViewer)||void 0===t||t.stopAutoScrolling()}onDragCancel(e){var t;this.itemsReorderHelper.cancel(),null===(t=this.scrollViewer)||void 0===t||t.stopAutoScrolling()}onItemsReording(e,t,n,i){const s=t.indexOf(n),o=e[n];let r=null;if(!(s===t.length-1)){r=e[t[s+1]]}this.applyStyles(e,o,r,i),i===X.Stop&&this.onItemsReorded(o,r)}applyStyles(e,t,n,i){for(let t=0;t<e.length;t++){const s=e[t],o=s.classList.contains(K.ColumnChooserDraggingItemNextSiblingClassName);(i!==X.ItemMoving||o&&s!==n)&&s.classList.remove(K.ColumnChooserDraggingItemNextSiblingClassName)}i===X.ItemMoving?(t.classList.contains(K.ColumnChooserDraggingItemClassName)||t.classList.add(K.ColumnChooserDraggingItemClassName),null==n||n.classList.contains(K.ColumnChooserDraggingItemNextSiblingClassName)||n.classList.add(K.ColumnChooserDraggingItemNextSiblingClassName)):(t.classList.remove(K.ColumnChooserDraggingItemClassName),null==n||n.classList.remove(K.ColumnChooserDraggingItemNextSiblingClassName))}onItemsReorded(e,t){if(null==this.grid)return;const n=this.getColumnUid(e),i=null!=t?this.getColumnUid(t):null;setTimeout((()=>{var e;return null===(e=this.grid)||void 0===e?void 0:e.onColumnChooserItemDragged(n,i)}),200)}});const Ge={loadModule:function(){}};export{$e as DxGrid,Le as DxGridTagName,Ue as DxGridUidAttributeName,Ge as default};
