import{d as e}from"./dom-e3fa5208.js";import{D as t}from"./dx-html-element-base-3bcbe019.js";import{C as s}from"./css-classes-f45f6949.js";import{_ as n}from"./_tslib-6e8ca86b.js";import{H as i,D as a,L as r,a as o,b as l,c as d}from"./dx-html-element-pointer-events-helper-1bf230d1.js";import{S as h}from"./single-slot-element-base-4ab30292.js";import{b as c}from"./constants-d4ec8d6f.js";import{e as u}from"./property-d3853089.js";import{R as m}from"./layouthelper-1d804c8c.js";import{C as D}from"./custom-events-helper-e7f279d3.js";import{K as y,a as p}from"./dx-keyboard-navigator-38aff319.js";import{k as g}from"./key-fa0d8a82.js";import"./browser-f8f6e902.js";import"./common-eb095e4d.js";import"./data-qa-utils-8be7c726.js";import"./eventhelper-8570b930.js";import"./constants-58283e53.js";import"./devices-9f03a976.js";import"./dx-ui-element-db9e89a3.js";import"./lit-element-base-7a85dca5.js";import"./lit-element-70cf14f4.js";import"./logicaltreehelper-99f1adf9.js";import"./point-e4ec110e.js";import"./dispatcheraction-19309c7b.js";import"./focus-utils-6f61e33c.js";import"./touch-167bb2e4.js";import"./disposable-d2c2d283.js";import"./dom-utils-751497ba.js";class f{}var v,C;f.MainElement=s.Prefix+"-calendar",f.SelectedItem=f.MainElement+"-selected-item",f.SelectedRange=f.MainElement+"-selected-range",f.Header=f.MainElement+"-header",f.Content=f.MainElement+"-content",f.Footer=f.MainElement+"-footer",f.WeekRow=f.MainElement+"-week-row",f.YearRow=f.MainElement+"-year-row",f.DecadeRow=f.MainElement+"-decade-row",f.CenturyRow=f.MainElement+"-century-row",f.Day=f.MainElement+"-day",f.NotCurrentView=f.MainElement+"-not-current-view",f.HeaderHelper=f.MainElement+"-header",f.HeaderTitleButton=f.HeaderHelper+"-title-btn",f.HeaderPreviousYearButton=f.HeaderHelper+"-previous-year-btn",f.HeaderPreviousMonthButton=f.HeaderHelper+"-previous-month-btn",f.HeaderPreviousPeriodButton=f.HeaderHelper+"-previous-period-btn",f.HeaderNextYearButton=f.HeaderHelper+"-next-year-btn",f.HeaderNextMonthButton=f.HeaderHelper+"-next-month-btn",f.HeaderNextPeriodButton=f.HeaderHelper+"-next-period-btn",function(e){e.class="class",e.view="view",e.viewDate="view-date",e.enableMultiSelect="enable-multi-select",e.minDate="min-date",e.maxDate="max-date"}(v||(v={})),function(e){e.dataDate="data-date",e.dataMonth="data-month",e.dataYear="data-year",e.dataDecade="data-decade"}(C||(C={}));const I=12,S="dxbl-calendar-table-container",b=new Date(new Date(Date.UTC(1,0,1)).setUTCFullYear(1)),x=new Date(Date.UTC(9999,11,31)),w=864e5;class M{constructor(e,t){this._pointerDownDate=e.pointerDownDate,this._pointerUpDate=null,this._clearSelection=e.clearSelection,this.dayCellElements=e.dayCellElements,this._callback=t,this.refreshUI(!1)}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate!==e&&e&&(this._pointerUpDate=e,this.refreshUI(!0))}get isValid(){return!!this._pointerUpDate}stop(){this.refreshUI(!1),this.isValid&&null!==this._callback&&this._callback(this._pointerDownDate,this._pointerUpDate,this._clearSelection)}cancel(){for(let e=0;e<this.dayCellElements.length;e++){const t=this.dayCellElements[e];M.removeDayCellSelectedClasses(t),t.hasAttribute("data-selected")&&M.addSelectedClassesToCell(t)}}refreshUI(t){const s=this.getStartPointedDateRange(),n=this.getEndPointedDateRange();for(let i=0;i<this.dayCellElements.length;i++){const a=this.dayCellElements[i];if(this.isDateCellDisabled(a))continue;const r=Number(a.dataset.date);M.removeDayCellSelectedClasses(a),t&&this.isDateRangeBoundary(r,s,n)&&e.DomUtils.addClassName(a,f.SelectedRange),this.needApplySelectedStyle(r,s,n,t)&&M.addSelectedClassesToCell(a),a.hasAttribute("data-selected")&&!this.clearSelection&&M.addSelectedClassesToCell(a)}}getStartPointedDateRange(){return this.pointerUpDate?Math.min(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}getEndPointedDateRange(){return this.pointerUpDate?Math.max(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}needApplySelectedStyle(e,t,s,n){return!(e<t||e>s)&&(!n||!this.isDateRangeBoundary(e,t,s))}isDateRangeBoundary(e,t,s){if(!this.isDateDisabled(e)&&(e===t||e===s))return!0;return!(!(e>t&&e<s)||e!==this.getBoundaryDate(t,e)&&e!==this.getBoundaryDate(s,e))}getBoundaryDate(e,t){const s=e<t,n=s?1:-1;let i=e;for(;(s?i<t:i>t)&&this.isDateDisabled(i);)i+=n*w;return i}isDateCellDisabled(e){return e.hasAttribute("data-disabled")}isDateDisabled(e){const t=this.getDayCellByDay(e);return null!=t&&this.isDateCellDisabled(t)}getDayCellByDay(e){for(let t=0;t<this.dayCellElements.length;t++)if(this.dayCellElements[t].getAttribute(C.dataDate)===e.toString())return this.dayCellElements[t];return null}static addSelectedClassesToCell(t){e.DomUtils.addClassName(t,f.SelectedItem)}static removeDayCellSelectedClasses(t){e.DomUtils.removeClassName(t,f.SelectedItem),e.DomUtils.removeClassName(t,f.SelectedRange),e.DomUtils.removeClassName(t,"text-white")}}class T{constructor(e,t,s){this._pointerDownDate=e,this._pointerUpDate=null,this._clearSelection=t,this._callback=s}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate=e}get isValid(){var e;return this.pointerDownDate.getTime()===(null===(e=this.pointerUpDate)||void 0===e?void 0:e.getTime())}stop(){null!==this._callback&&this._callback(this._pointerDownDate,this._pointerUpDate,this._clearSelection)}cancel(){}}var E,F,P,H;!function(e){e[e.PreviousYear=0]="PreviousYear",e[e.PreviousMonth=1]="PreviousMonth",e[e.Title=2]="Title",e[e.NextMonth=3]="NextMonth",e[e.NextYear=4]="NextYear",e[e.PreviousPeriod=5]="PreviousPeriod",e[e.NextPeriod=6]="NextPeriod"}(E||(E={})),function(e){e[e.Header=0]="Header",e[e.DataTable=1]="DataTable",e[e.Footer=2]="Footer"}(F||(F={})),function(e){e[e.Month=0]="Month",e[e.Year=1]="Year",e[e.Decade=2]="Decade",e[e.Century=3]="Century"}(P||(P={})),function(e){e[e.January=0]="January",e[e.February=1]="February",e[e.March=2]="March",e[e.April=3]="April",e[e.May=4]="May",e[e.June=5]="June",e[e.July=6]="July",e[e.August=7]="August",e[e.September=8]="September",e[e.October=9]="October",e[e.November=10]="November",e[e.December=11]="December"}(H||(H={}));class R extends h{constructor(){super(),this._handlePointerEventsMode=i.None,this.viewDate=new Date,this.viewType=P.Month,this._pointerEventsHelper=new a(this)}get calendar(){return this._calendar||(this._calendar=e.DomUtils.getParentByTagName(this,c)),this._calendar}connectedCallback(){super.connectedCallback(),this._pointerEventsHelper.initialize()}disconnectedCallback(){super.disconnectedCallback(),this._pointerEventsHelper.dispose()}updated(e){e.has("viewDate")&&this.calendar.restoreFocus(),e.has("viewType")&&(this._handlePointerEventsMode=i.None,this.viewType===P.Month&&(this.calendar.fixCalendarTableSize(),this._handlePointerEventsMode=i.Click|i.Dragging),this.calendar.restoreFocus()),super.updated(e)}get handlePointerEventsMode(){return this._handlePointerEventsMode}get handlePointerEventsTarget(){return this}get handlePointerEventsDelay(){return r}get hoverTitleElementsSelector(){return null}}n([u({attribute:v.viewDate,converter:e=>new Date(Number(e))})],R.prototype,"viewDate",void 0),n([u({type:Number,attribute:v.view})],R.prototype,"viewType",void 0);class K extends CustomEvent{constructor(e,t,s){super(K.eventName,{detail:new _(e,t,s),bubbles:!0,composed:!0,cancelable:!0})}}K.eventName=c+".daycellpointerup";class _{constructor(e,t,s){this.PointerDownDate=e,this.PointerUpDate=t,this.ClearSelection=s}}D.register(K.eventName,(e=>e.detail));class B extends y{constructor(e,t){super(e.getKeyboardNavigator(),t),this.calendar=e}isFocusedFromOutside(){return this.calendar.isSameNode(document.activeElement)}isFocusedFromDataTable(){var e,t;return null!==(t=null===(e=this.getDataTableContainer())||void 0===e?void 0:e.contains(document.activeElement))&&void 0!==t&&t}getHeader(){return this.calendar.getHeaderElement()}getDataTableContainer(){return this.calendar.tableContainer}getFooter(){return this.calendar.getFooterElement()}}class Y extends B{constructor(e,t){super(e,t),this.itemSelector=`:scope > .${s.Button}:not(.${s.Disabled})`,this.buttonClassToButtonType=new Map([[f.HeaderPreviousYearButton,E.PreviousYear],[f.HeaderPreviousMonthButton,E.PreviousMonth],[f.HeaderPreviousPeriodButton,E.PreviousPeriod],[f.HeaderTitleButton,E.Title],[f.HeaderNextYearButton,E.NextYear],[f.HeaderNextMonthButton,E.NextMonth],[f.HeaderNextPeriodButton,E.NextPeriod]]),this.buttonTypeToButtonClass=new Map([[E.PreviousYear,f.HeaderPreviousYearButton],[E.PreviousMonth,f.HeaderPreviousMonthButton],[E.PreviousPeriod,f.HeaderPreviousPeriodButton],[E.Title,f.HeaderTitleButton],[E.NextYear,f.HeaderNextYearButton],[E.NextMonth,f.HeaderNextMonthButton],[E.NextPeriod,f.HeaderNextPeriodButton]])}getShortcutContext(){return{AreaType:F.Header,ButtonType:this.getSelectedButtonType()}}queryItems(){return this.queryItemsBySelector(this.itemSelector)}activate(){const e=this.getButtonIndexByType(this.lastFocusedButtonType);this.selectedItemIndex=this.isFocusedFromOutside()?0:this.isFocusedFromDataTable()?this.itemCount-1:null!=e?e:0,super.activate()}leaveBackward(){this.lastFocusedButtonType=void 0,super.leaveBackward()}leaveForward(){this.lastFocusedButtonType=void 0,super.leaveForward()}handleKeyDown(e){switch(g.KeyUtils.getEventKeyCode(e)){case g.KeyCode.Tab:return e.shiftKey?this.moveToPrevItem():this.moveToNextItem();case g.KeyCode.Space:case g.KeyCode.Enter:return this.performShortcutEvent(e),!0}return super.handleKeyDown(e)}moveToPrevItem(){return this.selectedItemIndex>0&&(this.selectItem(this.selectedItemIndex-1),!0)}moveToNextItem(){return this.selectedItemIndex<this.itemCount-1&&(this.selectItem(this.selectedItemIndex+1),!0)}updateSelectedItemByIndex(e){super.updateSelectedItemByIndex(e),this.lastFocusedButtonType=this.getSelectedButtonType()}getSelectedButtonType(){for(const e of this.selectedItemElement.classList)if(this.buttonClassToButtonType.has(e))return this.buttonClassToButtonType.get(e)}getButtonIndexByType(e){return e?this.items.findIndex((t=>t.classList.contains(this.buttonTypeToButtonClass.get(e)))):void 0}}class N extends B{get isObsolete(){return this.calendar.currentView!==this.currentCalendarView}constructor(e,t){super(e,t),this.boundCalendarFocusedDayChangedHandler=this.onCalendarFocusedDayChanged.bind(this),this.calendar.onFocusedDayChanged(this.boundCalendarFocusedDayChangedHandler)}activate(){this.applyCalendarFocus(),super.activate()}onDispose(){this.calendar.offFocusedDayChanged(this.boundCalendarFocusedDayChangedHandler),super.onDispose()}get daySelectionRenderer(){return this.calendar.daySelectionRenderer}getShortcutContext(){const e=this.lastShortcutArgs;return delete this.lastShortcutArgs,{AreaType:F.DataTable,Offset:null==e?void 0:e.offset,Row:null==e?void 0:e.row,Column:null==e?void 0:e.column,Date:null==e?void 0:e.date}}queryItems(){return this.queryItemsBySelector(this.itemSelector)}handleKeyDown(e){switch(g.KeyUtils.getEventKeyCode(e)){case g.KeyCode.Left:return!((e.ctrlKey||e.metaKey)&&!e.shiftKey)&&(this.moveToPrevDay(e),!0);case g.KeyCode.Right:return!((e.ctrlKey||e.metaKey)&&!e.shiftKey)&&(this.moveToNextDay(e),!0);case g.KeyCode.Up:return!((e.ctrlKey||e.metaKey)&&!e.shiftKey)&&(this.moveToPrevRow(e),!0);case g.KeyCode.Down:return!((e.ctrlKey||e.metaKey)&&!e.shiftKey)&&(this.moveToNextRow(e),!0);case g.KeyCode.Home:return this.handleHomeKey(e),!0;case g.KeyCode.End:return this.handleEndKey(e),!0;case g.KeyCode.PageUp:return this.calendar.scheduleFocusRestoration(),this.handlePageUpKey(e),!0;case g.KeyCode.PageDown:return this.calendar.scheduleFocusRestoration(),this.handlePageDownKey(e),!0;case g.KeyCode.Enter:case g.KeyCode.Space:return this.handleItemClick(e),!0}return super.handleKeyDown(e)}handleKeyUp(e){return this.isShiftKeyCode(e)&&this.stopSelectingDays(),super.handleKeyUp(e)}isShiftKeyCode(e){return 16===g.KeyUtils.getEventKeyCode(e)}getSelectedItemRowIndex(){return Math.floor(this.selectedItemIndex/this.rowLength)}getSelectedItemColumnIndex(){return Math.floor(this.selectedItemIndex%this.rowLength)}handlePageUpKey(e,t){this.prepareAndPerformShortcutEvent(e,{offset:null!=t?t:e.shiftKey?-12:-1,date:e.shiftKey?Q.getDateFromCell(this.selectedItemElement):void 0})}handlePageDownKey(e,t){this.prepareAndPerformShortcutEvent(e,{offset:null!=t?t:e.shiftKey?I:1,date:e.shiftKey?Q.getDateFromCell(this.selectedItemElement):void 0})}prepareAndPerformShortcutEvent(e,t){this.lastShortcutArgs=t,this.performShortcutEvent(e)}onCalendarFocusedDayChanged(e){e&&(this.tryRestoreSelectedItem(e),this.selectItem(this.selectedItemIndex))}applyCalendarFocus(){var e;const t=null!==(e=this.calendar.getFocusedCellElementInView(this.currentCalendarView))&&void 0!==e?e:this.targetElement.querySelector(`.${f.SelectedItem}`);t&&this.tryRestoreSelectedItem(t)}initStartDaySelection(e){null===this.daySelectionRenderer&&e.shiftKey&&this.calendar.createDaySelectionRenderer(Q.getDateFromCell(this.selectedItemElement),!e.ctrlKey&&!e.metaKey)}stopSelectingDays(){null!==this.daySelectionRenderer&&(this.daySelectionRenderer.pointerUpDate=Q.getDateFromCell(this.selectedItemElement),this.calendar.stopSelectingDays())}}class U extends N{get rowLength(){return 7}get currentCalendarView(){return P.Month}get itemSelector(){return`:scope .${f.WeekRow} > .${f.Day}`}moveToPrevDay(e){var t,s;this.initStartDaySelection(e);const n=this.calendar.tryMoveFocus({value:-1,isHorizontal:!0},this.selectedItemElement);if(n.needChangePeriod)this.switchCurrentMonth(e,null!==(s=n.periodsToSkip)&&void 0!==s?s:-1);else{const s=null!==(t=n.unitsToSkip)&&void 0!==t?t:-1;this.selectedItemIndex>=s&&this.selectItem(this.selectedItemIndex+s),e.shiftKey&&this.extendSelection()}}moveToNextDay(e){var t,s;this.initStartDaySelection(e);const n=this.calendar.tryMoveFocus({value:1,isHorizontal:!0},this.selectedItemElement);if(n.needChangePeriod)this.switchCurrentMonth(e,null!==(s=n.periodsToSkip)&&void 0!==s?s:1);else{const s=null!==(t=n.unitsToSkip)&&void 0!==t?t:1;this.selectedItemIndex<this.itemCount-s&&this.selectItem(this.selectedItemIndex+s),e.shiftKey&&this.extendSelection()}}moveToPrevRow(e){var t,s;this.initStartDaySelection(e);const n=this.calendar.tryMoveFocus({value:-1,isHorizontal:!1},this.selectedItemElement);if(n.needChangePeriod)this.switchCurrentMonth(e,null!==(s=n.periodsToSkip)&&void 0!==s?s:-1);else{const s=null!==(t=n.unitsToSkip)&&void 0!==t?t:-this.rowLength;this.selectedItemIndex>=s&&this.selectItem(this.selectedItemIndex+s),e.shiftKey&&this.extendSelection()}}moveToNextRow(e){var t,s;this.initStartDaySelection(e);const n=this.calendar.tryMoveFocus({value:1,isHorizontal:!1},this.selectedItemElement);if(n.needChangePeriod)this.switchCurrentMonth(e,null!==(s=n.periodsToSkip)&&void 0!==s?s:1);else{const s=null!==(t=n.unitsToSkip)&&void 0!==t?t:this.rowLength;this.selectedItemIndex<this.itemCount-s&&this.selectItem(this.selectedItemIndex+s),e.shiftKey&&this.extendSelection()}}handleHomeKey(e){var t;const s=this.getSelectedItemRowIndex()*this.rowLength,n={value:s-this.selectedItemIndex,isHorizontal:!0};this.initStartDaySelection(e);const i=this.calendar.tryMoveFocus(n,this.selectedItemElement);i.needChangePeriod?this.switchCurrentMonth(e,null!==(t=i.periodsToSkip)&&void 0!==t?t:-1):(this.selectedItemIndex=void 0!==i.unitsToSkip?this.selectedItemIndex+i.unitsToSkip:s,this.selectItem(this.selectedItemIndex),e.shiftKey&&this.extendSelection())}handleEndKey(e){var t;const s=(this.getSelectedItemRowIndex()+1)*this.rowLength-1,n={value:s-this.selectedItemIndex,isHorizontal:!0};this.initStartDaySelection(e);const i=this.calendar.tryMoveFocus(n,this.selectedItemElement);i.needChangePeriod?this.switchCurrentMonth(e,null!==(t=i.periodsToSkip)&&void 0!==t?t:1):(this.selectedItemIndex=void 0!==i.unitsToSkip?this.selectedItemIndex+i.unitsToSkip:s,this.selectItem(this.selectedItemIndex),e.shiftKey&&this.extendSelection())}handlePageUpKey(e){const t=e.shiftKey?Q.getYearOffsetInDaysFrom(-1,this.selectedItemElement):Q.getMonthOffsetInDaysFrom(-1,this.selectedItemElement),s=this.calendar.tryMoveFocus({value:-t,isHorizontal:!0},this.selectedItemElement);s.needChangePeriod?super.handlePageUpKey(e,s.periodsToSkip):(this.applyCalendarFocus(),this.selectItem(this.selectedItemIndex))}handlePageDownKey(e){const t=e.shiftKey?Q.getYearOffsetInDaysFrom(1,this.selectedItemElement):Q.getMonthOffsetInDaysFrom(1,this.selectedItemElement),s=this.calendar.tryMoveFocus({value:t,isHorizontal:!0},this.selectedItemElement);s.needChangePeriod?super.handlePageDownKey(e,s.periodsToSkip):(this.applyCalendarFocus(),this.selectItem(this.selectedItemIndex))}extendSelection(){null!==this.daySelectionRenderer&&(this.daySelectionRenderer.pointerUpDate=Q.getDateFromCell(this.selectedItemElement))}handleItemClick(e){this.prepareAndPerformShortcutEvent(e,{date:Q.getDateFromCell(this.selectedItemElement)})}switchCurrentMonth(e,t){this.prepareAndPerformShortcutEvent(e,{offset:t,date:this.calendar.focusedDate})}}class k extends N{get rowLength(){return 4}moveToPrevDay(e){var t;const s=this.calendar.tryMoveFocus({value:-1,isHorizontal:!0},this.selectedItemElement);if(s.needChangePeriod)this.switchCurrentMonth(e,-1);else{const e=null!==(t=s.unitsToSkip)&&void 0!==t?t:-1;this.selectedItemIndex>=e&&this.selectItem(this.selectedItemIndex+e)}}moveToNextDay(e){var t;const s=this.calendar.tryMoveFocus({value:1,isHorizontal:!0},this.selectedItemElement);if(s.needChangePeriod)this.switchCurrentMonth(e,1);else{const e=null!==(t=s.unitsToSkip)&&void 0!==t?t:1;this.selectedItemIndex<this.itemCount-e&&this.selectItem(this.selectedItemIndex+e)}}moveToPrevRow(e){var t;const s=this.calendar.tryMoveFocus({value:-1,isHorizontal:!1},this.selectedItemElement);if(s.needChangePeriod)this.switchCurrentMonth(e,-1);else{const e=null!==(t=s.unitsToSkip)&&void 0!==t?t:-this.rowLength;this.selectedItemIndex>=e&&this.selectItem(this.selectedItemIndex+e)}}moveToNextRow(e){var t;const s=this.calendar.tryMoveFocus({value:1,isHorizontal:!1},this.selectedItemElement);if(s.needChangePeriod)this.switchCurrentMonth(e,1);else{const e=null!==(t=s.unitsToSkip)&&void 0!==t?t:this.rowLength;this.selectedItemIndex<this.itemCount-e&&this.selectItem(this.selectedItemIndex+e)}}handleHomeKey(e){const t=this.getIndexOfFirstAccessibleItemInCurrentView(),s=this.calendar.tryMoveFocus({value:t-this.selectedItemIndex,isHorizontal:!0},this.selectedItemElement);s.needChangePeriod||(this.selectedItemIndex=void 0!==s.unitsToSkip?this.selectedItemIndex+s.unitsToSkip:t,this.selectItem(this.selectedItemIndex))}handleEndKey(e){const t=this.getIndexOfLastAccessibleItemInCurrentView(),s=this.calendar.tryMoveFocus({value:t-this.selectedItemIndex,isHorizontal:!0},this.selectedItemElement);s.needChangePeriod||(this.selectedItemIndex=void 0!==s.unitsToSkip?this.selectedItemIndex+s.unitsToSkip:t,this.selectItem(this.selectedItemIndex))}handleItemClick(e){this.calendar.scheduleFocusRestoration(),this.prepareAndPerformShortcutEvent(e,{row:this.getSelectedItemRowIndex(),column:this.getSelectedItemColumnIndex()})}switchCurrentMonth(e,t){this.prepareAndPerformShortcutEvent(e,{offset:t})}getIndexOfFirstAccessibleItemInCurrentView(){let e=0;for(;e<=this.selectedItemIndex&&!this.itemBelongsToCurrentView(e);)e++;return e}getIndexOfLastAccessibleItemInCurrentView(){let e=this.itemCount-1;for(;e>=this.selectedItemIndex&&!this.itemBelongsToCurrentView(e);)e--;return e}itemBelongsToCurrentView(e){var t;return!(null===(t=this.getItem(e))||void 0===t?void 0:t.classList.contains(f.NotCurrentView))}}class O extends k{get currentCalendarView(){return P.Year}get itemSelector(){return`:scope .${f.YearRow} > td`}}class V extends k{get currentCalendarView(){return P.Decade}get itemSelector(){return`:scope .${f.DecadeRow} > td:not(.${s.Invisible})`}}class z extends k{get currentCalendarView(){return P.Century}get itemSelector(){return`:scope .${f.CenturyRow} > td:not(.${s.Invisible})`}}class A extends B{constructor(e,t){super(e,t),this.itemSelector=`:scope > .${s.Button}`}getShortcutContext(){return{AreaType:F.Footer,ButtonType:this.selectedItemIndex}}queryItems(){return this.queryItemsBySelector(this.itemSelector)}activate(){this.selectedItemIndex=this.isFocusedFromOutside()?this.itemCount-1:0,super.activate()}handleKeyDown(e){switch(g.KeyUtils.getEventKeyCode(e)){case g.KeyCode.Tab:return e.shiftKey?this.moveToPrevItem():this.moveToNextItem();case g.KeyCode.Space:case g.KeyCode.Enter:return this.performShortcutEvent(e),!0}return super.handleKeyDown(e)}moveToPrevItem(){return this.selectedItemIndex>0&&(this.selectItem(this.selectedItemIndex-1),!0)}moveToNextItem(){return this.selectedItemIndex<this.itemCount-1&&(this.selectItem(this.selectedItemIndex+1),!0)}}class L extends B{constructor(e){super(e,e)}queryItems(){return new Array(this.getHeader(),this.getDataTableContainer(),this.getFooter())}createItemStrategy(e){if(e===this.getHeader())return new Y(this.calendar,e);if(e===this.getDataTableContainer())return this.createDataTableStrategy(e);if(e===this.getFooter())return new A(this.calendar,e);throw new Error("Not implemented")}createDataTableStrategy(e){switch(e.viewType){case P.Month:return new U(this.calendar,e);case P.Year:return new O(this.calendar,e);case P.Decade:return new V(this.calendar,e);case P.Century:return new z(this.calendar,e)}}handleKeyDown(e){const t=g.KeyUtils.getEventKeyCode(e);return t===g.KeyCode.Tab?(e.shiftKey?this.moveToPrevItem():this.moveToNextItem(),!0):!e.ctrlKey||t!==g.KeyCode.Up&&t!==g.KeyCode.Down?super.handleKeyDown(e):(this.calendar.scheduleFocusRestoration(),this.performShortcutEvent(e),!0)}moveToPrevItem(){this.selectedItemIndex>0?super.moveToPrevItem():this.leaveBackward()}moveToNextItem(){this.selectedItemIndex<this.itemCount-1?super.moveToNextItem():this.leaveForward()}}class ${get focusedItem(){return this._focusedItem}set focusedItem(e){this._focusedItem=e}get focusedElement(){return this._focusedElement}set focusedElement(e){this._focusedElement=e}get minDate(){return this._minDate}set minDate(e){this._minDate=e}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=e}get calendar(){return this._calendar}constructor(e){this.boundCalendarMinMaxDatesChangedHandler=this.updateMinMaxDates.bind(this),this._calendar=e,this._focusedElement=null,this._minDate=this._calendar.minDate,this._maxDate=this._calendar.maxDate,this.calendar.onMinMaxDatesChanged(this.boundCalendarMinMaxDatesChangedHandler)}get calendarCurrentViewDate(){return this.calendar.currentViewDate}getUpdatedElementToFocus(){return this.focusedElement=this.findCellElementByItem(this.getUpdatedItemToFocus()),this.focusedElement}findSelectedCellElement(){return this.calendar.querySelector(`td.${f.SelectedItem}`)}updateMinMaxDates(e,t){e&&(this._minDate=e),t&&(this._maxDate=t)}}class j extends ${tryMoveFocus(e,t){const s=Q.getMonthFromCell(t);this.focusedItem=this.getMonthRelativeTo(e,s),void 0!==this.focusedItem&&(this.focusedItem=this.applyMinMaxDates(this.focusedItem)),this.focusedElement=this.findCellElementByItem(this.focusedItem);const n=this.focusedItem&&s?this.focusedItem-s:void 0;return{needChangePeriod:this.areMonthsDifferByYear(e,s),unitsToSkip:n}}getUpdatedItemToFocus(){if(void 0===this.focusedItem){const e=this.findSelectedCellElement();this.focusedItem=e?Q.getMonthFromCell(e):this.calendarCurrentViewDate.getMonth()}return this.focusedItem&&(this.focusedItem=this.applyMinMaxDates(this.focusedItem)),this.focusedItem}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`td[${C.dataMonth}="${H[e]}"]`)}applyMinMaxDates(e){return this.calendarCurrentViewDate.getFullYear()===this.minDate.getFullYear()&&e<this.minDate.getMonth()?this.minDate.getMonth():this.calendarCurrentViewDate.getFullYear()===this.maxDate.getFullYear()&&e>this.maxDate.getMonth()?this.maxDate.getMonth():e}getMonthRelativeTo(e,t){if(void 0===t)return;const s=(this.getRawIndex(e,t)%I+I)%I;return H[H[s%I]]}areMonthsDifferByYear(e,t){if(void 0===t)return!1;const s=this.getRawIndex(e,t);return s<0||s>=I}getEffectiveOffset(e){return e.value*(e.isHorizontal?1:4)}getRawIndex(e,t){return t+this.getEffectiveOffset(e)}}class q extends ${tryMoveFocus(e,t){const s=Q.getYearFromCell(t);this.focusedItem=this.getYearRelativeTo(e,s),void 0!==this.focusedItem&&(this.focusedItem=this.applyMinMaxDates(this.focusedItem)),this.focusedElement=this.findCellElementByItem(this.focusedItem);const n=this.focusedItem&&s?this.focusedItem-s:void 0;return{needChangePeriod:this.areYearsDifferByDecade(this.calendarCurrentViewDate.getFullYear(),this.focusedItem),unitsToSkip:n}}getUpdatedItemToFocus(){if(void 0===this.focusedItem){const e=this.findSelectedCellElement();this.focusedItem=e?Q.getYearFromCell(e):this.calendarCurrentViewDate.getFullYear()}return this.focusedItem&&(this.focusedItem=this.applyMinMaxDates(this.focusedItem)),this.focusedItem}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`td[${C.dataYear}="${e}"]`)}applyMinMaxDates(e){return e<this.minDate.getFullYear()?this.minDate.getFullYear():e>this.maxDate.getFullYear()?this.maxDate.getFullYear():e}getYearRelativeTo(e,t){if(void 0!==t)return t+this.getEffectiveOffset(e)}getEffectiveOffset(e){return e.value*(e.isHorizontal?1:4)}areYearsDifferByDecade(e,t){return void 0!==e&&void 0!==t&&Math.floor(e/10)!==Math.floor(t/10)}}class J extends ${tryMoveFocus(e,t){const s=Q.getDateFromCell(t);this.focusedItem=this.applyMinMaxDates(this.getDateRelativeTo(e,t)),this.focusedElement=this.findCellElementByItem(this.focusedItem);const n=this.areDatesDifferByMonthOrYear(this.calendarCurrentViewDate,this.focusedItem);return{needChangePeriod:n,periodsToSkip:n?this.getShortcutOffsetInMonths(this.focusedItem,this.calendarCurrentViewDate):void 0,unitsToSkip:this.focusedItem?(this.focusedItem.getTime()-s.getTime())/w:void 0}}getUpdatedItemToFocus(){if(this.focusedItem=this.getFindCachedFocusedItem(),this.areDatesDifferByMonthOrYear(this.focusedItem,this.calendarCurrentViewDate)){const e=this.focusedItem.getDate();this.focusedItem=new Date(this.calendarCurrentViewDate);let t=this.trySetDate(this.focusedItem,e);null===t&&(t=this.trySetDate(this.focusedItem,this.calendarCurrentViewDate.getDate())),null===t&&(t=this.trySetDate(this.focusedItem,1)),this.focusedItem=t}return this.focusedItem=this.applyMinMaxDates(this.focusedItem),this.focusedItem}getFindCachedFocusedItem(){let e=this.focusedItem;if(void 0===e){const t=this.findSelectedCellElement();e=t?Q.getDateFromCell(t):this.calendarCurrentViewDate}return e}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`.${f.Day}[${C.dataDate}="${e.getTime()}"]`)}applyMinMaxDates(e){return e<this.minDate?new Date(this.minDate):e>this.maxDate?new Date(this.maxDate):new Date(e)}areDatesDifferByMonthOrYear(e,t){return e.getMonth()!==t.getMonth()||this.areDatesDifferByYear(e,t)}areDatesDifferByYear(e,t){return e.getUTCFullYear()!==t.getUTCFullYear()}trySetDate(e,t){const s=new Date(e);return s.setDate(t),this.areDatesDifferByMonthOrYear(s,e)?null:s}getShortcutOffsetInMonths(e,t){return e.getMonth()-t.getMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*I}getDateRelativeTo(e,t){const s=Q.getDateFromCell(t),n=new Date(s);return new Date(n.setDate(n.getDate()+e.value*(e.isHorizontal?1:7)))}}class W extends ${tryMoveFocus(e,t){const s=Q.getDecadeFromCell(t);this.focusedItem=this.getDecadeRelativeTo(e,s),void 0!==this.focusedItem&&(this.focusedItem=this.applyMinMaxDates(this.focusedItem)),this.focusedElement=this.findCellElementByItem(this.focusedItem);const n=this.focusedItem&&s?this.subtractDecade(this.focusedItem,s):void 0;return{needChangePeriod:this.areDecadesDifferByCentury(this.getCurrentDecade(),this.focusedItem),unitsToSkip:n}}getUpdatedItemToFocus(){if(void 0===this.focusedItem){const e=this.findSelectedCellElement();this.focusedItem=e?Q.getDecadeFromCell(e):this.getCurrentDecade()}return this.focusedItem&&(this.focusedItem=this.applyMinMaxDates(this.focusedItem)),this.focusedItem}findCellElementByItem(e){return void 0===e?null:this.calendar.querySelector(`td[${C.dataDecade}="${e.startYear}-${e.endYear}"]`)}applyMinMaxDates(e){return-1===this.compareDecades(e,this.getDecadeOfDate(this.minDate))?this.getDecadeOfDate(this.minDate):1===this.compareDecades(e,this.getDecadeOfDate(this.maxDate))?this.getDecadeOfDate(this.maxDate):e}getDecadeRelativeTo(e,t){if(void 0===t)return;const s=t.startYear+this.getEffectiveOffset(e);return{startYear:s,endYear:s+9}}getEffectiveOffset(e){return e.value*(e.isHorizontal?1:4)*10}areDecadesDifferByCentury(e,t){if(void 0===(null==e?void 0:e.startYear)||void 0===(null==t?void 0:t.startYear))return!1;return Math.floor(e.startYear/100)!==Math.floor(t.startYear/100)}getCurrentDecade(){return this.getDecadeOfDate(this.calendarCurrentViewDate)}getDecadeOfDate(e){const t=e.getFullYear(),s=10*Math.floor(t/10);return{startYear:s,endYear:s+9}}compareDecades(e,t){return e.startYear<t.startYear?-1:e.startYear===t.startYear?0:1}subtractDecade(e,t){return(e.startYear-t.startYear)/10}}const G=document.createElement("template");G.innerHTML="\n<style></style>\n<slot />";class Q extends t{constructor(){super(),this.boundOnStartDaySelectionHandler=this.onStartDaySelection.bind(this),this.boundOnStopDaySelectionHandler=this.onStopDaySelection.bind(this),this.boundOnCancelDaySelectionHandler=this.onCancelDaySelection.bind(this),this.boundOnDayCellPointerEnterHandler=this.onDayCellPointerEnter.bind(this),this._enableMultiSelect=!1,this._focusedCellElement=null,this._focusRestorationScheduled=!0,this._minDate=b,this._maxDate=x,this._daySelectionRenderer=null,this.calendarTableResizeObserver=new ResizeObserver(this.onCalendarTableSizeChanged.bind(this)),this.focusedDayChangedHandlers=new Set,this.minMaxDatesChangedHandlers=new Set}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e}get currentViewDate(){return this.tableContainer.viewDate}get currentView(){var e,t;return null!==(t=null===(e=this.tableContainer)||void 0===e?void 0:e.viewType)&&void 0!==t?t:P.Month}get focusedDate(){return this._focusStrategies[P.Month].getFindCachedFocusedItem()}get tableContainer(){return this._tableContainer||(this._tableContainer=this.querySelector(`${S}`)),this._tableContainer}get minDate(){return this._minDate}set minDate(e){this._minDate=e}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=e}get daySelectionRenderer(){return this._daySelectionRenderer}connectedCallback(){super.connectedCallback(),this.addEventSubscriptions()}initializeComponent(){super.initializeComponent(),this._focusStrategies={[P.Month]:new J(this),[P.Year]:new j(this),[P.Decade]:new q(this),[P.Century]:new W(this)},this.fixCalendarTableSize(),this.initializeKeyboardNavigator()}disposeComponent(){this.removeEventSubscriptions(),this.focusedDayChangedHandlers.clear(),this.minMaxDatesChangedHandlers.clear(),super.disposeComponent()}disconnectedCallback(){this.calendarTableResizeObserver.disconnect(),super.disconnectedCallback()}fixCalendarTableSize(){if(this.currentView!==P.Month)return;const e=this.getTableElement();if(!e)return;e.style.width="",e.style.height="";const t=e.getBoundingClientRect();m.fromDomRect(t).isEmpty?this.calendarTableResizeObserver.observe(e):this.applyTableSize(e,t.width,t.height)}applyTableSize(e,t,s){e.style.width=t+"px",e.style.height=s+"px"}onCalendarTableSizeChanged(e){if(e.length<1)return;const t=e[0].target,s=e[0].contentRect;m.fromDomRect(s).isEmpty||(this.applyTableSize(t,s.width,s.height),this.calendarTableResizeObserver.disconnect())}addEventSubscriptions(){this.addEventListener(o.eventName,this.boundOnStartDaySelectionHandler),this.addEventListener(l.eventName,this.boundOnStopDaySelectionHandler),this.addEventListener(d.eventName,this.boundOnCancelDaySelectionHandler)}removeEventSubscriptions(){this.removeEventListener(o.eventName,this.boundOnStartDaySelectionHandler),this.removeEventListener(l.eventName,this.boundOnStopDaySelectionHandler),this.removeEventListener(d.eventName,this.boundOnCancelDaySelectionHandler)}addDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].addEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}removeDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].removeEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}onStartDaySelection(t){if(e.DomUtils.hasClassName(this,s.Disabled)||e.DomUtils.hasClassName(this,s.ReadOnly))return;const n=Q.getDateFromTarget(t.detail.source.target);if(!n)return;this.createDaySelectionRenderer(n,!t.detail.isLongTap&&(!(t.detail.source.ctrlKey||t.detail.source.metaKey)||t.detail.isTouch)),this.addDayCellEventSubscriptions(),t.stopPropagation()}onStopDaySelection(e){this._daySelectionRenderer&&(this._daySelectionRenderer.pointerUpDate=Q.getDateFromTarget(e.detail.source.target),this.stopSelectingDays(),this.removeDayCellEventSubscriptions(),e.stopPropagation())}onCancelDaySelection(e){this._daySelectionRenderer&&(this._daySelectionRenderer.cancel(),this.removeDayCellEventSubscriptions(),this._daySelectionRenderer=null,e.stopPropagation())}stopSelectingDays(){this._daySelectionRenderer&&(this._daySelectionRenderer.stop(),this._daySelectionRenderer=null)}invokeDayCellPointerUp(e,t,s){this.dispatchEvent(new K(e,t,s))}onDayCellPointerEnter(e){if(!this._daySelectionRenderer)return;const t=Q.getDateFromTarget(e.target);this._daySelectionRenderer.pointerUpDate=t}createDaySelectionRenderer(e,t){this._daySelectionRenderer=this.enableMultiSelect?this.createMultipleDaySelectionRenderer(e,t):this.createSingleDaySelectionRenderer(e,t)}createMultipleDaySelectionRenderer(e,t){return new M({pointerDownDate:e,clearSelection:t,dayCellElements:this.findDayCellElements()},this.invokeDayCellPointerUp.bind(this))}createSingleDaySelectionRenderer(e,t){return new T(e,t,this.invokeDayCellPointerUp.bind(this))}findDayCellElements(){return this.querySelectorAll(`.${f.Day}`)}getMainElement(){return this.querySelector(`.${f.MainElement}`)}getHeaderElement(){return this.querySelector(`.${f.Header}`)}getTableElement(){return this.querySelector(`.${f.Content} > table`)}getFooterElement(){return this.querySelector(`.${f.Footer}`)}initializeKeyboardNavigator(){this.keyboardNavigator=this.querySelector(p),this.keyboardNavigator&&!this.keyboardNavigator.initialized&&this.keyboardNavigator.initialize(this,new L(this))}getKeyboardNavigator(){return this.keyboardNavigator}getFocusedCellElementInView(e){return this._focusStrategies[e].getUpdatedElementToFocus()}tryMoveFocus(e,t){const s=this._focusStrategies[this.currentView].tryMoveFocus(e,t);return s.needChangePeriod&&this.scheduleFocusRestoration(),s}scheduleFocusRestoration(){this._focusRestorationScheduled=!0}restoreFocus(){const e=this._focusStrategies[this.currentView].getUpdatedElementToFocus();this._focusRestorationScheduled&&(this._focusRestorationScheduled=!1,this.tryFireFocusedDayChanged(e),this.daySelectionRenderer&&e&&(this.daySelectionRenderer.pointerUpDate=Q.getDateFromCell(e)))}onFocusedDayChanged(e){this.focusedDayChangedHandlers.add(e)}offFocusedDayChanged(e){this.focusedDayChangedHandlers.delete(e)}onMinMaxDatesChanged(e){this.minMaxDatesChangedHandlers.add(e)}tryFireFocusedDayChanged(e){if(null!==e)for(const t of this.focusedDayChangedHandlers)t(e)}fireMinMaxDatesChanged(e,t){for(const s of this.minMaxDatesChangedHandlers)s(e,t)}static getDateFromTarget(e){const t=Q.getDayCellByTarget(e);return t?Q.getDateFromCell(t):null}static getDayCellByTarget(t){const s=t;return s?e.DomUtils.hasClassName(s,f.Day)?s:s.closest(`.${f.Day}`):null}static getDateFromCell(e){return new Date(Number(e.getAttribute(C.dataDate)))}static getMonthFromCell(e){const t=e.getAttribute(C.dataMonth);if(t)return H[t]}static getYearFromCell(e){const t=e.getAttribute(C.dataYear);if(t)return Number(t)}static getDecadeFromCell(e){const t=e.getAttribute(C.dataDecade);if(!t)return;const[s,n]=t.split("-").map(Number);return{startYear:s,endYear:n}}static getMonthOffsetInDaysFrom(e,t){const s=Q.getDateFromCell(t),n=s.getDate(),i=new Date(s);i.setDate(1),i.setMonth(i.getMonth()+e);const a=this.getLastDayOfTheMonth(i);return i.setDate(n>a?a:n),Math.abs(i.getTime()-s.getTime())/w}static getYearOffsetInDaysFrom(e,t){const s=Q.getDateFromCell(t),n=s.getDate(),i=new Date(s);i.setDate(1),i.setFullYear(i.getFullYear()+e);const a=this.getLastDayOfTheMonth(i);return i.setDate(n>a?a:n),Math.abs(i.getTime()-s.getTime())/w}static getLastDayOfTheMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()}getContentTemplate(){return G}static get observedAttributes(){return[v.class,v.enableMultiSelect,v.minDate,v.maxDate]}attributeChangedCallback(e,t,s){switch(e){case v.class:this.fixCalendarTableSize();break;case v.enableMultiSelect:this.enableMultiSelect=null!==s;break;case v.minDate:{const e=new Date(Number(s));this.minDate=e>=b?e:b,this.fireMinMaxDatesChanged(this.minDate);break}case v.maxDate:{const e=new Date(Number(s));this.maxDate=e<=x?e:x,this.fireMinMaxDatesChanged(void 0,this.maxDate);break}}}}customElements.define(c,Q),customElements.define(S,R);const X={loadModule:function(){}};export{Q as DxCalendar,X as default};
