import{D as e}from"./dx-ui-element-db9e89a3.js";import{P as t}from"./portal-9686dca9.js";import{o as n,q as o}from"./popup-a1c2390a.js";import{E as s}from"./eventhelper-8570b930.js";import{d as r,e as i,f as a}from"./logicaltreehelper-99f1adf9.js";import{y as l}from"./lit-element-70cf14f4.js";import{k as u}from"./key-fa0d8a82.js";import{P as d,S as h,a as p,b as m,c as D,d as c,e as w}from"./menu-keyboard-strategy-40347a11.js";import{removeFocusHiddenAttribute as S}from"./focus-utils-6f61e33c.js";class E extends e{constructor(){super(),this.boundOnDropDownElementChangedHandler=this.onDropDownElementChanged.bind(this),this.boundOnDropDownShownHandler=this.onDropDownShown.bind(this),this.boundOnDropDownClosedHandler=this.onDropDownClosed.bind(this),this.boundOnDropDownPortalElementsChangedHandler=this.onDropDownPortalElementsChanged.bind(this),this.boundSlotChangedHandler=this.onSlotChanged.bind(this),this.dropDownPortal=null,this._dropDownElement=null,this._adaptiveDropDownElement=null}get dropDownElement(){return this._dropDownElement}get useMobileFocusBehaviour(){var e;return(null===(e=this._adaptiveDropDownElement)||void 0===e?void 0:e.adaptivityEnabled)||!1}connectedCallback(){super.connectedCallback(),this.ensureDropDownInfrastructure(),this.addEventListener(t.eventName,this.boundOnDropDownElementChangedHandler)}disconnectedCallback(){this.removeEventListener(t.eventName,this.boundOnDropDownElementChangedHandler),this.disposeDropDownInfrastructure(),super.disconnectedCallback()}render(){return l`
            <slot @slotchange="${this.boundSlotChangedHandler}">
            </slot>
        `}processCapturedKeyDownAsync(e,t){return this.invokeKeyDownServerCommand(e)?(e.preventDefault(),t.handled=!0,Promise.resolve()):super.processCapturedKeyDownAsync(e,t)}processCapturedPointerDownAsync(e,t){return this.canHandlePointerDown(e)?(t.handled=!0,Promise.resolve()):super.processCapturedPointerDownAsync(e,t)}canHandlePointerDown(e){return!1}invokeKeyDownServerCommand(e){return!1}onSlotChanged(e){this.disposeDropDownInfrastructure(),this.ensureDropDownInfrastructure()}getDropDownPortal(){if(!this.shadowRoot)return null;const e=this.shadowRoot.querySelector("slot");if(!e)return null;return e.assignedNodes().find((e=>r(e)))}onDropDownElementChanged(e){this.dropDownPortal||this.ensureDropDownInfrastructure(),s.getOriginalSource(e)===this.dropDownPortal&&(this.disposeDropDownElement(),this.ensureDropDownElement())}onDropDownShown(e){this.dropDownElement&&i(this.dropDownElement)&&this.addLogicalChild(this.dropDownElement)}onDropDownClosed(e){this.dropDownElement&&i(this.dropDownElement)&&this.removeLogicalChild(this.dropDownElement)}onDropDownPortalElementsChanged(e){this.ensureDropDownElement()}ensureDropDownInfrastructure(){var e;this.dropDownPortal=this.getDropDownPortal(),null===(e=this.dropDownPortal)||void 0===e||e.addEventListener(t.eventName,this.boundOnDropDownPortalElementsChangedHandler),this.ensureDropDownElement()}ensureDropDownElement(){var e,t,s;this.dropDownPortal&&(this._dropDownElement=null===(e=this.dropDownPortal)||void 0===e?void 0:e.popup,null===(t=this._dropDownElement)||void 0===t||t.addEventListener(n.eventName,this.boundOnDropDownShownHandler),null===(s=this._dropDownElement)||void 0===s||s.addEventListener(o.eventName,this.boundOnDropDownClosedHandler),this._dropDownElement&&a(this._dropDownElement)&&(this._adaptiveDropDownElement=this._dropDownElement))}disposeDropDownInfrastructure(){var e;null===(e=this.dropDownPortal)||void 0===e||e.removeEventListener(t.eventName,this.boundOnDropDownPortalElementsChangedHandler),this.dropDownPortal=null,this._adaptiveDropDownElement=null,this.disposeDropDownElement()}disposeDropDownElement(){var e,t;null===(e=this._dropDownElement)||void 0===e||e.removeEventListener(n.eventName,this.boundOnDropDownShownHandler),null===(t=this._dropDownElement)||void 0===t||t.removeEventListener(o.eventName,this.boundOnDropDownClosedHandler),this._dropDownElement=null}}class f extends d{constructor(e,t,n,o){super(e,t),this._focusSemaphore=new h,this._menuItemSelector=n,this._parentStrategy=o}get parentStrategy(){return this._parentStrategy}get menuItemSelector(){return this._menuItemSelector}queryItems(){return this.queryItemsBySelector(this._menuItemSelector)}doAction(e){this.doClick(this.selectedItemElement,e),p(this.selectedItemElement)&&this.focusSubMenuItemAsync(m.First)}handleKeyDown(e){return this._focusSemaphore.doAllowedFunc((()=>u.KeyUtils.getEventKeyCode(e)===u.KeyCode.Right&&this.subMenuStrategy&&D(this.targetElement)?(this.subMenuStrategy.focusFirstItem(),!0):super.handleKeyDown(e)))}openSubMenu(e){this.openSubMenuAsync(e)}async openSubMenuAsync(e){this.requestSubMenuOpen(),await this.focusSubMenuItemAsync(e)}async focusSubMenuItemAsync(e){const t=await this.waitSubMenuShown();S(t.targetElement),e===m.Last?t.focusLastItem():t.focusFirstItem()}closeSubMenu(){this.selectedItemElement.dispatchEvent(new c(w.Collapse))}handlePopupShown(){this._parentStrategy.onSubMenuShown(this)}handlePopupClosed(){this._parentStrategy.onSubMenuClosed(this)}focusFirstItem(){this.subMenuStrategy?this.subMenuStrategy.focusFirstItem():super.focusFirstItem()}focusLastItem(){this.subMenuStrategy?this.subMenuStrategy.focusLastItem():super.focusLastItem()}focusItem(e){this._focusSemaphore.doAllowedAction((()=>{super.focusItem(e)}))}restoreFocus(){this._focusSemaphore.doAllowedAction((()=>{super.restoreFocus()}))}focusSelectedItem(){this._focusSemaphore.doIfAllowed((()=>{super.focusSelectedItem()}))}}class v extends f{createSubMenuStrategy(e,t){return new b(e,t,this.menuItemSelector,this)}closeSelf(){return!1}}class b extends f{createSubMenuStrategy(e,t){return new b(e,t,this.menuItemSelector,this)}closeSelf(){return this.parentStrategy.closeSubMenu(),!0}}export{E as D,v as a,f as b,b as c};
